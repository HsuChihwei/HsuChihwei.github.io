<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>悟の迹</title>
  <subtitle>You are my sunshine!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://chihweihsu.com/"/>
  <updated>2017-08-28T10:40:36.848Z</updated>
  <id>http://chihweihsu.com/</id>
  
  <author>
    <name>Chihwei·Hsu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Pandas dataframe与序列相乘</title>
    <link href="http://chihweihsu.com/2017/08/27/Pandas-dataframe%E4%B8%8E%E5%BA%8F%E5%88%97%E7%9B%B8%E4%B9%98/"/>
    <id>http://chihweihsu.com/2017/08/27/Pandas-dataframe与序列相乘/</id>
    <published>2017-08-27T10:28:54.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote>
<p>继续完成项目中的评分卡部分，拿到分好箱的数据后，如何进行加权得到最后的分数就是我们接下来要考虑的问题了。</p>
</blockquote>
<a id="more"></a>
<h4 id="demo1"><a href="#demo1" class="headerlink" title="demo1:"></a>demo1:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result = dataframe.mul(series, axis=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<h4 id="demo2"><a href="#demo2" class="headerlink" title="demo2:"></a>demo2:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">tile_df</span><span class="params">(df, n, m)</span>:</span></div><div class="line"> dfn = df.T</div><div class="line"> <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">1</span>, m):</div><div class="line"> dfn = dfn.append(df.T, ignore_index=<span class="keyword">True</span>)</div><div class="line"> dfm = dfn.T</div><div class="line"> <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">1</span>, n):</div><div class="line"> dfm = dfm.append(dfn.T, ignore_index=<span class="keyword">True</span>)</div><div class="line"> <span class="keyword">return</span> dfm</div><div class="line"> </div><div class="line">df = pandas.DataFrame([[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]])</div><div class="line">tile_df(df, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line"><span class="comment"># 0 1 2 3 4 5</span></div><div class="line"><span class="comment"># 0 1 2 1 2 1 2</span></div><div class="line"><span class="comment"># 1 3 4 3 4 3 4</span></div><div class="line"><span class="comment"># 2 1 2 1 2 1 2</span></div><div class="line"><span class="comment"># 3 3 4 3 4 3 4</span></div></pre></td></tr></table></figure>
<h4 id="demo3"><a href="#demo3" class="headerlink" title="demo3:"></a>demo3:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.DataFrame(np.random.randint(<span class="number">1</span>, <span class="number">10</span>, (<span class="number">5</span>, <span class="number">3</span>)))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df</div><div class="line">   <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span></div><div class="line"><span class="number">0</span>  <span class="number">7</span>  <span class="number">7</span>  <span class="number">5</span></div><div class="line"><span class="number">1</span>  <span class="number">1</span>  <span class="number">8</span>  <span class="number">6</span></div><div class="line"><span class="number">2</span>  <span class="number">4</span>  <span class="number">8</span>  <span class="number">4</span></div><div class="line"><span class="number">3</span>  <span class="number">2</span>  <span class="number">9</span>  <span class="number">5</span></div><div class="line"><span class="number">4</span>  <span class="number">3</span>  <span class="number">8</span>  <span class="number">7</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df.prod(axis=<span class="number">1</span>)</div><div class="line"><span class="number">0</span>    <span class="number">245</span></div><div class="line"><span class="number">1</span>     <span class="number">48</span></div><div class="line"><span class="number">2</span>    <span class="number">128</span></div><div class="line"><span class="number">3</span>     <span class="number">90</span></div><div class="line"><span class="number">4</span>    <span class="number">168</span></div><div class="line">dtype: int64</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.DataFrame(np.random.randint(<span class="number">1</span>, <span class="number">10</span>, (<span class="number">5</span>, <span class="number">3</span>)))</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df</div><div class="line">   <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span></div><div class="line"><span class="number">0</span>  <span class="number">9</span>  <span class="number">3</span>  <span class="number">3</span></div><div class="line"><span class="number">1</span>  <span class="number">8</span>  <span class="number">5</span>  <span class="number">4</span></div><div class="line"><span class="number">2</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span></div><div class="line"><span class="number">3</span>  <span class="number">9</span>  <span class="number">8</span>  <span class="number">5</span></div><div class="line"><span class="number">4</span>  <span class="number">7</span>  <span class="number">1</span>  <span class="number">2</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df.apply(np.prod, axis=<span class="number">1</span>)</div><div class="line"><span class="number">0</span>     <span class="number">81</span></div><div class="line"><span class="number">1</span>    <span class="number">160</span></div><div class="line"><span class="number">2</span>    <span class="number">126</span></div><div class="line"><span class="number">3</span>    <span class="number">360</span></div><div class="line"><span class="number">4</span>     <span class="number">14</span></div><div class="line">dtype: int64</div></pre></td></tr></table></figure>
<h4 id="demo4"><a href="#demo4" class="headerlink" title="demo4:"></a>demo4:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line">In[<span class="number">197</span>]: <span class="keyword">import</span> pandas <span class="keyword">as</span> pd; <span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"> </div><div class="line">In [<span class="number">198</span>]: df = pd.DataFrame(np.arange(<span class="number">40.</span>).reshape((<span class="number">8</span>, <span class="number">5</span>)), columns=list(<span class="string">'abcde'</span>));</div><div class="line"></div><div class="line">In [<span class="number">199</span>]: df</div><div class="line">Out[<span class="number">199</span>]:</div><div class="line">      a     b     c     d     e</div><div class="line"><span class="number">0</span>   <span class="number">0.0</span>   <span class="number">1.0</span>   <span class="number">2.0</span>   <span class="number">3.0</span>   <span class="number">4.0</span></div><div class="line"><span class="number">1</span>   <span class="number">5.0</span>   <span class="number">6.0</span>   <span class="number">7.0</span>   <span class="number">8.0</span>   <span class="number">9.0</span></div><div class="line"><span class="number">2</span>  <span class="number">10.0</span>  <span class="number">11.0</span>  <span class="number">12.0</span>  <span class="number">13.0</span>  <span class="number">14.0</span></div><div class="line"><span class="number">3</span>  <span class="number">15.0</span>  <span class="number">16.0</span>  <span class="number">17.0</span>  <span class="number">18.0</span>  <span class="number">19.0</span></div><div class="line"><span class="number">4</span>  <span class="number">20.0</span>  <span class="number">21.0</span>  <span class="number">22.0</span>  <span class="number">23.0</span>  <span class="number">24.0</span></div><div class="line"><span class="number">5</span>  <span class="number">25.0</span>  <span class="number">26.0</span>  <span class="number">27.0</span>  <span class="number">28.0</span>  <span class="number">29.0</span></div><div class="line"><span class="number">6</span>  <span class="number">30.0</span>  <span class="number">31.0</span>  <span class="number">32.0</span>  <span class="number">33.0</span>  <span class="number">34.0</span></div><div class="line"><span class="number">7</span>  <span class="number">35.0</span>  <span class="number">36.0</span>  <span class="number">37.0</span>  <span class="number">38.0</span>  <span class="number">39.0</span></div><div class="line"></div><div class="line">In [<span class="number">200</span>]: ser = pd.Series(np.arange(<span class="number">8</span>) * <span class="number">10</span>);</div><div class="line"></div><div class="line">In [<span class="number">201</span>]: ser</div><div class="line">Out[<span class="number">201</span>]:</div><div class="line"><span class="number">0</span>     <span class="number">0</span></div><div class="line"><span class="number">1</span>    <span class="number">10</span></div><div class="line"><span class="number">2</span>    <span class="number">20</span></div><div class="line"><span class="number">3</span>    <span class="number">30</span></div><div class="line"><span class="number">4</span>    <span class="number">40</span></div><div class="line"><span class="number">5</span>    <span class="number">50</span></div><div class="line"><span class="number">6</span>    <span class="number">60</span></div><div class="line"><span class="number">7</span>    <span class="number">70</span></div><div class="line">dtype: int64</div><div class="line"></div><div class="line"></div><div class="line">In [<span class="number">202</span>]: func = <span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser)</div><div class="line"></div><div class="line">In [<span class="number">203</span>]: df.apply(func)</div><div class="line">Out[<span class="number">203</span>]:</div><div class="line">        a       b       c       d       e</div><div class="line"><span class="number">0</span>     <span class="number">0.0</span>     <span class="number">0.0</span>     <span class="number">0.0</span>     <span class="number">0.0</span>     <span class="number">0.0</span></div><div class="line"><span class="number">1</span>    <span class="number">50.0</span>    <span class="number">60.0</span>    <span class="number">70.0</span>    <span class="number">80.0</span>    <span class="number">90.0</span></div><div class="line"><span class="number">2</span>   <span class="number">200.0</span>   <span class="number">220.0</span>   <span class="number">240.0</span>   <span class="number">260.0</span>   <span class="number">280.0</span></div><div class="line"><span class="number">3</span>   <span class="number">450.0</span>   <span class="number">480.0</span>   <span class="number">510.0</span>   <span class="number">540.0</span>   <span class="number">570.0</span></div><div class="line"><span class="number">4</span>   <span class="number">800.0</span>   <span class="number">840.0</span>   <span class="number">880.0</span>   <span class="number">920.0</span>   <span class="number">960.0</span></div><div class="line"><span class="number">5</span>  <span class="number">1250.0</span>  <span class="number">1300.0</span>  <span class="number">1350.0</span>  <span class="number">1400.0</span>  <span class="number">1450.0</span></div><div class="line"><span class="number">6</span>  <span class="number">1800.0</span>  <span class="number">1860.0</span>  <span class="number">1920.0</span>  <span class="number">1980.0</span>  <span class="number">2040.0</span></div><div class="line"><span class="number">7</span>  <span class="number">2450.0</span>  <span class="number">2520.0</span>  <span class="number">2590.0</span>  <span class="number">2660.0</span>  <span class="number">2730.0</span></div><div class="line"></div><div class="line"></div><div class="line">In [<span class="number">204</span>]: df.apply(func).a</div><div class="line">Out[<span class="number">204</span>]:</div><div class="line"><span class="number">0</span>       <span class="number">0.0</span></div><div class="line"><span class="number">1</span>      <span class="number">50.0</span></div><div class="line"><span class="number">2</span>     <span class="number">200.0</span></div><div class="line"><span class="number">3</span>     <span class="number">450.0</span></div><div class="line"><span class="number">4</span>     <span class="number">800.0</span></div><div class="line"><span class="number">5</span>    <span class="number">1250.0</span></div><div class="line"><span class="number">6</span>    <span class="number">1800.0</span></div><div class="line"><span class="number">7</span>    <span class="number">2450.0</span></div><div class="line">Name: a, dtype: float64</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 行相乘</span></div><div class="line">In[<span class="number">205</span>]: ser2 = pd.Series(np.arange(<span class="number">5</span>) *<span class="number">5</span>); </div><div class="line"></div><div class="line">In [<span class="number">206</span>]: ser2</div><div class="line">Out[<span class="number">206</span>]: </div><div class="line"> <span class="number">0</span> <span class="number">0</span></div><div class="line"> <span class="number">1</span> <span class="number">5</span></div><div class="line"> <span class="number">2</span> <span class="number">10</span></div><div class="line"> <span class="number">3</span> <span class="number">15</span></div><div class="line"> <span class="number">4</span> <span class="number">20</span></div><div class="line"></div><div class="line">In[<span class="number">207</span>]: func2 = <span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser2)</div><div class="line"></div><div class="line">In[<span class="number">8</span>]: df.apply(func2, axis=<span class="number">1</span>)</div><div class="line">Out[<span class="number">208</span>]: </div><div class="line"> a b c d e</div><div class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">5</span> <span class="number">20</span> <span class="number">45</span> <span class="number">80</span></div><div class="line"> <span class="number">1</span> <span class="number">0</span> <span class="number">30</span> <span class="number">70</span> <span class="number">120</span> <span class="number">180</span></div><div class="line"> <span class="number">2</span> <span class="number">0</span> <span class="number">55</span> <span class="number">120</span> <span class="number">195</span> <span class="number">280</span></div><div class="line"> <span class="number">3</span> <span class="number">0</span> <span class="number">80</span> <span class="number">170</span> <span class="number">270</span> <span class="number">380</span></div><div class="line"> <span class="number">4</span> <span class="number">0</span> <span class="number">105</span> <span class="number">220</span> <span class="number">345</span> <span class="number">480</span></div><div class="line"> <span class="number">5</span> <span class="number">0</span> <span class="number">130</span> <span class="number">270</span> <span class="number">420</span> <span class="number">580</span></div><div class="line"> <span class="number">6</span> <span class="number">0</span> <span class="number">155</span> <span class="number">320</span> <span class="number">495</span> <span class="number">680</span></div><div class="line"> <span class="number">7</span> <span class="number">0</span> <span class="number">180</span> <span class="number">370</span> <span class="number">570</span> <span class="number">780</span></div><div class="line"> </div><div class="line"> <span class="comment"># 进阶版</span></div><div class="line">In[<span class="number">209</span>]: df.apply(<span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser))</div><div class="line">Out[<span class="number">209</span>]: </div><div class="line"> a b c d e</div><div class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></div><div class="line"> <span class="number">1</span> <span class="number">50</span> <span class="number">60</span> <span class="number">70</span> <span class="number">80</span> <span class="number">90</span></div><div class="line"> <span class="number">2</span> <span class="number">200</span> <span class="number">220</span> <span class="number">240</span> <span class="number">260</span> <span class="number">280</span></div><div class="line"> <span class="number">3</span> <span class="number">450</span> <span class="number">480</span> <span class="number">510</span> <span class="number">540</span> <span class="number">570</span></div><div class="line"> <span class="number">4</span> <span class="number">800</span> <span class="number">840</span> <span class="number">880</span> <span class="number">920</span> <span class="number">960</span></div><div class="line"> <span class="number">5</span> <span class="number">1250</span> <span class="number">1300</span> <span class="number">1350</span> <span class="number">1400</span> <span class="number">1450</span></div><div class="line"> <span class="number">6</span> <span class="number">1800</span> <span class="number">1860</span> <span class="number">1920</span> <span class="number">1980</span> <span class="number">2040</span></div><div class="line"> <span class="number">7</span> <span class="number">2450</span> <span class="number">2520</span> <span class="number">2590</span> <span class="number">2660</span> <span class="number">2730</span></div><div class="line"> </div><div class="line">In [<span class="number">210</span>]: df.apply(<span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser)).a</div><div class="line">Out[<span class="number">210</span>]:</div><div class="line"><span class="number">0</span>       <span class="number">0.0</span></div><div class="line"><span class="number">1</span>      <span class="number">50.0</span></div><div class="line"><span class="number">2</span>     <span class="number">200.0</span></div><div class="line"><span class="number">3</span>     <span class="number">450.0</span></div><div class="line"><span class="number">4</span>     <span class="number">800.0</span></div><div class="line"><span class="number">5</span>    <span class="number">1250.0</span></div><div class="line"><span class="number">6</span>    <span class="number">1800.0</span></div><div class="line"><span class="number">7</span>    <span class="number">2450.0</span></div><div class="line">Name: a, dtype: float64</div><div class="line"></div><div class="line">In[<span class="number">211</span>]: df.apply(<span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser2), axis=<span class="number">1</span>)</div><div class="line">Out[<span class="number">211</span>]:</div><div class="line"> a b c d e</div><div class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">5</span> <span class="number">20</span> <span class="number">45</span> <span class="number">80</span></div><div class="line"> <span class="number">1</span> <span class="number">0</span> <span class="number">30</span> <span class="number">70</span> <span class="number">120</span> <span class="number">180</span></div><div class="line"> <span class="number">2</span> <span class="number">0</span> <span class="number">55</span> <span class="number">120</span> <span class="number">195</span> <span class="number">280</span></div><div class="line"> <span class="number">3</span> <span class="number">0</span> <span class="number">80</span> <span class="number">170</span> <span class="number">270</span> <span class="number">380</span></div><div class="line"> <span class="number">4</span> <span class="number">0</span> <span class="number">105</span> <span class="number">220</span> <span class="number">345</span> <span class="number">480</span></div><div class="line"> <span class="number">5</span> <span class="number">0</span> <span class="number">130</span> <span class="number">270</span> <span class="number">420</span> <span class="number">580</span></div><div class="line"> <span class="number">6</span> <span class="number">0</span> <span class="number">155</span> <span class="number">320</span> <span class="number">495</span> <span class="number">680</span></div><div class="line"> <span class="number">7</span> <span class="number">0</span> <span class="number">180</span> <span class="number">370</span> <span class="number">570</span> <span class="number">780</span></div></pre></td></tr></table></figure>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><blockquote>
<p>这样，我们总分也就拿到了，最后只需将每个项目的总分求和即可</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;继续完成项目中的评分卡部分，拿到分好箱的数据后，如何进行加权得到最后的分数就是我们接下来要考虑的问题了。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python, Notes" scheme="http://chihweihsu.com/categories/Python-Notes/"/>
    
    
      <category term="Python, Pandas" scheme="http://chihweihsu.com/tags/Python-Pandas/"/>
    
  </entry>
  
  <entry>
    <title>python 协程加速</title>
    <link href="http://chihweihsu.com/2017/08/27/python-%E5%8D%8F%E7%A8%8B%E5%8A%A0%E9%80%9F/"/>
    <id>http://chihweihsu.com/2017/08/27/python-协程加速/</id>
    <published>2017-08-27T08:05:58.000Z</published>
    <updated>2017-08-28T10:40:36.849Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote>
<p>上周，由于产品嫌报告生成太慢，经过使用<code>profile/gprof2dot</code>研究后，发现主要时间耗费在接口网络请求上，于是我决定在项目中大量处理I/O网络请求的地方使用<code>gevent</code>,以缓解报告生成压力。</p>
</blockquote>
<a id="more"></a>
<h3 id="实现代码："><a href="#实现代码：" class="headerlink" title="实现代码："></a>实现代码：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> gevent</div><div class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey, pool</div><div class="line">monkey.patch_socket()</div><div class="line">p = pool.Pool(<span class="number">300</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">requests_parse</span><span class="params">(self, tel_tuple)</span>:</span></div><div class="line">	<span class="string">"""</span></div><div class="line">	主要处理requests请求</div><div class="line">	"""</div><div class="line">	print(<span class="string">'Size of pool'</span>, len(p))</div><div class="line">	……</div><div class="line">	……</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_label</span><span class="params">(self, tel_data)</span>:</span></div><div class="line">	<span class="string">"""</span></div><div class="line">	使用gevent实现协程处理I/O网络请求</div><div class="line">	"""</div><div class="line">	jobs = [p.spawn(self.requests_parse, tel) <span class="keyword">for</span> tel <span class="keyword">in</span> tel_data]</div><div class="line">	gevent.joinall(jobs)</div><div class="line"></div><div class="line">	tlist = [x.value <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</div><div class="line">	<span class="keyword">if</span> <span class="keyword">None</span> <span class="keyword">in</span> tlist:</div><div class="line">		message_list = [x.exception <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</div><div class="line">		self.logger.error(tlist)</div><div class="line">		self.logger.error(message_list)</div><div class="line">		<span class="keyword">raise</span> Exception(message_list)</div><div class="line">	<span class="keyword">return</span> tlist</div><div class="line">	</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_data_step</span><span class="params">(self, tel)</span>:</span></div><div class="line">	<span class="string">"""</span></div><div class="line">	主要将请求回来处理好的数据写入数据库（mongo）</div><div class="line">	"""</div><div class="line">	res = self.db.update()</div><div class="line">	……</div><div class="line">	……</div><div class="line"></div><div class="line">tel_data = [……] <span class="comment"># 一大堆待请求参数list</span></div><div class="line">tlist = self.generator_label(set(tel_data))</div><div class="line">map(<span class="keyword">lambda</span> x: self.update_data_step(x[<span class="number">0</span>])(x[<span class="number">1</span>],x[<span class="number">2</span>],x[<span class="number">3</span>],x[<span class="number">4</span>],x[<span class="number">5</span>],x[<span class="number">6</span>]), tlist)</div></pre></td></tr></table></figure>
<h3 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h3><blockquote>
<p>上线后发现，代码运行一段时间后，请求一上来，任务数直线上升，一直增加：<br><img src="./images/gevent_bug_1.png" alt="enter description here" title="gevent_bug"><br>但是，pool的数量是正常的：<br><img src="./images/gevent_pool_1.png" alt="enter description here" title="gevent_pool"><br>之后log里报错信息：</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">  File <span class="string">"run.py"</span>, line <span class="number">42</span>, <span class="keyword">in</span> update_data</div><div class="line">  File <span class="string">"report/generate/calls_sa_by_tel.py"</span>, line <span class="number">396</span>, <span class="keyword">in</span> run</div><div class="line">  File <span class="string">"report/generate/calls_sa_by_tel.py"</span>, line <span class="number">38</span>, <span class="keyword">in</span> base_call</div><div class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/cursor.py"</span>, line <span class="number">729</span>, <span class="keyword">in</span> count</div><div class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/collection.py"</span>, line <span class="number">1344</span>, <span class="keyword">in</span> _count</div><div class="line">  File <span class="string">"/usr/lib64/python2.7/contextlib.py"</span>, line <span class="number">17</span>, <span class="keyword">in</span> __enter__</div><div class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/mongo_client.py"</span>, line <span class="number">904</span>, <span class="keyword">in</span> _socket_for_reads</div><div class="line">  File <span class="string">"/usr/lib64/python2.7/contextlib.py"</span>, line <span class="number">17</span>, <span class="keyword">in</span> __enter__</div><div class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/mongo_client.py"</span>, line <span class="number">870</span>, <span class="keyword">in</span> _get_socket</div><div class="line">  File <span class="string">"/usr/lib64/python2.7/contextlib.py"</span>, line <span class="number">17</span>, <span class="keyword">in</span> __enter__</div><div class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/server.py"</span>, line <span class="number">168</span>, <span class="keyword">in</span> get_socket</div><div class="line">  File <span class="string">"/usr/lib64/python2.7/contextlib.py"</span>, line <span class="number">17</span>, <span class="keyword">in</span> __enter__</div><div class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/pool.py"</span>, line <span class="number">844</span>, <span class="keyword">in</span> get_socket</div><div class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/pool.py"</span>, line <span class="number">881</span>, <span class="keyword">in</span> _get_socket_no_auth</div><div class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/pool.py"</span>, line <span class="number">817</span>, <span class="keyword">in</span> connect</div><div class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/pool.py"</span>, line <span class="number">263</span>, <span class="keyword">in</span> _raise_connection_failure</div><div class="line">AutoReconnect: xxx.xxx.xxx<span class="number">.117</span>:<span class="number">27017</span>: [Errno <span class="number">24</span>] Too many open files</div></pre></td></tr></table></figure>
<h3 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h3><blockquote>
<p>经过分析，解决办法：<code>monkey.patch_socket()</code>换为<code>monkey.patch_all()</code>，或者，在使用完<code>gevent</code>后使用<code>reload(socket)</code>将socket初始化。<br>原因：应该是mongo写数据是阻塞的，请求快于写操作，导致写操作堆积越来越多，最终导致程序抛出<code>Too many open files</code>错误。<br>最终代码，如下：</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> gevent</div><div class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey, pool</div><div class="line">monkey.patch_all()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_label</span><span class="params">(self, tel_data)</span>:</span></div><div class="line">	p = pool.Pool(<span class="number">10</span>)</div><div class="line">	jobs = [p.spawn(self.requests_parse, tel) <span class="keyword">for</span> tel <span class="keyword">in</span> tel_data]</div><div class="line">	gevent.joinall(jobs)</div><div class="line">	<span class="comment"># print [x.value for x in jobs]</span></div><div class="line">	tlist = [x.value <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</div><div class="line">	<span class="keyword">if</span> <span class="keyword">None</span> <span class="keyword">in</span> tlist:</div><div class="line">		message_list = [x.exception <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</div><div class="line">		self.logger.error(tlist)</div><div class="line">		self.logger.error(message_list)</div><div class="line">		<span class="keyword">raise</span> Exception(message_list)</div><div class="line">	<span class="keyword">return</span> tlist</div><div class="line">	</div><div class="line">	</div><div class="line"><span class="comment"># 或者使用</span></div><div class="line">p = pool.Pool(<span class="number">10</span>)</div><div class="line">jobs = [p.spawn(self.requests_parse, tel) <span class="keyword">for</span> tel <span class="keyword">in</span> tel_data]</div><div class="line">gevent.joinall(jobs)</div><div class="line"><span class="keyword">import</span> socket</div><div class="line">reload(socket)</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote>
<p>协程(gevent)是把双刃剑，monkey.patch 是一个邪恶的东西；<br>提升效果不要太好，耗时足足降了60%，而且，请求越多，效果越明显。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;上周，由于产品嫌报告生成太慢，经过使用&lt;code&gt;profile/gprof2dot&lt;/code&gt;研究后，发现主要时间耗费在接口网络请求上，于是我决定在项目中大量处理I/O网络请求的地方使用&lt;code&gt;gevent&lt;/code&gt;,以缓解报告生成压力。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python, Notes" scheme="http://chihweihsu.com/categories/Python-Notes/"/>
    
    
      <category term="Python, gevent" scheme="http://chihweihsu.com/tags/Python-gevent/"/>
    
  </entry>
  
  <entry>
    <title>Pandas 分箱操作（cut）</title>
    <link href="http://chihweihsu.com/2017/08/27/Pandas-%E5%88%86%E7%AE%B1%E6%93%8D%E4%BD%9C%EF%BC%88cut%EF%BC%89/"/>
    <id>http://chihweihsu.com/2017/08/27/Pandas-分箱操作（cut）/</id>
    <published>2017-08-27T03:12:47.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote>
<p>最新，项目中涉及到评分卡操作，评分项目有大概几十项，每项基本都是按频次区间给一个分数，最后，累计所有项目的分数得出最后所需要的分数。</p>
</blockquote>
<a id="more"></a>
<h3 id="demo1："><a href="#demo1：" class="headerlink" title="demo1："></a>demo1：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">df = pandas.DataFrame(&#123;<span class="string">"a"</span>: np.random.random(<span class="number">100</span>), <span class="string">"b"</span>: np.random.random(<span class="number">100</span>), <span class="string">"id"</span>: np.arange(<span class="number">100</span>)&#125;)</div><div class="line"></div><div class="line"><span class="comment"># Bin the data frame by "a" with 10 bins...</span></div><div class="line">bins = np.linspace(df.a.min(), df.a.max(), <span class="number">10</span>)</div><div class="line"><span class="comment"># array([ 0.00282977,  0.11097259,  0.2191154 ,  0.32725822,  0.43540104,</span></div><div class="line">        <span class="number">0.54354385</span>,  <span class="number">0.65168667</span>,  <span class="number">0.75982948</span>,  <span class="number">0.8679723</span> ,  <span class="number">0.97611511</span>])</div><div class="line"></div><div class="line"><span class="comment"># bins = np.linspace(0, 1, 11) # 优化版</span></div><div class="line"><span class="comment"># array([ 0. ,  0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  0.7,  0.8,  0.9,  1. ])</span></div><div class="line"></div><div class="line">groups = df.groupby(np.digitize(df.a, bins))</div><div class="line"></div><div class="line"><span class="comment"># Get the mean of each bin:</span></div><div class="line"><span class="keyword">print</span> groups.mean() <span class="comment"># Also could do "groups.aggregate(np.mean)"</span></div><div class="line">&gt;&gt;&gt;output:</div><div class="line">           a         b         id</div><div class="line"><span class="number">1</span>   <span class="number">0.044003</span>  <span class="number">0.525964</span>  <span class="number">56.307692</span></div><div class="line"><span class="number">2</span>   <span class="number">0.167568</span>  <span class="number">0.506078</span>  <span class="number">55.454545</span></div><div class="line"><span class="number">3</span>   <span class="number">0.268109</span>  <span class="number">0.510612</span>  <span class="number">44.636364</span></div><div class="line"><span class="number">4</span>   <span class="number">0.375014</span>  <span class="number">0.544154</span>  <span class="number">69.833333</span></div><div class="line"><span class="number">5</span>   <span class="number">0.481702</span>  <span class="number">0.590031</span>  <span class="number">48.500000</span></div><div class="line"><span class="number">6</span>   <span class="number">0.599587</span>  <span class="number">0.488921</span>  <span class="number">38.076923</span></div><div class="line"><span class="number">7</span>   <span class="number">0.696548</span>  <span class="number">0.643555</span>  <span class="number">50.642857</span></div><div class="line"><span class="number">8</span>   <span class="number">0.830064</span>  <span class="number">0.620650</span>  <span class="number">50.571429</span></div><div class="line"><span class="number">9</span>   <span class="number">0.928396</span>  <span class="number">0.545460</span>  <span class="number">44.166667</span></div><div class="line"><span class="number">10</span>  <span class="number">0.976115</span>  <span class="number">0.693051</span>  <span class="number">28.000000</span></div><div class="line"></div><div class="line"><span class="comment"># Similarly, the median:</span></div><div class="line"><span class="keyword">print</span> groups.median()</div><div class="line">&gt;&gt;&gt;output:</div><div class="line">          a         b    id</div><div class="line"><span class="number">1</span>   <span class="number">0.028901</span>  <span class="number">0.536857</span>  <span class="number">61.0</span></div><div class="line"><span class="number">2</span>   <span class="number">0.167054</span>  <span class="number">0.557716</span>  <span class="number">49.0</span></div><div class="line"><span class="number">3</span>   <span class="number">0.267337</span>  <span class="number">0.534911</span>  <span class="number">43.0</span></div><div class="line"><span class="number">4</span>   <span class="number">0.374787</span>  <span class="number">0.487063</span>  <span class="number">73.0</span></div><div class="line"><span class="number">5</span>   <span class="number">0.480395</span>  <span class="number">0.737007</span>  <span class="number">49.5</span></div><div class="line"><span class="number">6</span>   <span class="number">0.603701</span>  <span class="number">0.676479</span>  <span class="number">42.0</span></div><div class="line"><span class="number">7</span>   <span class="number">0.695939</span>  <span class="number">0.689144</span>  <span class="number">57.5</span></div><div class="line"><span class="number">8</span>   <span class="number">0.836665</span>  <span class="number">0.690757</span>  <span class="number">41.0</span></div><div class="line"><span class="number">9</span>   <span class="number">0.924245</span>  <span class="number">0.646487</span>  <span class="number">47.0</span></div><div class="line"><span class="number">10</span>  <span class="number">0.976115</span>  <span class="number">0.693051</span>  <span class="number">28.0</span></div><div class="line"></div><div class="line"><span class="comment"># Apply some arbitrary function to aggregate binned data</span></div><div class="line"><span class="keyword">print</span> groups.aggregate(<span class="keyword">lambda</span> x: np.mean(x[x &gt; <span class="number">0.5</span>]))</div><div class="line">&gt;&gt;&gt;output:</div><div class="line">           a         b         id</div><div class="line"><span class="number">1</span>        NaN  <span class="number">0.671236</span>  <span class="number">56.307692</span></div><div class="line"><span class="number">2</span>        NaN  <span class="number">0.704379</span>  <span class="number">55.454545</span></div><div class="line"><span class="number">3</span>        NaN  <span class="number">0.768609</span>  <span class="number">44.636364</span></div><div class="line"><span class="number">4</span>        NaN  <span class="number">0.804354</span>  <span class="number">69.833333</span></div><div class="line"><span class="number">5</span>   <span class="number">0.514166</span>  <span class="number">0.796151</span>  <span class="number">48.500000</span></div><div class="line"><span class="number">6</span>   <span class="number">0.599587</span>  <span class="number">0.755381</span>  <span class="number">41.250000</span></div><div class="line"><span class="number">7</span>   <span class="number">0.696548</span>  <span class="number">0.779524</span>  <span class="number">50.642857</span></div><div class="line"><span class="number">8</span>   <span class="number">0.830064</span>  <span class="number">0.766095</span>  <span class="number">50.571429</span></div><div class="line"><span class="number">9</span>   <span class="number">0.928396</span>  <span class="number">0.902529</span>  <span class="number">44.166667</span></div><div class="line"><span class="number">10</span>  <span class="number">0.976115</span>  <span class="number">0.693051</span>  <span class="number">28.000000</span></div></pre></td></tr></table></figure>
<h4 id="demo2"><a href="#demo2" class="headerlink" title="demo2 :"></a>demo2 :</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> pandas</div><div class="line"></div><div class="line">df = pandas.DataFrame(&#123;<span class="string">"a"</span>: np.random.random(<span class="number">100</span>), </div><div class="line">                       <span class="string">"b"</span>: np.random.random(<span class="number">100</span>) + <span class="number">10</span>&#125;)</div><div class="line"></div><div class="line"><span class="comment"># Bin the data frame by "a" with 10 bins...</span></div><div class="line">bins = np.linspace(df.a.min(), df.a.max(), <span class="number">10</span>)</div><div class="line">groups = df.groupby(pandas.cut(df.a, bins))</div><div class="line"></div><div class="line"><span class="comment"># Get the mean of b, binned by the values in a</span></div><div class="line"><span class="keyword">print</span> groups.mean().b</div><div class="line">&gt;&gt;&gt;output:</div><div class="line">a</div><div class="line">(<span class="number">0.000351</span>, <span class="number">0.11</span>]    <span class="number">10.596542</span></div><div class="line">(<span class="number">0.11</span>, <span class="number">0.22</span>]        <span class="number">10.690010</span></div><div class="line">(<span class="number">0.22</span>, <span class="number">0.33</span>]        <span class="number">10.250080</span></div><div class="line">(<span class="number">0.33</span>, <span class="number">0.44</span>]        <span class="number">10.546134</span></div><div class="line">(<span class="number">0.44</span>, <span class="number">0.549</span>]       <span class="number">10.471454</span></div><div class="line">(<span class="number">0.549</span>, <span class="number">0.659</span>]      <span class="number">10.455624</span></div><div class="line">(<span class="number">0.659</span>, <span class="number">0.769</span>]      <span class="number">10.501616</span></div><div class="line">(<span class="number">0.769</span>, <span class="number">0.879</span>]      <span class="number">10.588354</span></div><div class="line">(<span class="number">0.879</span>, <span class="number">0.989</span>]      <span class="number">10.461848</span></div><div class="line">Name: b, dtype: float64</div></pre></td></tr></table></figure>
<h4 id="demo3"><a href="#demo3" class="headerlink" title="demo3:"></a>demo3:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">144</span>]: df = DataFrame(&#123;<span class="string">"a"</span>: np.random.random(<span class="number">100</span>), <span class="string">"b"</span>: np.random.random(<span class="number">100</span>), <span class="string">"id"</span>:   np.arange(<span class="number">100</span>)&#125;)</div><div class="line"></div><div class="line">In [<span class="number">145</span>]: bins = [<span class="number">0</span>, <span class="number">.25</span>, <span class="number">.5</span>, <span class="number">.75</span>, <span class="number">1</span>]</div><div class="line"></div><div class="line">In [<span class="number">146</span>]: a_bins = df.a.groupby(cut(df.a,bins))</div><div class="line"></div><div class="line">In [<span class="number">147</span>]: b_bins = df.b.groupby(cut(df.b,bins))</div><div class="line"></div><div class="line">In [<span class="number">148</span>]: a_bins.agg([mean,median])</div><div class="line">Out[<span class="number">148</span>]:</div><div class="line">                 mean    median</div><div class="line">a</div><div class="line">(<span class="number">0</span>, <span class="number">0.25</span>]    <span class="number">0.124173</span>  <span class="number">0.114613</span></div><div class="line">(<span class="number">0.25</span>, <span class="number">0.5</span>]  <span class="number">0.367703</span>  <span class="number">0.358866</span></div><div class="line">(<span class="number">0.5</span>, <span class="number">0.75</span>]  <span class="number">0.624251</span>  <span class="number">0.626730</span></div><div class="line">(<span class="number">0.75</span>, <span class="number">1</span>]    <span class="number">0.875395</span>  <span class="number">0.869843</span></div><div class="line"></div><div class="line">In [<span class="number">149</span>]: b_bins.agg([mean,median])</div><div class="line">Out[<span class="number">149</span>]:</div><div class="line">                 mean    median</div><div class="line">b</div><div class="line">(<span class="number">0</span>, <span class="number">0.25</span>]    <span class="number">0.147936</span>  <span class="number">0.166900</span></div><div class="line">(<span class="number">0.25</span>, <span class="number">0.5</span>]  <span class="number">0.394918</span>  <span class="number">0.386729</span></div><div class="line">(<span class="number">0.5</span>, <span class="number">0.75</span>]  <span class="number">0.636111</span>  <span class="number">0.655247</span></div><div class="line">(<span class="number">0.75</span>, <span class="number">1</span>]    <span class="number">0.851227</span>  <span class="number">0.838805</span></div></pre></td></tr></table></figure>
<h4 id="demo4"><a href="#demo4" class="headerlink" title="demo4:"></a>demo4:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">In [<span class="number">168</span>]: filter_values = [<span class="number">0</span>, <span class="number">5</span>, <span class="number">17</span>, <span class="number">33</span>]</div><div class="line"></div><div class="line">In [<span class="number">169</span>]: df = pd.DataFrame(np.random.random(<span class="number">100</span>)*<span class="number">100</span>, columns  = [<span class="string">'filtercol'</span>])</div><div class="line"></div><div class="line">In [<span class="number">170</span>]: out = pd.cut(df.filtercol, bins = filter_values)</div><div class="line"></div><div class="line">In [<span class="number">171</span>]: counts = pd.value_counts(out)</div><div class="line">Out[<span class="number">171</span>]:</div><div class="line">(<span class="number">17</span>, <span class="number">33</span>]    <span class="number">16</span></div><div class="line">(<span class="number">5</span>, <span class="number">17</span>]     <span class="number">11</span></div><div class="line">(<span class="number">0</span>, <span class="number">5</span>]       <span class="number">5</span></div><div class="line"></div><div class="line"><span class="comment"># 排序</span></div><div class="line">counts = counts.reindex(out.cat.categories)</div><div class="line">counts = counts.sort_index()</div><div class="line"></div><div class="line">In [<span class="number">172</span>]: counts = counts.reindex(out.cat.categories)</div><div class="line">In [<span class="number">173</span>]: counts</div><div class="line">Out[<span class="number">173</span>]:</div><div class="line">(<span class="number">0</span>, <span class="number">5</span>]       <span class="number">5</span></div><div class="line">(<span class="number">5</span>, <span class="number">17</span>]     <span class="number">11</span></div><div class="line">(<span class="number">17</span>, <span class="number">33</span>]    <span class="number">16</span></div><div class="line">Name: filtercol, dtype: int64</div><div class="line"></div><div class="line"><span class="comment"># 重置索引(reset index)</span></div><div class="line">out = counts.reset_index(drop=<span class="keyword">True</span>) <span class="comment"># counts 不变</span></div><div class="line">counts.reset_index(drop=<span class="keyword">True</span>, inplace=<span class="keyword">True</span>) <span class="comment"># 直接改变counts</span></div><div class="line"></div><div class="line">In [<span class="number">174</span>]: out = counts.reset_index(drop=<span class="keyword">True</span>)</div><div class="line">In [<span class="number">175</span>]: out</div><div class="line">Out[<span class="number">175</span>]:</div><div class="line"><span class="number">0</span>     <span class="number">5</span></div><div class="line"><span class="number">1</span>    <span class="number">11</span></div><div class="line"><span class="number">2</span>    <span class="number">16</span></div><div class="line">Name: filtercol, dtype: int64</div><div class="line"></div><div class="line">In [<span class="number">176</span>]: counts</div><div class="line">Out[<span class="number">176</span>]:</div><div class="line">(<span class="number">0</span>, <span class="number">5</span>]       <span class="number">5</span></div><div class="line">(<span class="number">5</span>, <span class="number">17</span>]     <span class="number">11</span></div><div class="line">(<span class="number">17</span>, <span class="number">33</span>]    <span class="number">16</span></div><div class="line">Name: filtercol, dtype: int64</div><div class="line"></div><div class="line">In [<span class="number">177</span>]: counts.reset_index(drop=<span class="keyword">True</span>, inplace=<span class="keyword">True</span>)</div><div class="line">In [<span class="number">178</span>]: counts</div><div class="line">Out[<span class="number">178</span>]:</div><div class="line"><span class="number">0</span>     <span class="number">5</span></div><div class="line"><span class="number">1</span>    <span class="number">11</span></div><div class="line"><span class="number">2</span>    <span class="number">16</span></div><div class="line">Name: filtercol, dtype: int64</div></pre></td></tr></table></figure>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><blockquote>
<p>第四个demo基本就可以完成当前目标了；<br>后续需要操作的是封装一个合适的通用方法，将每个项目评分标准代入即可。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;最新，项目中涉及到评分卡操作，评分项目有大概几十项，每项基本都是按频次区间给一个分数，最后，累计所有项目的分数得出最后所需要的分数。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python, Notes" scheme="http://chihweihsu.com/categories/Python-Notes/"/>
    
    
      <category term="Python, Pandas" scheme="http://chihweihsu.com/tags/Python-Pandas/"/>
    
  </entry>
  
  <entry>
    <title>mongo insert_many BulkWriteError</title>
    <link href="http://chihweihsu.com/2017/08/23/mongo-insert-many-BulkWriteError/"/>
    <id>http://chihweihsu.com/2017/08/23/mongo-insert-many-BulkWriteError/</id>
    <published>2017-08-23T01:31:08.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h3><blockquote>
<p>在对mongo插入数据时，报写入问题，报错信息如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;/root/crs/call_history_crawler/worker/communicate.py&quot;, line 149, in insert_db_data</div><div class="line">    if db[table].insert_many(data):</div><div class="line">  File &quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/collection.py&quot;, line 684, in insert_many</div><div class="line">    blk.execute(self.write_concern.document)</div><div class="line">  File &quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/bulk.py&quot;, line 470, in execute</div><div class="line">    return self.execute_command(sock_info, generator, write_concern)</div><div class="line">  File &quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/bulk.py&quot;, line 314, in execute_command</div><div class="line">    raise BulkWriteError(full_result)</div><div class="line">BulkWriteError: batch op errors occurred</div></pre></td></tr></table></figure></p>
</blockquote>
<a id="more"></a>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><blockquote>
<p>问题出现在，对同一文本进行多次插入，官方说法：<code>insert_many() with a list of references to a single document raises BulkWriteError</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; doc = &#123;&#125;</div><div class="line">&gt;&gt;&gt; collection.insert_many(doc for _ in range(10))</div><div class="line">Traceback (most recent call last):</div><div class="line">...</div><div class="line">pymongo.errors.BulkWriteError: batch op errors occurred</div><div class="line">&gt;&gt;&gt; doc</div><div class="line">&#123;&apos;_id&apos;: ObjectId(&apos;560f171cfba52279f0b0da0c&apos;)&#125;</div><div class="line"></div><div class="line">&gt;&gt;&gt; docs = [&#123;&#125;]</div><div class="line">&gt;&gt;&gt; collection.insert_many(docs * 10)</div><div class="line">Traceback (most recent call last):</div><div class="line">...</div><div class="line">pymongo.errors.BulkWriteError: batch op errors occurred</div><div class="line">&gt;&gt;&gt; docs</div><div class="line">[&#123;&apos;_id&apos;: ObjectId(&apos;560f1933fba52279f0b0da0e&apos;)&#125;]</div></pre></td></tr></table></figure></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;问题：&quot;&gt;&lt;a href=&quot;#问题：&quot; class=&quot;headerlink&quot; title=&quot;问题：&quot;&gt;&lt;/a&gt;问题：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;在对mongo插入数据时，报写入问题，报错信息如下：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Traceback (most recent call last):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  File &amp;quot;/root/crs/call_history_crawler/worker/communicate.py&amp;quot;, line 149, in insert_db_data&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    if db[table].insert_many(data):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  File &amp;quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/collection.py&amp;quot;, line 684, in insert_many&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    blk.execute(self.write_concern.document)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  File &amp;quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/bulk.py&amp;quot;, line 470, in execute&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    return self.execute_command(sock_info, generator, write_concern)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  File &amp;quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/bulk.py&amp;quot;, line 314, in execute_command&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    raise BulkWriteError(full_result)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;BulkWriteError: batch op errors occurred&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python" scheme="http://chihweihsu.com/categories/Python/"/>
    
    
      <category term="Python, Bug" scheme="http://chihweihsu.com/tags/Python-Bug/"/>
    
  </entry>
  
  <entry>
    <title>JSON文件 读写 格式化</title>
    <link href="http://chihweihsu.com/2017/08/14/JSON%E6%96%87%E4%BB%B6-%E8%AF%BB%E5%86%99-%E6%A0%BC%E5%BC%8F%E5%8C%96/"/>
    <id>http://chihweihsu.com/2017/08/14/JSON文件-读写-格式化/</id>
    <published>2017-08-14T05:37:04.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="写文件，格式化"><a href="#写文件，格式化" class="headerlink" title="写文件，格式化"></a>写文件，格式化</h3><blockquote>
<p><code>indent</code>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_info</span><span class="params">(file_name, file_info)</span>:</span></div><div class="line">    <span class="keyword">with</span> open(<span class="string">'&#123;&#125;.json'</span>.format(file_name), <span class="string">'w'</span>) <span class="keyword">as</span> fp:</div><div class="line">        json.dump(file_info, fp, indent=<span class="number">4</span>, sort_keys=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">write_info(<span class="string">'report'</span>, dict(report_data))</div><div class="line"></div><div class="line"><span class="keyword">import</span> json</div></pre></td></tr></table></figure></p>
</blockquote>
<a id="more"></a>
<h3 id="读文件，格式化"><a href="#读文件，格式化" class="headerlink" title="读文件，格式化"></a>读文件，格式化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">pp_json</span><span class="params">(json_thing, sort=True, indents=<span class="number">4</span>)</span>:</span></div><div class="line">    <span class="keyword">if</span> type(json_thing) <span class="keyword">is</span> str:</div><div class="line">        print(json.dumps(json.loads(json_thing), sort_keys=sort, indent=indents))</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        print(json.dumps(json_thing, sort_keys=sort, indent=indents))</div><div class="line">    <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line">pp_json(your_json_string_or_dict)</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</div><div class="line">&gt;&gt;&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>your_json = <span class="string">'["foo", &#123;"bar":["baz", null, 1.0, 2]&#125;]'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>parsed = json.loads(your_json)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> json.dumps(parsed, indent=<span class="number">4</span>, sort_keys=<span class="keyword">True</span>)</div><div class="line">[</div><div class="line">    <span class="string">"foo"</span>, </div><div class="line">    &#123;</div><div class="line">        <span class="string">"bar"</span>: [</div><div class="line">            <span class="string">"baz"</span>, </div><div class="line">            null, </div><div class="line">            <span class="number">1.0</span>, </div><div class="line">            <span class="number">2</span></div><div class="line">        ]</div><div class="line">    &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;写文件，格式化&quot;&gt;&lt;a href=&quot;#写文件，格式化&quot; class=&quot;headerlink&quot; title=&quot;写文件，格式化&quot;&gt;&lt;/a&gt;写文件，格式化&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;indent&lt;/code&gt;:&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;write_info&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(file_name, file_info)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; open(&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;&amp;#125;.json&#39;&lt;/span&gt;.format(file_name), &lt;span class=&quot;string&quot;&gt;&#39;w&#39;&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; fp:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        json.dump(file_info, fp, indent=&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, sort_keys=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;write_info(&lt;span class=&quot;string&quot;&gt;&#39;report&#39;&lt;/span&gt;, dict(report_data))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; json&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python, Notes" scheme="http://chihweihsu.com/categories/Python-Notes/"/>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>三元表达式（条件表达式）</title>
    <link href="http://chihweihsu.com/2017/08/13/%E4%B8%89%E5%85%83%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%89/"/>
    <id>http://chihweihsu.com/2017/08/13/三元表达式（条件表达式）/</id>
    <published>2017-08-13T02:41:33.000Z</published>
    <updated>2017-08-28T10:40:36.849Z</updated>
    
    <content type="html"><![CDATA[<h3 id="条件表达式："><a href="#条件表达式：" class="headerlink" title="条件表达式："></a>条件表达式：</h3><blockquote>
<p>使用一行代码快速判断，替换复杂的多行if语句，使得代码简单可维护。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 如果条件为真，返回真，否则返回假</span></div><div class="line">condition_is_true <span class="keyword">if</span> condition <span class="keyword">else</span> condition_is_false</div><div class="line"></div><div class="line">is_fat = <span class="keyword">True</span></div><div class="line">state = <span class="string">"fat"</span> <span class="keyword">if</span> is_fat <span class="keyword">else</span> <span class="string">"not fat"</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="元组条件表达式："><a href="#元组条件表达式：" class="headerlink" title="元组条件表达式："></a>元组条件表达式：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (返回假，返回真)[真或假]</span></div><div class="line">(if_test_is_false, if_test_is_true)[test]</div><div class="line"></div><div class="line">fat = true</div><div class="line">fitness = (<span class="string">"skinny"</span>, <span class="string">"fat"</span>)[fat]</div><div class="line">print(<span class="string">'All is '</span>, fitness)</div><div class="line"><span class="comment"># 输出： All is fat</span></div></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<ul>
<li>原理：python中，True == 1，False == 0，相当于元组中使用0和1来选取数据；</li>
<li>这种写法不被推荐，原因：不Pythonic；容易把数据与true/false弄混；元祖中两个条件都执行，而<code>if-else</code>的条件表达式不会；</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">condition = <span class="keyword">True</span></div><div class="line">python(<span class="number">2</span> <span class="keyword">if</span> condition <span class="keyword">else</span> <span class="number">1</span>/<span class="number">0</span>)</div><div class="line"><span class="comment"># 输出：2</span></div><div class="line"></div><div class="line">print(<span class="number">1</span>/<span class="number">0</span>, <span class="number">2</span>)[condition]</div><div class="line"><span class="comment"># 输出：ZeroDivisionError异常</span></div></pre></td></tr></table></figure>
<blockquote>
<p>解释：</p>
<ul>
<li>元组先建数据，然后用True(1)/False(0)来索引数据；</li>
<li><code>if-else</code>条件表达式遵循普通的<code>if-else</code>逻辑树；</li>
<li>如果逻辑中有异常条件或重计算型（计算较久）的情况下，避免使用元组条件表达式。</li>
</ul>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;条件表达式：&quot;&gt;&lt;a href=&quot;#条件表达式：&quot; class=&quot;headerlink&quot; title=&quot;条件表达式：&quot;&gt;&lt;/a&gt;条件表达式：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;使用一行代码快速判断，替换复杂的多行if语句，使得代码简单可维护。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 如果条件为真，返回真，否则返回假&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;condition_is_true &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; condition &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; condition_is_false&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;is_fat = &lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;state = &lt;span class=&quot;string&quot;&gt;&quot;fat&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; is_fat &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;not fat&quot;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Python, Notes" scheme="http://chihweihsu.com/categories/Python-Notes/"/>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-10 调试 Pdb（Python debugger）</title>
    <link href="http://chihweihsu.com/2017/08/10/2017-8-10-%E8%B0%83%E8%AF%95-Pdb%EF%BC%88Python-debugger%EF%BC%89/"/>
    <id>http://chihweihsu.com/2017/08/10/2017-8-10-调试-Pdb（Python-debugger）/</id>
    <published>2017-08-10T14:20:47.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Pdb（Python-debugger）："><a href="#Pdb（Python-debugger）：" class="headerlink" title="Pdb（Python debugger）："></a>Pdb（Python debugger）：</h2><h3 id="命令行运行："><a href="#命令行运行：" class="headerlink" title="命令行运行："></a>命令行运行：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python -m pdb my_script.py</div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="脚本内部运行："><a href="#脚本内部运行：" class="headerlink" title="脚本内部运行："></a>脚本内部运行：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pdb</div><div class="line">pdb.set_trace()</div></pre></td></tr></table></figure>
<h3 id="常用命令："><a href="#常用命令：" class="headerlink" title="常用命令："></a>常用命令：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">c ：继续执行；</div><div class="line">w：显示上下文；</div><div class="line">a：打印当前函数参数列表；</div><div class="line">s：单步进入，进入函数内部（step）；</div><div class="line">n：单步跳过，不进入函数（next）；</div><div class="line">q：退出Pdb</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Pdb（Python-debugger）：&quot;&gt;&lt;a href=&quot;#Pdb（Python-debugger）：&quot; class=&quot;headerlink&quot; title=&quot;Pdb（Python debugger）：&quot;&gt;&lt;/a&gt;Pdb（Python debugger）：&lt;/h2&gt;&lt;h3 id=&quot;命令行运行：&quot;&gt;&lt;a href=&quot;#命令行运行：&quot; class=&quot;headerlink&quot; title=&quot;命令行运行：&quot;&gt;&lt;/a&gt;命令行运行：&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;python -m pdb my_script.py&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Python, Notes" scheme="http://chihweihsu.com/categories/Python-Notes/"/>
    
    
      <category term="Python, Debugger" scheme="http://chihweihsu.com/tags/Python-Debugger/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-10 string 去掉标点符号</title>
    <link href="http://chihweihsu.com/2017/08/10/2017-8-10-string-%E5%8E%BB%E6%8E%89%E6%A0%87%E7%82%B9%E7%AC%A6%E5%8F%B7/"/>
    <id>http://chihweihsu.com/2017/08/10/2017-8-10-string-去掉标点符号/</id>
    <published>2017-08-09T16:00:00.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Python-字符串去掉标点符号最佳实践"><a href="#Python-字符串去掉标点符号最佳实践" class="headerlink" title="Python 字符串去掉标点符号最佳实践"></a>Python 字符串去掉标点符号最佳实践</h3><h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><blockquote>
<p><code>str.isalnum</code>：<br>S.isalnum() -&gt; bool<br>Return True if all characters in S are alphanumeric and there is at least one character in S, False otherwise.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>string = <span class="string">"Special $#! characters   spaces 888323"</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">''</span>.join(e <span class="keyword">for</span> e <span class="keyword">in</span> string <span class="keyword">if</span> e.isalnum())</div><div class="line"><span class="string">'Specialcharactersspaces888323'</span></div></pre></td></tr></table></figure>
<blockquote>
<p>特点：</p>
<ul>
<li>只能识别字母和数字，杀伤力大，会把中文、空格之类的也干掉<a id="more"></a>
</li>
</ul>
</blockquote>
<h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><blockquote>
<p>string.punctuation</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> re, string</div><div class="line"></div><div class="line">s =<span class="string">"string. With. Punctuation?"</span> <span class="comment"># Sample string </span></div><div class="line"></div><div class="line"><span class="comment"># 写法一：</span></div><div class="line">out = s.translate(string.maketrans(<span class="string">""</span>,<span class="string">""</span>), string.punctuation)</div><div class="line"></div><div class="line"><span class="comment"># 写法二：</span></div><div class="line">out = s.translate(<span class="keyword">None</span>, string.punctuation)</div><div class="line"></div><div class="line"><span class="comment"># 写法三：</span></div><div class="line">exclude = set(string.punctuation)</div><div class="line">out = <span class="string">''</span>.join(ch <span class="keyword">for</span> ch <span class="keyword">in</span> s <span class="keyword">if</span> ch <span class="keyword">not</span> <span class="keyword">in</span> exclude)</div><div class="line"></div><div class="line"><span class="comment"># 写法四：</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> string.punctuation:</div><div class="line">			s = s.replace(c,<span class="string">""</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s</div><div class="line"><span class="string">'string With Punctuation'</span></div><div class="line"></div><div class="line"><span class="comment"># 写法五：</span></div><div class="line">out = re.sub(<span class="string">'[%s]'</span> % re.escape(string.punctuation), <span class="string">''</span>, s)</div><div class="line"><span class="comment">## re.escape:对字符串中所有可能被解释为正则运算符的字符进行转义</span></div><div class="line"></div><div class="line"><span class="comment"># 写法六：</span></div><div class="line"><span class="comment"># string.punctuation 只包括 ascii 格式； 想要一个包含更广（但是更慢）的方法是使用： unicodedata module :</span></div><div class="line"><span class="keyword">from</span> unicodedata <span class="keyword">import</span> category</div><div class="line">s = <span class="string">u'String — with - «Punctuation »...'</span></div><div class="line">out = re.sub(<span class="string">'[%s]'</span> % re.escape(string.punctuation), <span class="string">''</span>, s)</div><div class="line"><span class="keyword">print</span> <span class="string">'Stripped'</span>, out</div><div class="line"><span class="comment"># 输出：u'Stripped String \u2014 with  \xabPunctuation \xbb'</span></div><div class="line">out = <span class="string">''</span>.join(ch <span class="keyword">for</span> ch <span class="keyword">in</span> s <span class="keyword">if</span> category(ch)[<span class="number">0</span>] != <span class="string">'P'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Stripped'</span>, out</div><div class="line"><span class="comment"># 输出：u'Stripped String  with  Punctuation '</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># For Python 3 str or Python 2 unicode values, str.translate() only takes a dictionary; codepoints (integers) are looked up in that mapping and anything mapped to None is removed.</span></div><div class="line"><span class="comment"># To remove (some?) punctuation then, use:</span></div><div class="line"><span class="keyword">import</span> string</div><div class="line">remove_punct_map = dict.fromkeys(map(ord, string.punctuation))</div><div class="line">s.translate(remove_punct_map)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Your method doesn't work in Python 3, as the translate method doesn't accept the second argument any more. </span></div><div class="line"><span class="keyword">import</span> unicodedata</div><div class="line"><span class="keyword">import</span> sys</div><div class="line">tbl = dict.fromkeys(i <span class="keyword">for</span> i <span class="keyword">in</span> range(sys.maxunicode) <span class="keyword">if</span> unicodedata.category(chr(i)).startswith(<span class="string">'P'</span>))</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove_punctuation</span><span class="params">(text)</span>:</span></div><div class="line">	<span class="keyword">return</span> text.translate(tbl)</div></pre></td></tr></table></figure>
<h4 id="方法三："><a href="#方法三：" class="headerlink" title="方法三："></a>方法三：</h4><blockquote>
<p>re</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> re</div><div class="line">s =<span class="string">"string. With. Punctuation?"</span></div><div class="line">s = re.sub(<span class="string">r'[^\w\s]'</span>,<span class="string">''</span>,s)</div></pre></td></tr></table></figure>
<h3 id="测时："><a href="#测时：" class="headerlink" title="测时："></a>测时：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> re, string, timeit</div><div class="line"></div><div class="line">s =<span class="string">"string. With. Punctuation"</span></div><div class="line"></div><div class="line">exclude = set(string.punctuation)</div><div class="line">table = string.maketrans(<span class="string">""</span>,<span class="string">""</span>)</div><div class="line">regex = re.compile(<span class="string">'[%s]'</span> % re.escape(string.punctuation))</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_set</span><span class="params">(s)</span>:</span></div><div class="line">	<span class="keyword">return</span> <span class="string">''</span>.join(ch <span class="keyword">for</span> ch <span class="keyword">in</span> s <span class="keyword">if</span> ch <span class="keyword">not</span> <span class="keyword">in</span> exclude)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_re</span><span class="params">(s)</span>:</span> </div><div class="line">	<span class="keyword">return</span> regex.sub(<span class="string">''</span>, s)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_trans</span><span class="params">(s)</span>:</span></div><div class="line">	<span class="keyword">return</span> s.translate(table, string.punctuation)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_repl</span><span class="params">(s)</span>:</span></div><div class="line">	<span class="keyword">for</span> c <span class="keyword">in</span> string.punctuation:</div><div class="line">		s=s.replace(c,<span class="string">""</span>)</div><div class="line">	<span class="keyword">return</span> s</div><div class="line"></div><div class="line"><span class="keyword">print</span><span class="string">"sets :"</span>,timeit.Timer(<span class="string">'f(s)'</span>, <span class="string">'from __main__ import s,test_set as f'</span>).timeit(<span class="number">1000000</span>)</div><div class="line"><span class="keyword">print</span><span class="string">"regex :"</span>,timeit.Timer(<span class="string">'f(s)'</span>, <span class="string">'from __main__ import s,test_re as f'</span>).timeit(<span class="number">1000000</span>)</div><div class="line"><span class="keyword">print</span><span class="string">"translate :"</span>,timeit.Timer(<span class="string">'f(s)'</span>, <span class="string">'from __main__ import s,test_trans as f'</span>).timeit(<span class="number">1000000</span>)</div><div class="line"><span class="keyword">print</span><span class="string">"replace :"</span>,timeit.Timer(<span class="string">'f(s)'</span>, <span class="string">'from __main__ import s,test_repl as f'</span>).timeit(<span class="number">1000000</span>)</div><div class="line"></div><div class="line">out_put:</div><div class="line"><span class="comment"># sets : 19.8566138744</span></div><div class="line"><span class="comment"># regex : 6.86155414581</span></div><div class="line"><span class="comment"># translate : 2.12455511093</span></div><div class="line"><span class="comment"># replace : 28.4436721802</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Python-字符串去掉标点符号最佳实践&quot;&gt;&lt;a href=&quot;#Python-字符串去掉标点符号最佳实践&quot; class=&quot;headerlink&quot; title=&quot;Python 字符串去掉标点符号最佳实践&quot;&gt;&lt;/a&gt;Python 字符串去掉标点符号最佳实践&lt;/h3&gt;&lt;h4 id=&quot;方法一：&quot;&gt;&lt;a href=&quot;#方法一：&quot; class=&quot;headerlink&quot; title=&quot;方法一：&quot;&gt;&lt;/a&gt;方法一：&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;str.isalnum&lt;/code&gt;：&lt;br&gt;S.isalnum() -&amp;gt; bool&lt;br&gt;Return True if all characters in S are alphanumeric and there is at least one character in S, False otherwise.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;string = &lt;span class=&quot;string&quot;&gt;&quot;Special $#! characters   spaces 888323&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;.join(e &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; e &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; string &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; e.isalnum())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&#39;Specialcharactersspaces888323&#39;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;特点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;只能识别字母和数字，杀伤力大，会把中文、空格之类的也干掉
    
    </summary>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-9 Map、Filter、Reduce</title>
    <link href="http://chihweihsu.com/2017/08/09/2017-8-9-Map%E3%80%81Filter%E3%80%81Reduce/"/>
    <id>http://chihweihsu.com/2017/08/09/2017-8-9-Map、Filter、Reduce/</id>
    <published>2017-08-08T16:00:00.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><blockquote>
<p>将一个函数映射到一个输入列表的所有元素上。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">items = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</div><div class="line">squared = list(map(<span class="keyword">lambda</span> x: x**<span class="number">2</span>, items))</div><div class="line"></div><div class="line"><span class="comment"># output:</span></div><div class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</div></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="map作用于一列表的函数："><a href="#map作用于一列表的函数：" class="headerlink" title="map作用于一列表的函数："></a>map作用于一列表的函数：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(x)</span>:</span></div><div class="line">	<span class="keyword">return</span> (x*x)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x)</span>:</span></div><div class="line">	<span class="keyword">return</span> (x+x)</div><div class="line"></div><div class="line">funcs = [multiply, add]</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">5</span>):</div><div class="line">    value = map(<span class="keyword">lambda</span> x: x(i), funcs)</div><div class="line">    print(list(value))</div><div class="line"></div><div class="line"><span class="comment"># Output:</span></div><div class="line"><span class="comment"># [0, 0]</span></div><div class="line"><span class="comment"># [1, 2]</span></div><div class="line"><span class="comment"># [4, 4]</span></div><div class="line"><span class="comment"># [9, 6]</span></div><div class="line"><span class="comment"># [16, 8]</span></div></pre></td></tr></table></figure>
<blockquote>
<p>注：上面<code>print</code>加list转换，是为了python2/3的兼容，在python2中map直接返回列表，但在python3中返回迭代器。</p>
</blockquote>
<h3 id="Filter："><a href="#Filter：" class="headerlink" title="Filter："></a>Filter：</h3><blockquote>
<p>过滤列表元素，返回符合要求的元素所组成的列表；<br>filter类似for循环，但更快。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">number_list = range(<span class="number">-5</span>, <span class="number">5</span>)</div><div class="line">less_than_zero = filter(<span class="keyword">lambda</span> x: x &lt; <span class="number">0</span>, number_list)</div><div class="line">print(list(less_than_zero))  </div><div class="line"></div><div class="line"><span class="comment"># Output: </span></div><div class="line">[<span class="number">-5</span>, <span class="number">-4</span>, <span class="number">-3</span>, <span class="number">-2</span>, <span class="number">-1</span>]</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="Reduce："><a href="#Reduce：" class="headerlink" title="Reduce："></a>Reduce：</h3><blockquote>
<p>对列表进行计算并返回结果。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 计算列表乘积：</span></div><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</div><div class="line">product = reduce( (<span class="keyword">lambda</span> x, y: x * y), [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] )</div><div class="line"></div><div class="line"><span class="comment"># Output: </span></div><div class="line"><span class="number">24</span></div><div class="line"></div><div class="line"><span class="comment"># 计算静默期：</span></div><div class="line">count_times：func，计算静默时间</div><div class="line">blank_ret：list</div><div class="line">reduce(count_times, sorted(blank_ret))</div></pre></td></tr></table></figure></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Map&quot;&gt;&lt;a href=&quot;#Map&quot; class=&quot;headerlink&quot; title=&quot;Map&quot;&gt;&lt;/a&gt;Map&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;将一个函数映射到一个输入列表的所有元素上。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;items = [&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;squared = list(map(&lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; x: x**&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, items))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# output:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;]&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
      <category term="Map" scheme="http://chihweihsu.com/tags/Map/"/>
    
      <category term="Filter" scheme="http://chihweihsu.com/tags/Filter/"/>
    
      <category term="Reduce" scheme="http://chihweihsu.com/tags/Reduce/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-8 profile cProfile 效率分析</title>
    <link href="http://chihweihsu.com/2017/08/08/2017-8-8-profile-cProfile-%E6%95%88%E7%8E%87%E5%88%86%E6%9E%90/"/>
    <id>http://chihweihsu.com/2017/08/08/2017-8-8-profile-cProfile-效率分析/</id>
    <published>2017-08-07T16:00:00.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="test-py："><a href="#test-py：" class="headerlink" title="test.py："></a>test.py：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">process</span><span class="params">(filename)</span>:</span></div><div class="line">	<span class="keyword">print</span> filename</div><div class="line"></div><div class="line"><span class="keyword">for</span> (dirpath, dirnames, filenames) <span class="keyword">in</span> os.walk(sys.argv[<span class="number">1</span>]):</div><div class="line">	<span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</div><div class="line">		process(filename)</div></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="cProfile用法："><a href="#cProfile用法：" class="headerlink" title="cProfile用法："></a>cProfile用法：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 生成.pstats分析文档</span></div><div class="line">python -m cProfile -o profile.pstats test.py /usr</div><div class="line"><span class="comment"># 查看pstats文档</span></div><div class="line">python -m pstats profile.pstats</div><div class="line"><span class="comment"># ?: 查看可用指令；sort cumtime:排序；stats:查看pstats文档</span></div></pre></td></tr></table></figure>
<p><img src="./images/%E4%BB%A3%E7%A0%81%E6%AE%B5.png" alt="enter description here" title="sort keys"></p>
<h3 id="gprof2dot用法"><a href="#gprof2dot用法" class="headerlink" title="gprof2dot用法:"></a><a href="https://github.com/jrfonseca/gprof2dot" target="_blank" rel="external">gprof2dot</a>用法:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 安装 gprof2dot</span></div><div class="line">pip install gprof2dot</div><div class="line"><span class="comment"># 通过.pstats文档生成相应的dot文档</span></div><div class="line">python -m gprof2dot -f pstats profile.pstats</div><div class="line"><span class="comment"># 安装graphviz（centOS系统）</span></div><div class="line">sudo yum install graphviz</div><div class="line"><span class="comment"># 输出png文档</span></div><div class="line">python -m gprof2dot -f pstats profile.pstats | dot -T png -o profile.png</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;test-py：&quot;&gt;&lt;a href=&quot;#test-py：&quot; class=&quot;headerlink&quot; title=&quot;test.py：&quot;&gt;&lt;/a&gt;test.py：&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; os&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(filename)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; filename&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (dirpath, dirnames, filenames) &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; os.walk(sys.argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; filename &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; filenames:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		process(filename)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-7 python args and kwargs</title>
    <link href="http://chihweihsu.com/2017/08/07/2017-8-7-python-args-and-kwargs/"/>
    <id>http://chihweihsu.com/2017/08/07/2017-8-7-python-args-and-kwargs/</id>
    <published>2017-08-06T16:00:00.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="args："><a href="#args：" class="headerlink" title="*args："></a><code>*args</code>：</h3><blockquote>
<p>传递一个非键值对的可变数量的参数列表给一个函数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_var_args</span><span class="params">(f_arg, *argv)</span>:</span></div><div class="line">    print(<span class="string">"first normal arg:"</span>, f_arg)</div><div class="line">    <span class="keyword">for</span> arg <span class="keyword">in</span> argv:</div><div class="line">        print(<span class="string">"another arg through *argv:"</span>, arg)</div><div class="line"></div><div class="line">test_var_args(<span class="string">'yasoob'</span>, <span class="string">'python'</span>, <span class="string">'eggs'</span>, <span class="string">'test'</span>)</div><div class="line"></div><div class="line"><span class="comment"># output：</span></div><div class="line"><span class="comment"># first normal arg: yasoob</span></div><div class="line"><span class="comment"># another arg through *argv: python</span></div><div class="line"><span class="comment"># another arg through *argv: eggs</span></div><div class="line"><span class="comment"># another arg through *argv: test</span></div></pre></td></tr></table></figure></p>
</blockquote>
<a id="more"></a>
<h3 id="kwargs："><a href="#kwargs：" class="headerlink" title="**kwargs："></a><code>**kwargs</code>：</h3><blockquote>
<p>传递不定长度的键值对（字典）, 作为参数传递给一个函数（即传递带名字的参数）。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet_me</span><span class="params">(**kwargs)</span>:</span></div><div class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items():</div><div class="line">        print(<span class="string">"&#123;0&#125; == &#123;1&#125;"</span>.format(key, value))</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>greet_me(name=<span class="string">"yasoob"</span>)</div><div class="line">name == yasoob</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><blockquote>
<p>不是必须写成<code>*args</code>和<code>**kwargs</code>，只有变量前面的 <code>*</code>(星号)才是必须的；可以写成<code>*var</code> 和<code>**vars</code>，写成<code>*args</code> 和<code>**kwargs</code>只是一个通俗的命名约定；<br><code>*args</code>： 顺序不能变动；<code>**kwargs</code>：可以根据键指定顺序。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_args_kwargs</span><span class="params">(arg1, arg2, arg3)</span>:</span></div><div class="line">    print(<span class="string">"arg1:"</span>, arg1)</div><div class="line">    print(<span class="string">"arg2:"</span>, arg2)</div><div class="line">    print(<span class="string">"arg3:"</span>, arg3)</div><div class="line">	</div><div class="line"><span class="comment"># 首先使用 *args</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>args = (<span class="string">"two"</span>, <span class="number">3</span>, <span class="number">5</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>test_args_kwargs(*args)</div><div class="line">arg1: two</div><div class="line">arg2: <span class="number">3</span></div><div class="line">arg3: <span class="number">5</span></div><div class="line"></div><div class="line"><span class="comment"># 现在使用 **kwargs:</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>kwargs = &#123;<span class="string">"arg3"</span>: <span class="number">3</span>, <span class="string">"arg2"</span>: <span class="string">"two"</span>, <span class="string">"arg1"</span>: <span class="number">5</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>test_args_kwargs(**kwargs)</div><div class="line">arg1: <span class="number">5</span></div><div class="line">arg2: two</div><div class="line">arg3: <span class="number">3</span></div></pre></td></tr></table></figure></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;args：&quot;&gt;&lt;a href=&quot;#args：&quot; class=&quot;headerlink&quot; title=&quot;*args：&quot;&gt;&lt;/a&gt;&lt;code&gt;*args&lt;/code&gt;：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;传递一个非键值对的可变数量的参数列表给一个函数。&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;test_var_args&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(f_arg, *argv)&lt;/span&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    print(&lt;span class=&quot;string&quot;&gt;&quot;first normal arg:&quot;&lt;/span&gt;, f_arg)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; arg &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; argv:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        print(&lt;span class=&quot;string&quot;&gt;&quot;another arg through *argv:&quot;&lt;/span&gt;, arg)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;test_var_args(&lt;span class=&quot;string&quot;&gt;&#39;yasoob&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;python&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;eggs&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;test&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# output：&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# first normal arg: yasoob&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# another arg through *argv: python&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# another arg through *argv: eggs&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# another arg through *argv: test&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
      <category term="args" scheme="http://chihweihsu.com/tags/args/"/>
    
      <category term="kwargs" scheme="http://chihweihsu.com/tags/kwargs/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-7 pandas 获取不符合条件的dataframe</title>
    <link href="http://chihweihsu.com/2017/08/07/2017-8-7-pandas-%E8%8E%B7%E5%8F%96%E4%B8%8D%E7%AC%A6%E5%90%88%E6%9D%A1%E4%BB%B6%E7%9A%84dataframe/"/>
    <id>http://chihweihsu.com/2017/08/07/2017-8-7-pandas-获取不符合条件的dataframe/</id>
    <published>2017-08-06T16:00:00.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h2 id="search-for-“does-not-contain”-on-a-dataframe-in-pandas"><a href="#search-for-“does-not-contain”-on-a-dataframe-in-pandas" class="headerlink" title="search for “does-not-contain” on a dataframe in pandas"></a>search for “does-not-contain” on a dataframe in pandas</h2><blockquote>
<p>问题来源：做项目时，想拿到不符合条件的所有数据，比如：通话类型有好多种（主叫、被叫、呼转……），现在想分析所有非主叫数据，那么问题就来了。</p>
</blockquote>
<a id="more"></a>
<h3 id="方法一：df-df-col-str-contains-word"><a href="#方法一：df-df-col-str-contains-word" class="headerlink" title="方法一：df[~df.col.str.contains(word)]"></a>方法一：df[~df.col.str.contains(word)]</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.DataFrame(&#123;<span class="string">"A"</span>: [<span class="string">"Hello"</span>, <span class="string">"this"</span>, <span class="string">"World"</span>, <span class="string">"apple"</span>]&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df.A.str.contains(<span class="string">"Hello|World"</span>)</div><div class="line"><span class="number">0</span>     <span class="keyword">True</span></div><div class="line"><span class="number">1</span>    <span class="keyword">False</span></div><div class="line"><span class="number">2</span>     <span class="keyword">True</span></div><div class="line"><span class="number">3</span>    <span class="keyword">False</span></div><div class="line">Name: A, dtype: bool</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>~df.A.str.contains(<span class="string">"Hello|World"</span>)</div><div class="line"><span class="number">0</span>    <span class="keyword">False</span></div><div class="line"><span class="number">1</span>     <span class="keyword">True</span></div><div class="line"><span class="number">2</span>    <span class="keyword">False</span></div><div class="line"><span class="number">3</span>     <span class="keyword">True</span></div><div class="line">Name: A, dtype: bool</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df[~df.A.str.contains(<span class="string">"Hello|World"</span>)]</div><div class="line">       A</div><div class="line"><span class="number">1</span>   this</div><div class="line"><span class="number">3</span>  apple</div><div class="line"></div><div class="line">[<span class="number">2</span> rows x <span class="number">1</span> columns]</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：</p>
<ul>
<li>似乎 <code>df[~(df.A.str.contains(&quot;Hello&quot;) | (df.A.str.contains(&quot;World&quot;)))]</code>比上面使用正则，速度会快点</li>
<li>获取“非”数据的条数：<code>(~df.col3.str.contains(&#39;u|z&#39;)).sum()</code></li>
</ul>
</blockquote>
<h3 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">df[df[<span class="string">"col"</span>].str.contains(<span class="string">'this'</span>|<span class="string">'that'</span>)==<span class="keyword">False</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.DataFrame(&#123;<span class="string">"A"</span>: [<span class="string">"Hello"</span>, <span class="string">"this"</span>, <span class="string">"World"</span>, <span class="string">"apple"</span>]&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df[df[<span class="string">'A'</span>].str.contains(<span class="string">"Hello|World"</span>)==<span class="keyword">False</span>]</div><div class="line">       A</div><div class="line"><span class="number">1</span>   this</div><div class="line"><span class="number">3</span>  apple</div><div class="line"></div><div class="line"><span class="comment"># 多个条件情况下：</span></div><div class="line"><span class="comment"># df[df["col1"].str.contains('this|that')==False and df["col2"].str.contains('foo|bar')==True]</span></div></pre></td></tr></table></figure>
<h3 id="方法三："><a href="#方法三：" class="headerlink" title="方法三："></a>方法三：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.DataFrame(&#123;<span class="string">"A"</span>: [<span class="string">"Hello"</span>, <span class="string">"this"</span>, <span class="string">"World"</span>, <span class="string">"apple"</span>]&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df[<span class="string">'A'</span>].str.contains(<span class="string">r'^(?:(?!Hello|World).)*$'</span>)</div><div class="line"><span class="number">0</span>    <span class="keyword">False</span></div><div class="line"><span class="number">1</span>     <span class="keyword">True</span></div><div class="line"><span class="number">2</span>    <span class="keyword">False</span></div><div class="line"><span class="number">3</span>     <span class="keyword">True</span></div><div class="line">Name: A, dtype: bool</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>df[df[<span class="string">'A'</span>].str.contains(<span class="string">r'^(?:(?!Hello|World).)*$'</span>)]</div><div class="line">       A</div><div class="line"><span class="number">1</span>   this</div><div class="line"><span class="number">3</span>  apple</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;search-for-“does-not-contain”-on-a-dataframe-in-pandas&quot;&gt;&lt;a href=&quot;#search-for-“does-not-contain”-on-a-dataframe-in-pandas&quot; class=&quot;headerlink&quot; title=&quot;search for “does-not-contain” on a dataframe in pandas&quot;&gt;&lt;/a&gt;search for “does-not-contain” on a dataframe in pandas&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;问题来源：做项目时，想拿到不符合条件的所有数据，比如：通话类型有好多种（主叫、被叫、呼转……），现在想分析所有非主叫数据，那么问题就来了。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
      <category term="pandas" scheme="http://chihweihsu.com/tags/pandas/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-6 python string</title>
    <link href="http://chihweihsu.com/2017/08/06/2017-8-6-python-string/"/>
    <id>http://chihweihsu.com/2017/08/06/2017-8-6-python-string/</id>
    <published>2017-08-05T16:00:00.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h2 id="The-most-pythonic-way-to-pad-zeroes-to-string"><a href="#The-most-pythonic-way-to-pad-zeroes-to-string" class="headerlink" title="The most pythonic way to pad zeroes to string"></a>The most pythonic way to pad zeroes to string</h2><h3 id="Strings"><a href="#Strings" class="headerlink" title="Strings:"></a>Strings:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>n = <span class="string">'4'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>n.zfill(<span class="number">3</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'004'</span></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'&#123;:0&gt;3&#125;'</span>.format(n)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'004'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'&#123;1&#125;&#123;1&#125;&#123;0&#125;'</span>.format(n, <span class="string">'0'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'004'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'&#123;:0&lt;3&#125;'</span>.format(n)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'400'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'&#123;:-^11&#125;'</span>.format(n)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'-----4-----'</span></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>n.rjust(<span class="number">3</span>, <span class="string">'0'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'004'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>n.ljust(<span class="number">3</span>, <span class="string">'0'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'400'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'4'</span>.center(<span class="number">11</span>,<span class="string">"-"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'-----4-----'</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<p><code>rjust/zfill</code> 区别:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">zfill:</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'--txt'</span>.zfill(<span class="number">10</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'-00000-txt'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'++txt'</span>.zfill(<span class="number">10</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'+00000+txt'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'..txt'</span>.zfill(<span class="number">10</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'00000..txt'</span></div><div class="line">rjust:</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'--txt'</span>.rjust(<span class="number">10</span>, <span class="string">'0'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'00000--txt'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'++txt'</span>.rjust(<span class="number">10</span>, <span class="string">'0'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'00000++txt'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'..txt'</span>.rjust(<span class="number">10</span>, <span class="string">'0'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'00000..txt'</span></div></pre></td></tr></table></figure></p>
<h3 id="numbers"><a href="#numbers" class="headerlink" title="numbers:"></a>numbers:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>n = <span class="number">4</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'%03d'</span> % n</div><div class="line"><span class="number">004</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> format(n, <span class="string">'03'</span>) <span class="comment"># python &gt;= 2.6</span></div><div class="line"><span class="number">004</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'&#123;0:03d&#125;'</span>.format(n)  <span class="comment"># python &gt;= 2.6</span></div><div class="line"><span class="number">004</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'&#123;foo:03d&#125;'</span>.format(foo=n)  <span class="comment"># python &gt;= 2.6</span></div><div class="line"><span class="number">004</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">'&#123;:03d&#125;'</span>.format(n))  <span class="comment"># python &gt;= 2.7 + python3</span></div><div class="line"><span class="number">004</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">'&#123;0:03d&#125;'</span>.format(n))  <span class="comment"># python 3</span></div><div class="line"><span class="number">004</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">f'<span class="subst">&#123;n:<span class="number">03</span>&#125;</span>'</span>) <span class="comment"># python &gt;= 3.6</span></div><div class="line"><span class="number">004</span></div></pre></td></tr></table></figure>
<blockquote>
<p> % formatting 已被 string.format 替代</p>
</blockquote>
<h3 id="保留小数位："><a href="#保留小数位：" class="headerlink" title="保留小数位："></a>保留小数位：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">format(value, <span class="string">'.6f'</span>)</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>format(<span class="number">2.0</span>, <span class="string">'.6f'</span>)</div><div class="line"><span class="string">'2.000000'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'&#123;:.6f&#125;'</span>.format(<span class="number">2.0</span>)</div><div class="line"><span class="string">'2.000000'</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;The-most-pythonic-way-to-pad-zeroes-to-string&quot;&gt;&lt;a href=&quot;#The-most-pythonic-way-to-pad-zeroes-to-string&quot; class=&quot;headerlink&quot; title=&quot;The most pythonic way to pad zeroes to string&quot;&gt;&lt;/a&gt;The most pythonic way to pad zeroes to string&lt;/h2&gt;&lt;h3 id=&quot;Strings&quot;&gt;&lt;a href=&quot;#Strings&quot; class=&quot;headerlink&quot; title=&quot;Strings:&quot;&gt;&lt;/a&gt;Strings:&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;n = &lt;span class=&quot;string&quot;&gt;&#39;4&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;n.zfill(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;004&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;:0&amp;gt;3&amp;#125;&#39;&lt;/span&gt;.format(n)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;004&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;1&amp;#125;&amp;#123;1&amp;#125;&amp;#123;0&amp;#125;&#39;&lt;/span&gt;.format(n, &lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;004&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;:0&amp;lt;3&amp;#125;&#39;&lt;/span&gt;.format(n)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;400&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;:-^11&amp;#125;&#39;&lt;/span&gt;.format(n)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;-----4-----&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;n.rjust(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;004&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;n.ljust(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;400&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;4&#39;&lt;/span&gt;.center(&lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;-&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&#39;-----4-----&#39;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-1 python rrule bug</title>
    <link href="http://chihweihsu.com/2017/08/01/2017-8-1-python-rrule-bug/"/>
    <id>http://chihweihsu.com/2017/08/01/2017-8-1-python-rrule-bug/</id>
    <published>2017-07-31T16:00:00.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<p><code>http://dateutil.readthedocs.io/en/stable/_modules/dateutil/rrule.html</code></p>
<h3 id="月份日期超限-BUG"><a href="#月份日期超限-BUG" class="headerlink" title="月份日期超限 BUG"></a>月份日期超限 BUG</h3><blockquote>
<p>Per RFC section 3.3.10, recurrence instances falling on invalid dates and times are ignored rather than coerced:<br>Recurrence rules may generate recurrence instances with an invalid date (e.g., February 30) or nonexistent local time (e.g., 1:30 AM  on a day where the local time is moved forward by an hour at 1:00 AM).<br>Such recurrence instances MUST be ignored and MUST NOT be  counted as part of the recurrence set.</p>
</blockquote>
<a id="more"></a>
<p>This can lead to possibly surprising behavior when, for example, the start date occurs at the end of the month:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> dateutil.rrule <span class="keyword">import</span> rrule, MONTHLY</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>start_date = datetime(<span class="number">2014</span>, <span class="number">12</span>, <span class="number">31</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list(rrule(freq=MONTHLY, count=<span class="number">4</span>, dtstart=start_date))</div><div class="line">[datetime.datetime(<span class="number">2014</span>, <span class="number">12</span>, <span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>),</div><div class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">1</span>, <span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>),</div><div class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">3</span>, <span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>),</div><div class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>)]</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;http://dateutil.readthedocs.io/en/stable/_modules/dateutil/rrule.html&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;月份日期超限-BUG&quot;&gt;&lt;a href=&quot;#月份日期超限-BUG&quot; class=&quot;headerlink&quot; title=&quot;月份日期超限 BUG&quot;&gt;&lt;/a&gt;月份日期超限 BUG&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;Per RFC section 3.3.10, recurrence instances falling on invalid dates and times are ignored rather than coerced:&lt;br&gt;Recurrence rules may generate recurrence instances with an invalid date (e.g., February 30) or nonexistent local time (e.g., 1:30 AM  on a day where the local time is moved forward by an hour at 1:00 AM).&lt;br&gt;Such recurrence instances MUST be ignored and MUST NOT be  counted as part of the recurrence set.&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
      <category term="Bug" scheme="http://chihweihsu.com/tags/Bug/"/>
    
  </entry>
  
  <entry>
    <title>2017-7-31 python set 交集、并集、差集</title>
    <link href="http://chihweihsu.com/2017/07/31/2017-7-31-python-%E4%BA%A4%E9%9B%86%E3%80%81%E5%B9%B6%E9%9B%86%E3%80%81%E5%B7%AE%E9%9B%86/"/>
    <id>http://chihweihsu.com/2017/07/31/2017-7-31-python-交集、并集、差集/</id>
    <published>2017-07-30T16:00:00.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="交集-intersection"><a href="#交集-intersection" class="headerlink" title="交集(intersection)"></a>交集(intersection)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">example：</div><div class="line">valid = set([<span class="string">'yellow'</span>, <span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>, <span class="string">'black'</span>])</div><div class="line">input_set = set([<span class="string">'red'</span>, <span class="string">'brown'</span>]) </div><div class="line">print(input_set.intersection(valid))</div><div class="line"><span class="comment">### 输出：set(['red'])</span></div><div class="line"></div><div class="line"><span class="comment"># 方法一:</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>a=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>b=[<span class="number">2</span>,<span class="number">5</span>,<span class="number">8</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>tmp = [val <span class="keyword">for</span> val <span class="keyword">in</span> a <span class="keyword">if</span> val <span class="keyword">in</span> b]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>tmp</div><div class="line">[<span class="number">2</span>, <span class="number">5</span>]</div><div class="line"></div><div class="line"><span class="comment"># 方法二</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list(set(a).intersection(set(b)))</div><div class="line">[<span class="number">2</span>, <span class="number">5</span>]</div><div class="line"></div><div class="line"><span class="comment"># 方法三：</span></div><div class="line">&gt;&gt;&gt;list(set(a) &amp; set(b))</div><div class="line">[<span class="number">2</span>, <span class="number">5</span>]</div></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="字符串交集"><a href="#字符串交集" class="headerlink" title="字符串交集"></a>字符串交集</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 方法一：</span></div><div class="line"><span class="string">''</span>.join(sorted(set(str1) &amp; set(str2), key = str1.index))</div><div class="line"></div><div class="line"><span class="comment"># 方法二：</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">strIntersection</span><span class="params">(s1, s2)</span>:</span></div><div class="line">  out = <span class="string">""</span></div><div class="line">  <span class="keyword">for</span> c <span class="keyword">in</span> s1:</div><div class="line">    <span class="keyword">if</span> c <span class="keyword">in</span> s2 <span class="keyword">and</span> <span class="keyword">not</span> c <span class="keyword">in</span> out:</div><div class="line">      out += c</div><div class="line">  <span class="keyword">return</span> out</div><div class="line"></div><div class="line"><span class="comment"># 方法三：</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>a=<span class="string">'asdfasdfasfd'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>b=<span class="string">'qazwsxedc'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>set(a).intersection(b)</div><div class="line">set([<span class="string">'a'</span>, <span class="string">'s'</span>, <span class="string">'d'</span>])</div><div class="line"></div><div class="line"><span class="comment"># 方法四：</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hasIntersection</span><span class="params">(a, b)</span>:</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">not</span> set(a).isdisjoint(b)</div></pre></td></tr></table></figure>
<h4 id="最大交集"><a href="#最大交集" class="headerlink" title="最大交集"></a>最大交集</h4><blockquote>
<p>How to find all intersections (also called the longest common substrings) of two strings and their positions in both strings?<br>For example:<br>if S1=”never” and S2=”forever” then resulted intersection must be [“ever”] and its positions are [(1,3)].<br>If S1=”address” and S2=”oddness” then resulted intersections are [“dd”,”ess”] and their positions are [(1,1),(4,4)].</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 方法一：</span></div><div class="line">In [<span class="number">31</span>]: <span class="keyword">import</span> difflib</div><div class="line"></div><div class="line">In [<span class="number">32</span>]: difflib.SequenceMatcher(<span class="keyword">None</span>, <span class="string">"never"</span>, <span class="string">"forever"</span>).get_matching_blocks()</div><div class="line">Out[<span class="number">32</span>]: [Match(a=<span class="number">1</span>, b=<span class="number">3</span>, size=<span class="number">4</span>), Match(a=<span class="number">5</span>, b=<span class="number">7</span>, size=<span class="number">0</span>)]</div><div class="line"></div><div class="line">In [<span class="number">33</span>]: difflib.SequenceMatcher(<span class="keyword">None</span>, <span class="string">"address"</span>, <span class="string">"oddness"</span>).get_matching_blocks()</div><div class="line">Out[<span class="number">33</span>]: [Match(a=<span class="number">1</span>, b=<span class="number">1</span>, size=<span class="number">2</span>), Match(a=<span class="number">4</span>, b=<span class="number">4</span>, size=<span class="number">3</span>), Match(a=<span class="number">7</span>, b=<span class="number">7</span>, size=<span class="number">0</span>)]</div><div class="line"></div><div class="line"><span class="comment"># 方法二：</span></div><div class="line"><span class="keyword">import</span> itertools</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">longest_common_substring</span><span class="params">(s1, s2)</span>:</span></div><div class="line">   set1 = set(s1[begin:end] <span class="keyword">for</span> (begin, end) <span class="keyword">in</span></div><div class="line">              itertools.combinations(range(len(s1)+<span class="number">1</span>), <span class="number">2</span>))</div><div class="line">   set2 = set(s2[begin:end] <span class="keyword">for</span> (begin, end) <span class="keyword">in</span></div><div class="line">              itertools.combinations(range(len(s2)+<span class="number">1</span>), <span class="number">2</span>))</div><div class="line">   common = set1.intersection(set2)</div><div class="line">   maximal = [com <span class="keyword">for</span> com <span class="keyword">in</span> common</div><div class="line">              <span class="keyword">if</span> sum((s.find(com) <span class="keyword">for</span> s <span class="keyword">in</span> common)) == <span class="number">-1</span> * (len(common)<span class="number">-1</span>)]</div><div class="line">   <span class="keyword">return</span> [(s, s1.index(s), s2.index(s)) <span class="keyword">for</span> s <span class="keyword">in</span> maximal]</div><div class="line">   </div><div class="line"><span class="meta">&gt;&gt;&gt; </span>longest_common_substring(<span class="string">'address'</span>, <span class="string">'oddness'</span>)</div><div class="line">[(<span class="string">'dd'</span>, <span class="number">1</span>, <span class="number">1</span>), (<span class="string">'ess'</span>, <span class="number">4</span>, <span class="number">4</span>)]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>longest_common_substring(<span class="string">'never'</span>, <span class="string">'forever'</span>)</div><div class="line">[(<span class="string">'ever'</span>, <span class="number">1</span>, <span class="number">3</span>)]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>longest_common_substring(<span class="string">'call'</span>, <span class="string">'wall'</span>)</div><div class="line">[(<span class="string">'all'</span>, <span class="number">1</span>, <span class="number">1</span>)]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>longest_common_substring(<span class="string">'abcd1234'</span>, <span class="string">'1234abcd'</span>)</div><div class="line">[(<span class="string">'abcd'</span>, <span class="number">0</span>, <span class="number">4</span>), (<span class="string">'1234'</span>, <span class="number">4</span>, <span class="number">0</span>)]</div></pre></td></tr></table></figure>
<h3 id="并集-union"><a href="#并集-union" class="headerlink" title="并集(union)"></a>并集(union)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 方法一：</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list(set(a).union(set(b)))</div><div class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">8</span>]</div><div class="line"></div><div class="line"><span class="comment"># 方法二：</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list(set(b) | (set(a)))</div><div class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">8</span>]</div></pre></td></tr></table></figure>
<h3 id="差集-difference"><a href="#差集-difference" class="headerlink" title="差集(difference)"></a>差集(difference)</h3><blockquote>
<p>差集：找出无效的数据，相当于用一个集合减去另一个集合的数据。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># example：</span></div><div class="line">valid = set([<span class="string">'yellow'</span>, <span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>, <span class="string">'black'</span>])</div><div class="line">input_set = set([<span class="string">'red'</span>, <span class="string">'brown'</span>])</div><div class="line">print(input_set.difference(valid))</div><div class="line"><span class="comment">### 输出: set(['brown'])</span></div><div class="line"></div><div class="line"><span class="comment"># 方法一：</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list(set(b).difference(set(a)))       <span class="comment"># b中有而a中没有的</span></div><div class="line">[<span class="number">8</span>]</div><div class="line"></div><div class="line"><span class="comment"># 方法二：</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>list(set(b) - (set(a)))</div><div class="line">[<span class="number">8</span>]</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="集合操作汇总"><a href="#集合操作汇总" class="headerlink" title="集合操作汇总"></a>集合操作汇总</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>x = set(<span class="string">'abcde'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>y = set(<span class="string">'bdxyz'</span>)</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>x</div><div class="line">set([<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>])                    <span class="comment"># 2.6 display format</span></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'e'</span> <span class="keyword">in</span> x                                      <span class="comment"># Membership 成员</span></div><div class="line"><span class="keyword">True</span></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>x – y                                         <span class="comment"># Difference 差集</span></div><div class="line">set([<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>])</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>x | y                                         <span class="comment"># Union 并集</span></div><div class="line">set([<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'y'</span>, <span class="string">'x'</span>, <span class="string">'z'</span>])</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>x &amp; y                                         <span class="comment"># Intersection 交集</span></div><div class="line">set([<span class="string">'b'</span>, <span class="string">'d'</span>])</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>x ^ y                                         <span class="comment"># Symmetric difference (XOR) 补集</span></div><div class="line">set([<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'y'</span>, <span class="string">'x'</span>, <span class="string">'z'</span>])</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>x &gt; y, x &lt; y                                  <span class="comment"># Superset, subset  父级，子级</span></div><div class="line">(<span class="keyword">False</span>, <span class="keyword">False</span>)</div></pre></td></tr></table></figure>
<h3 id="巨型集合处理（数量在百万，千万甚至更大）"><a href="#巨型集合处理（数量在百万，千万甚至更大）" class="headerlink" title="巨型集合处理（数量在百万，千万甚至更大）"></a>巨型集合处理（数量在百万，千万甚至更大）</h3><blockquote>
<p>方法一：set<br>特点：</p>
<ul>
<li>速度快；</li>
<li>内存消耗大，一个1万个元素的集合，其占用的内存远大于1万 * 每个元素的大小，因为整个set数据结构占用大量其他空间来存储索引之类的东西。</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">并集：s.union(t) 或者 s | t</div><div class="line">交集：s.intersection(t) 或者 s &amp; t</div><div class="line">差集：s.difference(t) 或者 s - t</div></pre></td></tr></table></figure>
<blockquote>
<p>方法二：Numpy<br>特点：</p>
<ul>
<li>先把要操作的元素放在数组而不是set中，同样内容的数组占用的内存比set小的多；占用内存小于set的方式；</li>
<li>速度接近set方式。<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">并集： np.union1d(s, t)    <span class="comment"># 返回排序的、去重的两个list的合集</span></div><div class="line">交集： np.intersect1d(s, t, assume_unique=<span class="keyword">True</span>)    <span class="comment"># 返回排序的、去重的两个list的交集，尽可能保证传入的两个list是去重的，这可以加快运算速度。</span></div><div class="line">差集： np.setdiff1d(s, t, assume_unique=<span class="keyword">True</span>)    <span class="comment"># 返回排序的，去重的差集，assume_unique参数同上。</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>方法三：cmd<br>以上两种方法的缺点就是当集合足够大而内存又不够的时候，会MemoryError（在试验中2000万个长度为24的字符串在4G的内存中就报MemoryError了）；<br>解决办法：使用linux 命令。<br>特点：</p>
<ul>
<li>内存消耗小，会使用临时文件来避免内存问题；</li>
<li>耗时长。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">1.文件排序，使用sort命令：</div><div class="line">sort --buffer-size=1G --output=/path/to/output /path/to/src_file    # --buffer-size在Debian上可用，其他平台未知，不是标准参数.</div><div class="line"></div><div class="line">并集：sort -m /path/to/src1 /path/tosrc2 -u --output=/path/to/result    # 注意src1, src2必须是已排序的文件，而且结果也是已排序的。</div><div class="line">交集：comm -12 file1 file2 &gt; output    # 使用comm命令，注意传入的文件必须都是已排序的。</div><div class="line">差集：comm -3 file1 file2 &gt; output    # 使用comm命令，注意传入的文件必须都是已排序的。</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p>综上，三种方法依次对内存的依赖减小，耗时增加，可依据集合大小以及硬件环境来选择。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;交集-intersection&quot;&gt;&lt;a href=&quot;#交集-intersection&quot; class=&quot;headerlink&quot; title=&quot;交集(intersection)&quot;&gt;&lt;/a&gt;交集(intersection)&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;example：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;valid = set([&lt;span class=&quot;string&quot;&gt;&#39;yellow&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;red&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;blue&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;green&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;black&#39;&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;input_set = set([&lt;span class=&quot;string&quot;&gt;&#39;red&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;brown&#39;&lt;/span&gt;]) &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;print(input_set.intersection(valid))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;### 输出：set([&#39;red&#39;])&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 方法一:&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;a=[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;b=[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;tmp = [val &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; val &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; a &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; val &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; b]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;tmp&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 方法二&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;list(set(a).intersection(set(b)))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 方法三：&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt;&amp;gt;&amp;gt;list(set(a) &amp;amp; set(b))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;]&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>2017-7-31 python 生成器（Generators）</title>
    <link href="http://chihweihsu.com/2017/07/31/2017-7-31-python-%E7%94%9F%E6%88%90%E5%99%A8%EF%BC%88Generators%EF%BC%89/"/>
    <id>http://chihweihsu.com/2017/07/31/2017-7-31-python-生成器（Generators）/</id>
    <published>2017-07-30T16:00:00.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<h3 id="可迭代对象（iterable）："><a href="#可迭代对象（iterable）：" class="headerlink" title="可迭代对象（iterable）："></a>可迭代对象（iterable）：</h3><blockquote>
<p>能提供迭代器的任意对象；只要定义了一个迭代器的<strong>iter</strong>方法或定义了支持下标索引的<strong>getitem</strong>方法，那就是一个可迭代对象。</p>
</blockquote>
<h3 id="迭代器（iterators）："><a href="#迭代器（iterators）：" class="headerlink" title="迭代器（iterators）："></a>迭代器（iterators）：</h3><blockquote>
<p>任意对象，只要定义了next或者<strong>next</strong>方法，那就是一个迭代器</p>
</blockquote>
<h3 id="迭代（iteration）："><a href="#迭代（iteration）：" class="headerlink" title="迭代（iteration）："></a>迭代（iteration）：</h3><blockquote>
<p>从某个地方（如列表）取出一个元素的过程；使用一个循环来遍历某个东西（如列表），这个过程就是迭代；</p>
</blockquote>
<a id="more"></a>
<h3 id="生成器（Generators）："><a href="#生成器（Generators）：" class="headerlink" title="生成器（Generators）："></a>生成器（Generators）：</h3><blockquote>
<p>也是一种迭代器，但只能对其迭代一次</p>
<ul>
<li>因为它们并没有把所有值存在内存中，而是运行时生成值；</li>
<li>可通过遍历使用它们，要么使用“for”循环，要么传递给任意可以进行迭代的函数和结构；</li>
<li>大多时候生成器是以函数实现的，但它们并不返回一个值，而是yield（生出）一个值。<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_function</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">        <span class="keyword">yield</span> i</div><div class="line"></div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> generator_function():</div><div class="line">    print(item)</div><div class="line"></div><div class="line"><span class="comment"># Output: 0</span></div><div class="line"><span class="comment"># 1</span></div><div class="line"><span class="comment"># 2</span></div><div class="line"><span class="comment"># 3</span></div><div class="line"><span class="comment"># 4</span></div><div class="line"><span class="comment"># 5</span></div><div class="line"><span class="comment"># 6</span></div><div class="line"><span class="comment"># 7</span></div><div class="line"><span class="comment"># 8</span></div><div class="line"><span class="comment"># 9</span></div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h4 id="适用场景："><a href="#适用场景：" class="headerlink" title="适用场景："></a>适用场景：</h4><blockquote>
<p>不想同一时间将所有计算出来的大量结果集分配到内存当中，特别是结果集里还包含循环；因为这样做会消耗大量资源<br>许多Python 2里的标准库函数都会返回列表，而Python 3都修改成了返回生成器，因为生成器占用更少的资源。</p>
</blockquote>
<p>**斐波那契数列的生成器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 传统模式</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibon</span><span class="params">(n)</span>:</span></div><div class="line">    a = b = <span class="number">1</span></div><div class="line">    result = []</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        result.append(a)</div><div class="line">        a, b = b, a + b</div><div class="line">    <span class="keyword">return</span> result</div><div class="line"></div><div class="line"><span class="comment"># 生成器模式</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibon</span><span class="params">(n)</span>:</span></div><div class="line">    a = b = <span class="number">1</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">        <span class="keyword">yield</span> a</div><div class="line">        a, b = b, a + b</div><div class="line"></div><div class="line"><span class="comment"># Now we can use it like this:</span></div><div class="line"><span class="keyword">for</span> x <span class="keyword">in</span> fibon(<span class="number">1000000</span>):</div><div class="line">    print(x)</div></pre></td></tr></table></figure>
<h3 id="Python内置函数：next"><a href="#Python内置函数：next" class="headerlink" title="Python内置函数：next()"></a>Python内置函数：<code>next()</code></h3><blockquote>
<p>它允许我们获取一个序列的下一个元素<br>特点：</p>
<ul>
<li>在<code>yield</code>掉所有的值后，<code>next()</code>会触发一个<code>StopIteration</code>的异常。提示我们所有的值都已经被<code>yield</code>完了；</li>
<li>在使用<code>for</code>循环时没有这个异常，因为<code>for</code>循环会自动捕捉到这个异常并停止调用<code>next()</code>。<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_function</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</div><div class="line">        <span class="keyword">yield</span> i</div><div class="line"></div><div class="line">gen = generator_function()</div><div class="line">print(next(gen))</div><div class="line"><span class="comment"># Output: 0</span></div><div class="line">print(next(gen))</div><div class="line"><span class="comment"># Output: 1</span></div><div class="line">print(next(gen))</div><div class="line"><span class="comment"># Output: 2</span></div><div class="line">print(next(gen))</div><div class="line"><span class="comment"># Output: Traceback (most recent call last):</span></div><div class="line"><span class="comment">#         File "&lt;stdin&gt;", line 1, in &lt;module&gt;</span></div><div class="line"><span class="comment">#         StopIteration</span></div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h3 id="Python内置函数：iter"><a href="#Python内置函数：iter" class="headerlink" title="Python内置函数：iter()"></a>Python内置函数：<code>iter()</code></h3><blockquote>
<p>将一个可迭代对象返回一个迭代器对象<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">my_string = <span class="string">"Bingo"</span></div><div class="line">next(my_string)</div><div class="line"><span class="comment"># Output: Traceback (most recent call last):</span></div><div class="line"><span class="comment">#      File "&lt;stdin&gt;", line 1, in &lt;module&gt;</span></div><div class="line"><span class="comment">#    TypeError: str object is not an iterator</span></div></pre></td></tr></table></figure></p>
</blockquote>
<p>这个异常说<code>str</code>对象是一个可迭代对象，而不是一个迭代器；不能直接对其进行迭代操作，所以，使用<code>iter</code>：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">my_string = <span class="string">"Bingo"</span></div><div class="line">my_iter = iter(my_string)</div><div class="line">next(my_iter)</div><div class="line"><span class="comment"># Output: 'B'</span></div><div class="line">next(my_iter)</div><div class="line"><span class="comment"># Output: 'i'</span></div><div class="line">next(my_iter)</div><div class="line"><span class="comment"># Output: 'n'</span></div><div class="line">next(my_iter)</div><div class="line"><span class="comment"># Output: 'g'</span></div><div class="line">next(my_iter)</div><div class="line"><span class="comment"># Output: 'o'</span></div><div class="line">next(my_iter)</div><div class="line"><span class="comment"># Output: Traceback (most recent call last):</span></div><div class="line"><span class="comment">#         File "&lt;stdin&gt;", line 12, in &lt;module&gt;</span></div><div class="line"><span class="comment">#         StopIteration</span></div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;可迭代对象（iterable）：&quot;&gt;&lt;a href=&quot;#可迭代对象（iterable）：&quot; class=&quot;headerlink&quot; title=&quot;可迭代对象（iterable）：&quot;&gt;&lt;/a&gt;可迭代对象（iterable）：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;能提供迭代器的任意对象；只要定义了一个迭代器的&lt;strong&gt;iter&lt;/strong&gt;方法或定义了支持下标索引的&lt;strong&gt;getitem&lt;/strong&gt;方法，那就是一个可迭代对象。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;迭代器（iterators）：&quot;&gt;&lt;a href=&quot;#迭代器（iterators）：&quot; class=&quot;headerlink&quot; title=&quot;迭代器（iterators）：&quot;&gt;&lt;/a&gt;迭代器（iterators）：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;任意对象，只要定义了next或者&lt;strong&gt;next&lt;/strong&gt;方法，那就是一个迭代器&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;迭代（iteration）：&quot;&gt;&lt;a href=&quot;#迭代（iteration）：&quot; class=&quot;headerlink&quot; title=&quot;迭代（iteration）：&quot;&gt;&lt;/a&gt;迭代（iteration）：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;从某个地方（如列表）取出一个元素的过程；使用一个循环来遍历某个东西（如列表），这个过程就是迭代；&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>2017-05-24 建站日志（二）</title>
    <link href="http://chihweihsu.com/2017/05/24/2017-05-24-%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>http://chihweihsu.com/2017/05/24/2017-05-24-建站日志（二）/</id>
    <published>2017-05-24T13:09:54.000Z</published>
    <updated>2017-08-28T10:40:36.848Z</updated>
    
    <content type="html"><![CDATA[<div class="note info"><p>到此，建站告一段落，功能差不多完善了 </p>
</div>
<a id="more"></a>
<h3 id="2017-05-24："><a href="#2017-05-24：" class="headerlink" title="2017-05-24："></a><strong>2017-05-24：</strong></h3><h3 id="Bootstrap-Callout的巨坑BUG"><a href="#Bootstrap-Callout的巨坑BUG" class="headerlink" title="Bootstrap Callout的巨坑BUG"></a>Bootstrap Callout的巨坑BUG</h3><hr>
<p>在今天新增添加评论后，部署完成后发现，界面变成如下：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-24_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E4%B9%B1%E7%A0%81.png" alt=""><br>完全乱码了，真是…<br>经过一晚上排查，发现原因出在：Markdown开头我使用了<code>Bootstrap Callout</code>语句，中间写了其他代码，结尾又再次使用了<code>Bootstrap Callout</code>语句，如下图：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-24_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E4%B9%B1%E7%A0%81BUG.png" alt=""><br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-24_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E4%B9%B1%E7%A0%81BUG2.png" alt=""><br>把结尾的<code>Bootstrap Callout</code>语句去掉之后，一切又恢复了正常。<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-24_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E4%B9%B1%E7%A0%81%E6%AD%A3%E5%B8%B8.png" alt=""></p>
<p>难道<code>Bootstrap Callout</code>语句一篇文章只能使用一次？？？</p>
<p>为了验证，做了如下测试：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-24_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E4%B9%B1%E7%A0%81BUG4.png" alt=""><br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-24_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E4%B9%B1%E7%A0%81BUG3.png" alt=""><br>果然如此，真是绝了…<br>对了，连下面这种情况（<code>Bootstrap Callout</code>）也不能出现，出现了也算一次：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">`&#123;% note info %&#125; ... &#123;% endnote %&#125;` #单引号小代码块</div></pre></td></tr></table></figure></p>
<h3 id="添加评论"><a href="#添加评论" class="headerlink" title="添加评论"></a>添加评论</h3><hr>
<p>这里我用的是<code>Hypercomments</code>，国外的一个第三方评论平台，好处之一就是可以支持匿名评论，不用登录就可以进行评论，取代即将入土的多说。</p>
<p>1.<code>Next</code>主题已经集成了<code>Hypercomments</code>，只需到<a href="https://www.hypercomments.com/" target="_blank" rel="external">Hypercomments</a>注册一个账号，绑定网站入口，拿到<code>widget_id</code>即可。<br>具体位置如下：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-24_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_Hypercomments.png" alt=""></p>
<p>代码中找到<code>widget_id:xxxxx</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">widget:&quot;Stream&quot;, widget_id: xxxxx</div></pre></td></tr></table></figure></p>
<p>2.修改<code>主题配置文件</code>，找到如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Hypercomments</div><div class="line">#hypercomments_id:</div></pre></td></tr></table></figure></p>
<p>3.取消注释，将拿到的<code>widget_id</code>填入，即可。<br>预览：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-24_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E8%AF%84%E8%AE%BA%E6%A0%8F.png" alt=""></p>
<h3 id="使用七牛做图片图床"><a href="#使用七牛做图片图床" class="headerlink" title="使用七牛做图片图床"></a>使用七牛做图片图床</h3><hr>
<p>为了提高页面加载速度，方便图片管理，将博客所有图片均同步到七牛云，制成外链，加到博客中。</p>
<p>步骤很简单，注册一个七牛云账号，新建一个存储空间，将用到的图片传上去，拿到外链，写博客时，如下使用就可以了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">![](http://ohhmsby4v.bkt.clouddn.com/image/2017-05-24_%E5%BB.png)</div></pre></td></tr></table></figure></p>
<h3 id="2017-05-21："><a href="#2017-05-21：" class="headerlink" title="2017-05-21："></a><strong>2017-05-21：</strong></h3><h3 id="Markdown内置标签"><a href="#Markdown内置标签" class="headerlink" title="Markdown内置标签"></a>Markdown内置标签</h3><hr>
<h4 id="文本居中的引用"><a href="#文本居中的引用" class="headerlink" title="文本居中的引用"></a>文本居中的引用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;!-- HTML方式: 直接在 Markdown 文件中编写 HTML 来调用 --&gt;</div><div class="line">&lt;!-- 其中 class=&quot;blockquote-center&quot; 是必须的 --&gt;</div><div class="line">&lt;blockquote class=&quot;blockquote-center&quot;&gt;blah blah blah&lt;/blockquote&gt;</div><div class="line"></div><div class="line">&lt;!-- 标签 方式，要求版本在0.4.5或以上 --&gt;</div><div class="line">&#123;% centerquote %&#125;blah blah blah&#123;% endcenterquote %&#125;</div><div class="line"></div><div class="line">&lt;!-- 标签别名 --&gt;</div><div class="line">&#123;% cq %&#125; blah blah blah &#123;% endcq %&#125;</div></pre></td></tr></table></figure>
<p>预览：<br><blockquote class="blockquote-center"><p>人的一切痛苦，本质上都是对自己的无能的愤怒。 </p>
</blockquote></p>
<h4 id="突破容器宽度限制的图片"><a href="#突破容器宽度限制的图片" class="headerlink" title="突破容器宽度限制的图片"></a>突破容器宽度限制的图片</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;!-- HTML方式: 直接在 Markdown 文件中编写 HTML 来调用 --&gt;</div><div class="line">&lt;!-- 其中 class=&quot;full-image&quot; 是必须的 --&gt;</div><div class="line">&lt;img src=&quot;/image-url&quot; class=&quot;full-image&quot; /&gt;</div><div class="line"></div><div class="line">&lt;!-- 标签 方式，要求版本在0.4.5或以上 --&gt;</div><div class="line">&#123;% fullimage /image-url, alt, title %&#125;</div><div class="line"></div><div class="line">&lt;!-- 别名 --&gt;</div><div class="line">&#123;% fi /image-url, alt, title %&#125;</div></pre></td></tr></table></figure>
<p>预览：<br><span itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"><img itemprop="url image" src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-21_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_full_img1.jpg" class="full-image" alt="alt" title="时光"><meta itemprop="width" content="auto"><meta itemprop="height" content="auto"></span></p>
<h4 id="Bootstrap-Callout"><a href="#Bootstrap-Callout" class="headerlink" title="Bootstrap Callout"></a>Bootstrap Callout</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;% note class_name %&#125; Content (md partial supported) &#123;% endnote %&#125;</div><div class="line">&#123;% note %&#125; Content (md partial supported of **none**) &#123;% endnote %&#125;</div><div class="line">&#123;% note default %&#125; Content (md partial supported of **default**) &#123;% endnote %&#125;</div><div class="line">&#123;% note primary %&#125; Content (md partial supported of **primary**) &#123;% endnote %&#125;</div><div class="line">&#123;% note success %&#125; Content (md partial supported of **success**) &#123;% endnote %&#125;</div><div class="line">&#123;% note info %&#125; Content (md partial supported of **info**) &#123;% endnote %&#125;</div><div class="line">&#123;% note warning %&#125; Content (md partial supported of **warning**) &#123;% endnote %&#125;</div><div class="line">&#123;% note danger %&#125; Content (md partial supported of **danger**) &#123;% endnote %&#125;</div></pre></td></tr></table></figure>
<p>* <code>class_name</code>可以为：<code>default</code>、<code>primary</code>、<code>success</code>、<code>info</code>、<code>warning</code>、<code>danger</code>，也可以为空。<br>预览：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-21_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_Bootstrap%20Callout.png" alt=""></p>
<blockquote class="blockquote-center">完</blockquote>

]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;note info&quot;&gt;&lt;p&gt;到此，建站告一段落，功能差不多完善了 &lt;/p&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="Notes" scheme="http://chihweihsu.com/categories/Notes/"/>
    
      <category term="Hexo" scheme="http://chihweihsu.com/categories/Notes/Hexo/"/>
    
    
      <category term="Hexo" scheme="http://chihweihsu.com/tags/Hexo/"/>
    
      <category term="Blog" scheme="http://chihweihsu.com/tags/Blog/"/>
    
  </entry>
  
  <entry>
    <title>2017-05-23 一个逗号(,)引起的BUG</title>
    <link href="http://chihweihsu.com/2017/05/23/2017-05-23-%E4%B8%80%E4%B8%AA%E9%80%97%E5%8F%B7-%E5%BC%95%E8%B5%B7%E7%9A%84BUG/"/>
    <id>http://chihweihsu.com/2017/05/23/2017-05-23-一个逗号-引起的BUG/</id>
    <published>2017-05-23T14:45:11.000Z</published>
    <updated>2017-08-28T10:40:36.847Z</updated>
    
    <content type="html"><![CDATA[<p>昨天工作，突然发现之前好好的list，在赋值给新变量后居然类型变了，一个好好的list几分钟不见妥妥的叛变了，变成了tuple，由此，一场闹剧开始上演…<br><a id="more"></a></p>
<h3 id="前情回要："><a href="#前情回要：" class="headerlink" title="前情回要："></a>前情回要：</h3><p>话说有一个类对象内有一方法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def call_frequency(self, data):</div><div class="line">    ...</div><div class="line">    return list</div></pre></td></tr></table></figure></p>
<p>返回的是一个list，内部是一个个dict，结构如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[&#123;xx:xxx,xx:xxx&#125;,&#123;xx:xxx,&#125;,&#123;x:xxx&#125;,...]</div></pre></td></tr></table></figure></p>
<h3 id="闹剧上演："><a href="#闹剧上演：" class="headerlink" title="闹剧上演："></a>闹剧上演：</h3><p> ok，开始今天任务，开始在另一方法中调用赋值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data_list = self.call_frequency(data)</div></pre></td></tr></table></figure></p>
<p>结果<code>print data_list</code>，返回值如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">([&#123;xx:xxx,xx:xxx&#125;,&#123;xx:xxx,&#125;,&#123;x:xxx&#125;,...],)</div></pre></td></tr></table></figure></p>
<p>what a fxxk，瞬间，凌乱了，还以为发现新天地了，啊！原来，list赋值后会变成tuple，加个马甲，以前怎么没发现呢…<br>还自以为是的在调用<code>data_list</code>时，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">call_tel_list = [v.get(&quot;call_tel&quot;,&quot;&quot;) for v in data_list[0]]</div></pre></td></tr></table></figure></p>
<h3 id="惊天逆转"><a href="#惊天逆转" class="headerlink" title="惊天逆转"></a>惊天逆转</h3><p>晚上，回家，比较得意，欸，又学到一招，不错哟，积蓄，努力。</p>
<p>8小时后，天亮了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data_list = self.call_frequency(data),</div></pre></td></tr></table></figure></p>
<p>咦，这里怎么有个逗号？</p>
<p>瞬间，懵逼…</p>
<p>四下瞅瞅，</p>
<p>然后，按下←，整个世界清静了，再悄悄把昨天的杰作恢复本来面目，</p>
<p>嗯，今天，天气真好。</p>
<p>真的！</p>
<blockquote class="blockquote-center">完</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;昨天工作，突然发现之前好好的list，在赋值给新变量后居然类型变了，一个好好的list几分钟不见妥妥的叛变了，变成了tuple，由此，一场闹剧开始上演…&lt;br&gt;
    
    </summary>
    
      <category term="BUG" scheme="http://chihweihsu.com/categories/BUG/"/>
    
    
      <category term="Python" scheme="http://chihweihsu.com/tags/Python/"/>
    
      <category term="list" scheme="http://chihweihsu.com/tags/list/"/>
    
      <category term="tuple" scheme="http://chihweihsu.com/tags/tuple/"/>
    
  </entry>
  
  <entry>
    <title>2017-05-17 Markdown 常用语法</title>
    <link href="http://chihweihsu.com/2017/05/17/2017-05-17-Markdown-%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95/"/>
    <id>http://chihweihsu.com/2017/05/17/2017-05-17-Markdown-常用语法/</id>
    <published>2017-05-17T13:46:29.000Z</published>
    <updated>2017-08-28T10:40:36.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="标题-一"><a href="#标题-一" class="headerlink" title="标题(一)"></a>标题(一)</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># 一级标题</div><div class="line">## 二级标题</div><div class="line">### 三级标题</div><div class="line">#### 四级标题</div><div class="line">##### 五级标题</div><div class="line">###### 六级标题</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>效果：</p>
<p><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-18_markdown%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95_%E6%A0%87%E9%A2%981.png" alt=""></p>
<hr>
<h2 id="标题-二"><a href="#标题-二" class="headerlink" title="标题(二)"></a>标题(二)</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">标题（#）</div><div class="line">==</div><div class="line">标题（##）</div><div class="line">--</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<p><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-18_markdown%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95_%E6%A0%87%E9%A2%982.png" alt=""></p>
<hr>
<h2 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- 文本1</div><div class="line">   * 二级文本</div><div class="line">- 文本2</div><div class="line">- 文本3</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<ul>
<li>文本1<ul>
<li>二级文本</li>
</ul>
</li>
<li>文本2</li>
<li>文本3</li>
</ul>
</blockquote>
<hr>
<h2 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1. 文本1</div><div class="line">2. 文本2</div><div class="line">3. 文本3</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<ol>
<li>文本1</li>
<li>文本2</li>
<li>文本3</li>
</ol>
</blockquote>
<hr>
<h2 id="文字链接"><a href="#文字链接" class="headerlink" title="文字链接"></a>文字链接</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[显示文本](链接地址)</div><div class="line">[悟の迹](http://chihweihsu.com/)</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p> <a href="http://chihweihsu.com/">悟の迹</a></p>
</blockquote>
<hr>
<h2 id="自动链接"><a href="#自动链接" class="headerlink" title="自动链接"></a>自动链接</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;http://chihweihsu.com/&gt;</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p> <a href="http://chihweihsu.com/">http://chihweihsu.com/</a></p>
</blockquote>
<hr>
<h2 id="参考式链接"><a href="#参考式链接" class="headerlink" title="参考式链接"></a>参考式链接</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">I get 10 times more traffic from [Google] [1] than from [Yahoo] [2] or [MSN] [3],</div><div class="line">but most traffic is [悟の迹] [4].</div><div class="line"></div><div class="line">  [1]: http://google.com/        &quot;Google&quot;</div><div class="line">  [2]: http://search.yahoo.com/  &quot;Yahoo Search&quot;</div><div class="line">  [3]: http://search.msn.com/    &quot;MSN Search&quot;</div><div class="line">  [4]: http://chihweihsu.com/    &quot;悟の迹&quot;</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p>I get 10 times more traffic from <a href="http://google.com/" title="Google" target="_blank" rel="external">Google</a> than from <a href="http://search.yahoo.com/" title="Yahoo Search" target="_blank" rel="external">Yahoo</a> or <a href="http://search.msn.com/" title="MSN Search" target="_blank" rel="external">MSN</a>, but most traffic is <a href="http://chihweihsu.com/" title="悟の迹">悟の迹</a>.</p>
</blockquote>
<hr>
<h2 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">![alt text](图片链接 &quot;title&quot;)</div><div class="line">![悟](http://ohhmsby4v.bkt.clouddn.com/image/%E6%82%9F.jpg)</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p> <img src="http://ohhmsby4v.bkt.clouddn.com/image/%E6%82%9F.jpg" alt="悟"></p>
</blockquote>
<hr>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">`code`</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p> <code>code</code></p>
</blockquote>
<hr>
<h2 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h2><p>代码（去空格）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">` ` `</div><div class="line">  code</div><div class="line">` ` `</div></pre></td></tr></table></figure></p>
<p>效果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">code</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; 引用文字</div><div class="line">&gt;</div><div class="line">&gt; &gt; 二级引用文字</div><div class="line">&gt;</div><div class="line">&gt; 引用文字</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p>引用文字</p>
<blockquote>
<p>二级引用文字</p>
</blockquote>
<p>引用文字</p>
</blockquote>
<hr>
<h2 id="斜体"><a href="#斜体" class="headerlink" title="斜体"></a>斜体</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">*斜体文字*</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p><em>斜体文字</em></p>
</blockquote>
<hr>
<h2 id="粗体"><a href="#粗体" class="headerlink" title="粗体"></a>粗体</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">**粗体文字**</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p><strong>粗体文字</strong></p>
</blockquote>
<hr>
<h2 id="粗斜体"><a href="#粗斜体" class="headerlink" title="粗斜体"></a>粗斜体</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">***粗斜体***</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p><strong><em>粗斜体</em></strong></p>
</blockquote>
<hr>
<h2 id="删除线"><a href="#删除线" class="headerlink" title="删除线"></a>删除线</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">~~删除线~~</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p><del>删除线</del></p>
</blockquote>
<hr>
<h2 id="注脚"><a href="#注脚" class="headerlink" title="注脚"></a>注脚</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">这是一个注脚[^footnote1]的样例</div><div class="line">[^1]: 我就是悟</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<p>这是一个注脚[^footnote1]的样例</p>
<blockquote>
<p>[^1]: 我就是悟</p>
</blockquote>
<hr>
<h2 id="表格-一"><a href="#表格-一" class="headerlink" title="表格(一)"></a>表格(一)</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">| Tables        | Are            | Cool       |</div><div class="line">| -----         | :-----:        | -----:     |</div><div class="line">| col 3 is      | right-aligned  | $1600      |</div><div class="line">| col 2 is      | center         | $12        |</div><div class="line">| zebra stipes  | are neat       | $1         |</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<table>
<thead>
<tr>
<th>Tables</th>
<th style="text-align:center">Are</th>
<th style="text-align:right">Cool</th>
</tr>
</thead>
<tbody>
<tr>
<td>col 3 is</td>
<td style="text-align:center">right-aligned</td>
<td style="text-align:right">$1600</td>
</tr>
<tr>
<td>col 2 is</td>
<td style="text-align:center">center</td>
<td style="text-align:right">$12</td>
</tr>
<tr>
<td>zebra stipes</td>
<td style="text-align:center">are neat</td>
<td style="text-align:right">$1</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="表格-二"><a href="#表格-二" class="headerlink" title="表格(二)"></a>表格(二)</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">dog | bird | cat</div><div class="line">----|------|-----</div><div class="line">foo | foo  | foo</div><div class="line">bar | bar  | bar</div><div class="line">baz | baz  | baz</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<table>
<thead>
<tr>
<th>dog</th>
<th>bird</th>
<th>cat</th>
</tr>
</thead>
<tbody>
<tr>
<td>foo</td>
<td>foo</td>
<td>foo</td>
</tr>
<tr>
<td>bar</td>
<td>bar</td>
<td>bar</td>
</tr>
<tr>
<td>baz</td>
<td>baz</td>
<td>baz</td>
</tr>
</tbody>
</table>
</blockquote>
<hr>
<h2 id="转义"><a href="#转义" class="headerlink" title="转义"></a>转义</h2><p>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">\*悟の迹\*</div><div class="line"></div><div class="line">支持以下符号转义：</div><div class="line">\   反斜线</div><div class="line">`   反引号</div><div class="line">*   星号</div><div class="line">_   底线</div><div class="line">&#123;&#125;  花括号</div><div class="line">[]  方括号</div><div class="line">()  括弧</div><div class="line">#   井字号</div><div class="line">+   加号</div><div class="line">-   减号</div><div class="line">.   英文句点</div><div class="line">!   惊叹号</div><div class="line">&gt;   大于号</div></pre></td></tr></table></figure></p>
<p>效果：</p>
<blockquote>
<p>*悟の迹*</p>
</blockquote>
<p>最近访客</p>
<div class="ds-recent-visitors" data-num-items="39" data-avatar-size="40" id="ds-recent-visitors"></div>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;标题-一&quot;&gt;&lt;a href=&quot;#标题-一&quot; class=&quot;headerlink&quot; title=&quot;标题(一)&quot;&gt;&lt;/a&gt;标题(一)&lt;/h2&gt;&lt;p&gt;代码：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;# 一级标题&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;## 二级标题&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;### 三级标题&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#### 四级标题&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;##### 五级标题&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;###### 六级标题&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Notes" scheme="http://chihweihsu.com/categories/Notes/"/>
    
      <category term="Markdown" scheme="http://chihweihsu.com/categories/Notes/Markdown/"/>
    
    
      <category term="Markdown" scheme="http://chihweihsu.com/tags/Markdown/"/>
    
      <category term="速查" scheme="http://chihweihsu.com/tags/%E9%80%9F%E6%9F%A5/"/>
    
  </entry>
  
  <entry>
    <title>2017-05-17 建站日志</title>
    <link href="http://chihweihsu.com/2017/05/17/2017-05-17-%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97/"/>
    <id>http://chihweihsu.com/2017/05/17/2017-05-17-建站日志/</id>
    <published>2017-05-17T13:39:02.000Z</published>
    <updated>2017-08-28T10:40:36.847Z</updated>
    
    <content type="html"><![CDATA[<div class="note success"><p>未完待续… </p>
</div>
<a id="more"></a>
<h3 id="2017-05-19："><a href="#2017-05-19：" class="headerlink" title="2017-05-19："></a><strong>2017-05-19：</strong></h3><h3 id="添加新-Page"><a href="#添加新-Page" class="headerlink" title="添加新 Page"></a>添加新 Page</h3><hr>
<p>1.用如下命令添加新page:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">hexo new page &quot;categories&quot;</div><div class="line">hexo new page &quot;tags&quot;</div><div class="line">hexo new page &quot;Python&quot;</div><div class="line">hexo new page &quot;Linux&quot;</div><div class="line">hexo new page &quot;Notes&quot;</div><div class="line">hexo new page &quot;Something&quot;</div><div class="line">hexo new page &quot;Links&quot;</div><div class="line">hexo new page &quot;About&quot;</div></pre></td></tr></table></figure>
<p>2.打开<code>主题配置文件``\themes\next\_config.yml</code>文件，在<code>menu</code>中添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">menu:</div><div class="line">  home: /</div><div class="line">  archives: /archives</div><div class="line">  categories: /categories</div><div class="line">  tags: /tags</div><div class="line">  Python: /Python</div><div class="line">  Linux: /Linux</div><div class="line">  Notes: /Notes</div><div class="line">  Something: /Something</div><div class="line">  Links: /Links</div><div class="line">  About: /About</div></pre></td></tr></table></figure></p>
<p>3.打开<code>\themes\next\languages\zh-Hans.yml</code>，修改<code>menu</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">menu:</div><div class="line">  home: 首页</div><div class="line">  archives: 归档</div><div class="line">  categories: 分类</div><div class="line">  tags: 标签</div><div class="line">  python: Python</div><div class="line">  linux: Linux</div><div class="line">  notes: 笔记</div><div class="line">  something: 有料</div><div class="line">  links: 链接</div><div class="line">  about: 关于</div></pre></td></tr></table></figure></p>
<p>*注意这里第一列必须全为小写。</p>
<p>*这是简体中文的配置文件，如果你的博客用的是其他语言，请打开对应的文件。</p>
<h3 id="修改blog页面配色"><a href="#修改blog页面配色" class="headerlink" title="修改blog页面配色"></a>修改blog页面配色</h3><hr>
<h4 id="添加自定义颜色"><a href="#添加自定义颜色" class="headerlink" title="添加自定义颜色"></a>添加自定义颜色</h4><p>打开<code>\themes\next\source\css\ _variables\base.styl</code>文件，修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// Colors</div><div class="line">// colors for use across theme.</div><div class="line">// --------------------------------------------------</div><div class="line">$whitesmoke   = #f5f5f5</div><div class="line">$gainsboro    = #eee</div><div class="line">$gray-lighter = #ddd</div><div class="line">$grey-light   = #ccc</div><div class="line">$grey         = #bbb</div><div class="line">$grey-dark    = #999</div><div class="line">$grey-dim     = #666</div><div class="line">$black-light  = #555</div><div class="line">$black-dim    = #333</div><div class="line">$black-deep   = #222</div><div class="line">$red          = #ff2a2a</div><div class="line">$blue-bright  = #87daff</div><div class="line">$blue         = #0684bd</div><div class="line">$blue-deep    = #262a30</div><div class="line">$orange       = #fc6423</div><div class="line">// 下面是我自定义的颜色</div><div class="line">$my-link-blue = #0593d3  //链接颜色</div><div class="line">$my-link-hover-blue = #0477ab  //鼠标悬停后颜色</div><div class="line">$my-code-foreground = #dd0055  // 用``围出的代码块字体颜色</div><div class="line">$my-code-background = #eee  // 用``围出的代码块背景颜色</div></pre></td></tr></table></figure></p>
<h4 id="修改超链接颜色"><a href="#修改超链接颜色" class="headerlink" title="修改超链接颜色"></a>修改超链接颜色</h4><p>还是<code>base.styl</code>文件，修改这几行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// Global link color.</div><div class="line">$link-color                   = $my-link-blue</div><div class="line">$link-hover-color             = $my-link-hover-blue</div><div class="line">$link-decoration-color        = $gray-lighter</div><div class="line">$link-decoration-hover-color  = $my-link-hover-blue</div></pre></td></tr></table></figure></p>
<p>预览：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-19_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E8%B6%85%E9%93%BE%E6%8E%A5.png" alt=""></p>
<h4 id="修改小型代码块颜色"><a href="#修改小型代码块颜色" class="headerlink" title="修改小型代码块颜色"></a>修改小型代码块颜色</h4><p>依旧是<code>base.styl</code>文件，修改<code>$code-background</code>和<code>$code-foreground</code>的值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// Code &amp; Code Blocks</div><div class="line">// 用``围出的代码块</div><div class="line">// --------------------------------------------------</div><div class="line">$code-font-family               = $font-family-monospace</div><div class="line">$code-font-size                 = 15px</div><div class="line">$code-background                = $my-code-background</div><div class="line">$code-foreground                = $my-code-foreground</div><div class="line">$code-border-radius             = 4px</div></pre></td></tr></table></figure></p>
<p>预览：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-19_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E4%BB%A3%E7%A0%81%E5%9D%97.png" alt=""></p>
<h3 id="修改blog页面字体大小"><a href="#修改blog页面字体大小" class="headerlink" title="修改blog页面字体大小"></a>修改blog页面字体大小</h3><hr>
<p>打开<code>\themes\next\source\css\ _variables\base.styl</code>文件，找到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// Font size</div><div class="line">$font-size-base           = 14px</div></pre></td></tr></table></figure></p>
<p>改为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$font-size-base           = 16px</div></pre></td></tr></table></figure></p>
<h3 id="修改blog页面宽度"><a href="#修改blog页面宽度" class="headerlink" title="修改blog页面宽度"></a>修改blog页面宽度</h3><hr>
<p>现在一般都用宽屏显示器，博客页面两侧留白太多，调整一下宽度。</p>
<p>1.打开<code>\themes\next\source\css\_common\components\post\post-expand.styl</code>，找到:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@media (max-width: 767px)</div></pre></td></tr></table></figure></p>
<p>改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@media (max-width: 1080px)</div></pre></td></tr></table></figure></p>
<p>2.打开<code>\themes\next\source\css\ _variables\base.styl</code>文件，找到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$main-desktop                   = 960px</div><div class="line">$main-desktop-large             = 1200px</div><div class="line">$content-desktop                = 700px</div></pre></td></tr></table></figure></p>
<p>改为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$main-desktop                   = 1080px</div><div class="line">$main-desktop-large             = 1200px</div><div class="line">$content-desktop                = 810px</div></pre></td></tr></table></figure></p>
<h3 id="修改博客部署的message"><a href="#修改博客部署的message" class="headerlink" title="修改博客部署的message"></a>修改博客部署的message</h3><hr>
<p>在<code>\node_modules\hexo-deployer-git\lib\deployer.js</code>文件末尾找到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Site updated: &#123;&#123; now(&apos;YYYY-MM-DD HH:mm:ss&apos;) &#125;&#125;</div></pre></td></tr></table></figure></p>
<p>改得个性化一点：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">好家伙又改版了悟の迹: &#123;&#123; now(&apos;YYYY-MM-DD HH:mm:ss&apos;) &#125;&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Github项目主页添加README"><a href="#Github项目主页添加README" class="headerlink" title="Github项目主页添加README"></a>Github项目主页添加README</h3><hr>
<h4 id="问题原因："><a href="#问题原因：" class="headerlink" title="问题原因："></a>问题原因：</h4><p>Github上博客的仓库主页没有README，如果把<code>README.md</code>放入<code>source</code>文件夹，<code>hexo g</code>生成时会被解析成html文件，而放到<code>public</code>文件夹中，生成时又会自动删除。</p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法:"></a>解决方法:</h4><p>在<code>source</code>目录下新建文件<code>README.mdown</code>，在里面写README即可。<code>hexo g</code>会把它复制到<code>public</code>文件夹，且不会被解析成html</p>
<h3 id="Github项目主页添加LICENSE"><a href="#Github项目主页添加LICENSE" class="headerlink" title="Github项目主页添加LICENSE"></a>Github项目主页添加LICENSE</h3><hr>
<p>修改<code>主题配置文件</code>，找到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Creative Commons 4.0 International License.</div><div class="line"># http://creativecommons.org/</div><div class="line"># Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero</div><div class="line">creative_commons: by-nc-sa</div><div class="line">#creative_commons:</div></pre></td></tr></table></figure></p>
<p>将其中第 4 行的注释放开，然后选择你想使用的 LICENSE 即可，可选项参照第 3 行。</p>
<h3 id="SEO优化"><a href="#SEO优化" class="headerlink" title="SEO优化"></a>SEO优化</h3><hr>
<p>为优化SEO，更改首页标题格式为「关键词-网站名称 - 网站描述」</p>
<p>打开<code>\themes\next\layout\index.swig</code>文件，找到这行代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% block title %&#125; &#123;&#123; config.title &#125;&#125; &#123;% endblock %&#125;</div></pre></td></tr></table></figure></p>
<p>把它改成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% block title %&#125;</div><div class="line">  &#123;&#123; theme.keywords &#125;&#125; - &#123;&#123; config.title &#125;&#125; - &#123;&#123; theme.description &#125;&#125;</div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure></p>
<h3 id="添加“Fork-me-on-Github”-ribbon"><a href="#添加“Fork-me-on-Github”-ribbon" class="headerlink" title="添加“Fork me on Github” ribbon"></a>添加“Fork me on Github” ribbon</h3><hr>
<p>1.点击<a href="https://github.com/blog/273-github-ribbons" target="_blank" rel="external">Fork me on Github</a>；</p>
<p>2.给blog主页选择一个绶带（ribbon），并复制相应代码；</p>
<p>3.找到正在使用的<code>theme</code>下的<code>layout</code>文件，将代码插入即可；</p>
<p>4.比如我选择了<code>红色</code>的ribbon，使用的<code>themes</code>为next，那么只要打开 <code>blog\themes\next\layout\_layout.swig</code>文件，复制下面这段代码，放在最后，标签之前即可。（注意将<code>https://github.com/you</code>改为你自己的github链接）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;a href=&quot;https://github.com/you&quot;&gt;</div><div class="line">    &lt;img style=&quot;position: absolute; top: 0; right: 0; border: 0;&quot; src=&quot;https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67&quot;</div><div class="line">    alt=&quot;Fork me on GitHub&quot; data-canonical-src=&quot;https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png&quot;&gt;</div><div class="line">&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<h3 id="添加404公益页面"><a href="#添加404公益页面" class="headerlink" title="添加404公益页面"></a>添加404公益页面</h3><hr>
<p>在<code>blog/source</code>下新建自己的<code>404.html</code>文件即可，强推<a href="http://www.qq.com/404/" target="_blank" rel="external">腾讯公益404</a>，代码可参考如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">layout: default</div><div class="line">---</div><div class="line">&lt;html&gt;</div><div class="line">    &lt;head&gt;</div><div class="line">         &lt;meta charset=&quot;UTF-8&quot; /&gt;</div><div class="line">         &lt;title&gt;404&lt;/title&gt;</div><div class="line">    &lt;/head&gt;</div><div class="line">    &lt;body&gt;</div><div class="line">         &lt;script type=&quot;text/javascript&quot; src=&quot;//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js&quot; charset=&quot;utf-8&quot; homePageUrl=&quot;http://chihweihsu.com/&quot; homePageName=&quot;回到悟の迹&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<h3 id="文章阅读次数统计"><a href="#文章阅读次数统计" class="headerlink" title="文章阅读次数统计"></a>文章阅读次数统计</h3><hr>
<p>1.注册<a href="https://leancloud.cn/dashboard/login.html#/signup" target="_blank" rel="external">LeanCloud</a>帐号并验证邮箱；</p>
<p>2.创建应用，新建一个应用来专门进行博客的访问统计的数据操作；</p>
<p>3.创建完成之后我们点击新创建的应用的名字来进行该应用的参数配置；</p>
<p>4.新建一个Class用来专门保存我们博客的文章访问量等数据；</p>
<p>5.新建Class名字必须为Counter，设置默认的ACL权限，建议在此处选择无限制；</p>
<p>6.选择左侧的<code>应用Key</code>选项，拿到我们创建应用的<code>AppID</code>以及<code>AppKey</code>；</p>
<p>7.编辑 <code>主题配置文件</code>，如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">leancloud_visitors:</div><div class="line">  enable: true</div><div class="line">  app_id: joaeuuc4hsqudUUwx4gIvGF6-gzGzoHsz</div><div class="line">  app_key: E9UJsJpw1omCHuS22PdSpKoh</div></pre></td></tr></table></figure></p>
<p>8.ok，部署后可见。</p>
<h3 id="2017-05-18："><a href="#2017-05-18：" class="headerlink" title="2017-05-18："></a><strong>2017-05-18：</strong></h3><h3 id="配置导航栏网站小图标"><a href="#配置导航栏网站小图标" class="headerlink" title="配置导航栏网站小图标"></a>配置导航栏网站小图标</h3><hr>
<p>挑选一张图片，名字改为<code>favicon.ico</code>，放到<code>..\blog\source</code>下，配置<code>主题配置文件</code>如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">favicon: /favicon.ico</div></pre></td></tr></table></figure></p>
<h3 id="集成百度分享模块"><a href="#集成百度分享模块" class="headerlink" title="集成百度分享模块"></a>集成百度分享模块</h3><hr>
<p>首先，编辑 <code>站点配置文件</code>，末尾添加字段:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">baidushare: true #百度分享功能</div></pre></td></tr></table></figure></p>
<p>其次，编辑<code>主题配置文件</code>，找到如下代码位置，去掉最后两行#注释，并选择展示方式，建议slide悬浮状态：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Baidu Share</div><div class="line"># Available value:</div><div class="line">#    button | slide</div><div class="line"># Warning: Baidu Share does not support https.</div><div class="line">baidushare:</div><div class="line"> type: slide #百度分享展示的方式button|slide</div></pre></td></tr></table></figure></p>
<p>*注意：百度分享不支持https方式，可以自己买个域名绑定，或者搜下<code>百度分享不支持https的解决方案</code>，有前辈做出解答。</p>
<p>其实，现在已经完成了；但是，为了折腾，我们接着来自定义百度分享的显示，点击<a href="http://share.baidu.com/code" target="_blank" rel="external">代码获取</a>，一步步进行定制，走完流程，点击<code>直接获取代码</code>，拿到一段js代码，类似如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">    window._bd_share_config = &#123;</div><div class="line">        &quot;common&quot;: &#123;</div><div class="line">            &quot;bdSnsKey&quot;: &#123;&#125;,</div><div class="line">            &quot;bdText&quot;: &quot;&quot;,</div><div class="line">            &quot;bdMini&quot;: &quot;2&quot;,</div><div class="line">            &quot;bdMiniList&quot;: [</div><div class="line">                &quot;mshare&quot;,</div><div class="line">                &quot;bdysc&quot;,</div><div class="line">                &quot;evernotecn&quot;,</div><div class="line">                &quot;tqq&quot;,</div><div class="line">                &quot;weixin&quot;,</div><div class="line">                &quot;sqq&quot;,</div><div class="line">                &quot;qzone&quot;,</div><div class="line">                &quot;douban&quot;,</div><div class="line">                &quot;tsina&quot;,</div><div class="line">                &quot;tieba&quot;,</div><div class="line">                &quot;youdao&quot;,</div><div class="line">                &quot;isohu&quot;,</div><div class="line">                &quot;mail&quot;,</div><div class="line">                &quot;ty&quot;,</div><div class="line">                &quot;fbook&quot;,</div><div class="line">                &quot;twi&quot;,</div><div class="line">                &quot;linkedin&quot;,</div><div class="line">                &quot;copy&quot;,</div><div class="line">                &quot;print&quot;</div><div class="line">            ],</div><div class="line">            &quot;bdPic&quot;: &quot;&quot;,</div><div class="line">            &quot;bdStyle&quot;: &quot;0&quot;,</div><div class="line">            &quot;bdSize&quot;: &quot;16&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;slide&quot;: &#123;</div><div class="line">            &quot;type&quot;: &quot;slide&quot;,</div><div class="line">            &quot;bdImg&quot;: &quot;5&quot;,</div><div class="line">            &quot;bdPos&quot;: &quot;right&quot;,</div><div class="line">            &quot;bdTop&quot;: &quot;53.5&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;image&quot;: &#123;</div><div class="line">            &quot;viewList&quot;: [</div><div class="line">                &quot;weixin&quot;,</div><div class="line">                &quot;qzone&quot;,</div><div class="line">                &quot;tsina&quot;,</div><div class="line">                &quot;evernotecn&quot;,</div><div class="line">                &quot;douban&quot;,</div><div class="line">                &quot;bdysc&quot;</div><div class="line">            ],</div><div class="line">            &quot;viewText&quot;: &quot;分享到：&quot;,</div><div class="line">            &quot;viewSize&quot;: &quot;16&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;selectShare&quot;: &#123;</div><div class="line">            &quot;bdContainerClass&quot;: null,</div><div class="line">            &quot;bdSelectMiniList&quot;: [</div><div class="line">                &quot;weixin&quot;,</div><div class="line">                &quot;qzone&quot;,</div><div class="line">                &quot;tsina&quot;,</div><div class="line">                &quot;evernotecn&quot;,</div><div class="line">                &quot;douban&quot;,</div><div class="line">                &quot;bdysc&quot;</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>最后，打开如下文件<code>blog\themes\next\layout\_partials\share\baidushare.swing</code>，替换掉里面的js代码，本文以<code>slide</code>模式为例，替换掉<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% elseif theme.baidushare.type === &quot;slide&quot; %&#125;</div></pre></td></tr></table></figure></p>
<p>后面的<code>&lt;script&gt;...&lt;/script&gt;</code>即可。</p>
<h3 id="2017-05-17："><a href="#2017-05-17：" class="headerlink" title="2017-05-17："></a><strong>2017-05-17：</strong></h3><h3 id="markdown写文章时，添加居中引用模块"><a href="#markdown写文章时，添加居中引用模块" class="headerlink" title="markdown写文章时，添加居中引用模块"></a>markdown写文章时，添加居中引用模块</h3><hr>
<p>只需在写文章时，添加如下标签即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;blockquote class=&quot;blockquote-center&quot;&gt;</div><div class="line">    优秀的人，不是不合群，而是他们合群的人里面没有你</div><div class="line">&lt;/blockquote&gt;</div></pre></td></tr></table></figure></p>
<p>预览：</p>
<blockquote class="blockquote-center">优秀的人，不是不合群，而是他们合群的人里面没有你</blockquote>


<h3 id="2017-05-16："><a href="#2017-05-16：" class="headerlink" title="2017-05-16："></a><strong>2017-05-16：</strong></h3><h3 id="首页文章预览添加图片"><a href="#首页文章预览添加图片" class="headerlink" title="首页文章预览添加图片"></a>首页文章预览添加图片</h3><hr>
<p>打开<code>scaffolds/post.md</code>文件，在默认参数中添加如下参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 首页文章预览添加图片：</div><div class="line">photos:</div><div class="line">    - http://xxx.com/photo1.jpg</div><div class="line">    - http://xxx.com/photo2.jpg</div></pre></td></tr></table></figure></p>
<p>预览：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-17_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_pandas.png" alt=""></p>
<h3 id="首页文章摘要模式"><a href="#首页文章摘要模式" class="headerlink" title="首页文章摘要模式"></a>首页文章摘要模式</h3><hr>
<p>首页开启文章摘要模式，不全文显示，而是出现<code>阅读全文&gt;</code>，只需在<code>主题配置文件</code>中找到<code>auto_excerpt</code>属性进行配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Automatically Excerpt. Not recommend.</div><div class="line"># Please use &lt;!-- more --&gt; in the post to control excerpt accurately.</div><div class="line">auto_excerpt:</div><div class="line">  enable: true #改写为true</div><div class="line">  length: 150 #默认展示的高度</div></pre></td></tr></table></figure></p>
<p>或者，在Markdown文章中不想显示的位置，添加如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">这里显示</div><div class="line">&lt;!--more--&gt;</div><div class="line">这里不显示</div></pre></td></tr></table></figure></p>
<p>预览：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-05-17_%E5%BB%BA%E7%AB%99%E6%97%A5%E5%BF%97_%E9%98%85%E8%AF%BB%E5%85%A8%E6%96%87.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;note success&quot;&gt;&lt;p&gt;未完待续… &lt;/p&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="Notes" scheme="http://chihweihsu.com/categories/Notes/"/>
    
      <category term="Hexo" scheme="http://chihweihsu.com/categories/Notes/Hexo/"/>
    
    
      <category term="Hexo" scheme="http://chihweihsu.com/tags/Hexo/"/>
    
      <category term="Blog" scheme="http://chihweihsu.com/tags/Blog/"/>
    
  </entry>
  
</feed>
