<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>悟の迹</title>
  
  <subtitle>You are my sunshine!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://chihweihsu.com/"/>
  <updated>2019-01-08T12:38:04.000Z</updated>
  <id>https://chihweihsu.com/</id>
  
  <author>
    <name>Chihwei·Hsu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Attention</title>
    <link href="https://chihweihsu.com/2019/01/08/Attention/"/>
    <id>https://chihweihsu.com/2019/01/08/Attention/</id>
    <published>2019-01-08T23:00:00.000Z</published>
    <updated>2019-01-08T12:38:04.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="本站最新文章，请点击左侧更多"><a href="#本站最新文章，请点击左侧更多" class="headerlink" title="本站最新文章，请点击左侧更多"></a><center>本站最新文章，请点击左侧<strong>更多</strong></center></h3><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;本站最新文章，请点击左侧更多&quot;&gt;&lt;a href=&quot;#本站最新文章，请点击左侧更多&quot; class=&quot;headerlink&quot; title=&quot;本站最新文章，请点击左侧更多&quot;&gt;&lt;/a&gt;&lt;center&gt;本站最新文章，请点击左侧&lt;strong&gt;更多&lt;/strong&gt;&lt;/center&gt;&lt;/h3&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
    
      <category term="notice" scheme="https://chihweihsu.com/tags/notice/"/>
    
  </entry>
  
  <entry>
    <title>2017-10-16 The unit test and mock in python</title>
    <link href="https://chihweihsu.com/2017/10/16/2017-10-16-The-unit-test-and-mock-in-python/"/>
    <id>https://chihweihsu.com/2017/10/16/2017-10-16-The-unit-test-and-mock-in-python/</id>
    <published>2017-10-16T22:48:19.000Z</published>
    <updated>2018-02-24T08:53:20.046Z</updated>
    
    <content type="html"><![CDATA[<h3 id="mock-功效"><a href="#mock-功效" class="headerlink" title="mock 功效"></a>mock 功效</h3><a id="more"></a><h4 id="完成功能测试"><a href="#完成功能测试" class="headerlink" title="完成功能测试"></a>完成功能测试</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># module.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Count</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, a, b)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># test.py</span></span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> mock</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> module <span class="keyword">import</span> Count</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MockDemo</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">(self)</span>:</span></span><br><span class="line">        count = Count()</span><br><span class="line">        count.add = mock.Mock(return_value=<span class="number">13</span>, side_effect=count.add)       </span><br><span class="line"><span class="comment"># side_effect参数和return_value是相反的。它给mock分配了可替换的结果，覆盖了return_value。简单的说，一个模拟工厂调用将返回side_effect值，而不是return_value；所以，设置side_effect参数为Count类add()方法，那么return_value的作用失效。</span></span><br><span class="line">        result = count.add(<span class="number">8</span>, <span class="number">8</span>)</span><br><span class="line">        print(result)</span><br><span class="line"><span class="comment"># 将会真正的调用add()方法，得到的返回值为16（8+8）。通过print打印结果。</span></span><br><span class="line">        count.add.assert_called_with(<span class="number">8</span>, <span class="number">8</span>)</span><br><span class="line"><span class="comment"># 检查mock方法是否获得了正确的参数。</span></span><br><span class="line">        self.assertEqual(result, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure><h4 id="解决测试依赖"><a href="#解决测试依赖" class="headerlink" title="解决测试依赖"></a>解决测试依赖</h4><blockquote><p>例如，我们要测试A模块，然后A模块依赖于B模块的调用。但是，由于B模块的改变，导致了A模块返回结果的改变，从而使A模块的测试用例失败。其实，对于A模块，以及A模块的用例来说，并没有变化，不应该失败才对。这个时候就是mock发挥作用的时候了。通过mock模拟掉影响A模块的部分（B模块）。至于mock掉的部分（B模块）应该由其它用例来测试。</p></blockquote><blockquote><p>add_and_multiply()函数依赖了multiply()函数的返回值<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># function.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_and_multiply</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    addition = x + y</span><br><span class="line">    multiple = multiply(x, y)</span><br><span class="line">    <span class="keyword">return</span> (addition, multiple)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x * y</span><br><span class="line"></span><br><span class="line"><span class="comment"># test.py</span></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> function</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add_and_multiply</span><span class="params">(self)</span>:</span></span><br><span class="line">        x = <span class="number">3</span></span><br><span class="line">        y = <span class="number">5</span></span><br><span class="line">        addition, multiple = function.add_and_multiply(x, y)</span><br><span class="line">        self.assertEqual(<span class="number">8</span>, addition)</span><br><span class="line">        self.assertEqual(<span class="number">15</span>, multiple)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>修改multiply()函数的代码，这样测试会失败<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x * y + <span class="number">3</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>把 multiply()函数mock掉，解决依赖<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> unittest.mock <span class="keyword">import</span> patch</span><br><span class="line"><span class="keyword">import</span> function</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTestCase</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @patch("function.multiply")</span></span><br><span class="line"><span class="comment"># patch()装饰/上下文管理器可以很容易地模拟类或对象在模块测试。在测试过程中，您指定的对象将被替换为一个模拟（或其他对象），并在测试结束时还原。这里模拟function.py文件中multiply()函数。</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add_and_multiply2</span><span class="params">(self, mock_multiply)</span>:</span></span><br><span class="line"><span class="comment"># 在定义测试用例中，将mock的multiply()函数（对象）重命名为 mock_multiply对象。</span></span><br><span class="line">        x = <span class="number">3</span></span><br><span class="line">        y = <span class="number">5</span></span><br><span class="line">        mock_multiply.return_value = <span class="number">15</span></span><br><span class="line"><span class="comment"># 设定mock_multiply对象的返回值为固定的15。</span></span><br><span class="line">        addition, multiple = function.add_and_multiply(x, y)</span><br><span class="line">        mock_multiply.assert_called_once_with(<span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"><span class="comment"># 检查mock_multiply方法的参数是否正确。</span></span><br><span class="line"></span><br><span class="line">        self.assertEqual(<span class="number">8</span>, addition)</span><br><span class="line">        self.assertEqual(<span class="number">15</span>, multiple)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="Mock-attributes-in-Python-mock"><a href="#Mock-attributes-in-Python-mock" class="headerlink" title="Mock attributes in Python mock?"></a>Mock attributes in Python mock?</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> patch(<span class="string">'requests.post'</span>) <span class="keyword">as</span> patched_post:</span><br><span class="line">    type(patched_post.return_value).ok = PropertyMock(return_value=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><h3 id="Mock-session-in-requests-library？"><a href="#Mock-session-in-requests-library？" class="headerlink" title="Mock session in requests library？"></a>Mock session in requests library？</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_session_get</span><span class="params">()</span>:</span></span><br><span class="line">    session = requests.session()</span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'foo'</span>).status_code</span><br><span class="line"></span><br><span class="line"><span class="comment"># tests.py</span></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> mock</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> main <span class="keyword">import</span> do_session_get</span><br><span class="line"></span><br><span class="line"><span class="comment"># The module of we mock, return the exact data that we expected</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mocked_requests</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    <span class="comment"># print args</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MockResponse</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, status_code, text, json_data=None, content=None)</span>:</span></span><br><span class="line">            self.json_data = json_data</span><br><span class="line">            self.status_code = status_code</span><br><span class="line">            self.text = text</span><br><span class="line">            self.content = content</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">json</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.json_data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args[<span class="number">0</span>] == <span class="string">'foo'</span>:</span><br><span class="line">        <span class="keyword">return</span> MockResponse(<span class="number">200</span>, <span class="string">'success'</span>)</span><br><span class="line">    <span class="keyword">elif</span> args[<span class="number">0</span>] == <span class="string">'http://someurl.com/'</span>:</span><br><span class="line">        <span class="keyword">return</span> MockResponse(<span class="number">200</span>, <span class="string">'success'</span>)</span><br><span class="line">    <span class="keyword">return</span> MockResponse(<span class="number">404</span>, <span class="string">'-1'</span>)</span><br><span class="line"><span class="comment"># from main import do_session_get</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDoSessionGet</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"><span class="meta">    @mock.patch('requests.session')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_should_mock_session_get</span><span class="params">(self, mocked_session)</span>:</span></span><br><span class="line">        mocked_session.return_value = mock.MagicMock(get=mock.MagicMock(side_effect=mocked_requests))</span><br><span class="line">        <span class="comment"># print do_session_get()</span></span><br><span class="line">        self.assertEqual(do_session_get(), <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure><h3 id="assert-常用断言速查"><a href="#assert-常用断言速查" class="headerlink" title="assert 常用断言速查"></a>assert 常用断言速查</h3><table><thead><tr><th>项目</th><th>举例</th></tr></thead><tbody><tr><td>assertEqual(a, b)</td><td>a == b</td></tr><tr><td>assertNotEqual(a, b)</td><td>a != b</td></tr><tr><td>assertGreater(a, b)</td><td>a &gt; b</td></tr><tr><td>assertGreaterEqual(a, b)</td><td>a &gt;= b</td></tr><tr><td>assertLess(a, b)</td><td>a &lt; b</td></tr><tr><td>assertLessEqual(a, b)</td><td>a &lt;= b</td></tr><tr><td>assertTrue(x)</td><td>bool(x) is True</td></tr><tr><td>assertFalse(x)</td><td>bool(x) is False</td></tr><tr><td>assertIs(a, b)</td><td>a is b</td></tr><tr><td>assertIsNot(a, b)</td><td>a is not b</td></tr><tr><td>assertIsNone(x)</td><td>x is None</td></tr><tr><td>assertIsNotNone(x)</td><td>x is not None</td></tr><tr><td>assertIn(a, b)</td><td>a in b</td></tr><tr><td>assertNotIn(a, b)</td><td>a not in b</td></tr><tr><td>assertIsInstance(a, b)</td><td>isinstance(a, b)</td></tr><tr><td>assertNotIsInstance(a, b)</td><td>not isinstance(a, b)</td></tr></tbody></table><h3 id="干货：mock模板（requests）"><a href="#干货：mock模板（requests）" class="headerlink" title="干货：mock模板（requests）"></a>干货：mock模板（requests）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># common_test.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> mock</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">If the module is import from others files, like:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">from my.great.package import FlowType</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Then, we should do this, below:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Now we must patch 'my.great.package.requests.get'</span></span><br><span class="line"><span class="string">@mock.patch('my.great.package.requests.get', side_effect=mocked_requests)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">instead of "@mock.patch('common_test.requests.get', side_effect=mocked_requests)"</span></span><br><span class="line"><span class="string">because the requests module was imported in that file</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># The module that need unittest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlowType</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">flow_type</span><span class="params">(self)</span>:</span></span><br><span class="line">        url = <span class="string">'http://chihweihsu.com/'</span></span><br><span class="line">        resp = requests.get(url)</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="comment"># The data of we mock</span></span><br><span class="line">mock_status_code = <span class="number">200</span></span><br><span class="line">mock_text = <span class="string">'You are my sunshine!'</span></span><br><span class="line">mock_json = &#123;<span class="string">'data'</span>: <span class="string">'You are my sunshine!'</span>&#125;</span><br><span class="line">mock_content = <span class="string">'You are my sunshine!'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The module of we mock, return the exact data that we expected</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mocked_requests</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MockResponse</span><span class="params">(object)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, status_code, text, json_data=None, content=None)</span>:</span></span><br><span class="line">            self.json_data = json_data</span><br><span class="line">            self.status_code = status_code</span><br><span class="line">            self.text = text</span><br><span class="line">            self.content = content</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">json</span><span class="params">(self)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.json_data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args[<span class="number">0</span>] == <span class="string">'http://chihweihsu.com/'</span>:</span><br><span class="line">        <span class="keyword">return</span> MockResponse(mock_status_code, mock_text, json_data=mock_json, content=mock_content)</span><br><span class="line">    <span class="keyword">elif</span> args[<span class="number">0</span>] == <span class="string">'http://someurl.com/'</span>:</span><br><span class="line">        <span class="keyword">return</span> MockResponse(<span class="number">200</span>, <span class="string">'success'</span>)</span><br><span class="line">    <span class="keyword">return</span> MockResponse(<span class="number">404</span>, <span class="string">'-1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The whole test case module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCommon</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># We patch 'common_test.requests.get' with our own method. The mock object is passed in to our test case method.</span></span><br><span class="line"><span class="meta">    @mock.patch('common_test.requests.get', side_effect=mocked_requests)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_flow_type</span><span class="params">(self, mocked_get)</span>:</span></span><br><span class="line">        f = FlowType()</span><br><span class="line">        resp = f.flow_type()</span><br><span class="line">        self.assertIsNotNone(resp)</span><br><span class="line">        self.assertEqual(resp.status_code, mock_status_code)</span><br><span class="line">        self.assertIs(resp.text, mock_text)</span><br><span class="line">        self.assertIn(resp.content, mock_content)</span><br><span class="line">        self.assertDictEqual(resp.json(), mock_json)</span><br><span class="line">        self.assertIsInstance(resp.json(), dict)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;mock-功效&quot;&gt;&lt;a href=&quot;#mock-功效&quot; class=&quot;headerlink&quot; title=&quot;mock 功效&quot;&gt;&lt;/a&gt;mock 功效&lt;/h3&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="unittest" scheme="https://chihweihsu.com/tags/unittest/"/>
    
      <category term="mock" scheme="https://chihweihsu.com/tags/mock/"/>
    
      <category term="单元测试" scheme="https://chihweihsu.com/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
    
      <category term="挡板" scheme="https://chihweihsu.com/tags/%E6%8C%A1%E6%9D%BF/"/>
    
      <category term="测试" scheme="https://chihweihsu.com/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>2017-10-16 描述统计学笔记（Udacity）</title>
    <link href="https://chihweihsu.com/2017/10/16/2017-10-16-%E6%8F%8F%E8%BF%B0%E7%BB%9F%E8%AE%A1%E5%AD%A6%E7%AC%94%E8%AE%B0%EF%BC%88Udacity%EF%BC%89/"/>
    <id>https://chihweihsu.com/2017/10/16/2017-10-16-描述统计学笔记（Udacity）/</id>
    <published>2017-10-16T22:48:19.000Z</published>
    <updated>2018-02-24T08:53:20.046Z</updated>
    
    <content type="html"><![CDATA[<h3 id="how-would-you-measure-memory"><a href="#how-would-you-measure-memory" class="headerlink" title="how would you measure memory?"></a>how would you measure memory?</h3><blockquote><ol><li>maybe can ask some question like what’s food you eat yesterday,2 days ago, 5 days ago, 10days ago…</li><li>give you a article,test how much time you take to keep in mind the whole article</li><li>give you 1 hours, test how many words that you keep in mind<a id="more"></a></li></ol></blockquote><p>### </p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;how-would-you-measure-memory&quot;&gt;&lt;a href=&quot;#how-would-you-measure-memory&quot; class=&quot;headerlink&quot; title=&quot;how would you measure memory?&quot;&gt;&lt;/a&gt;how would you measure memory?&lt;/h3&gt;&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;maybe can ask some question like what’s food you eat yesterday,2 days ago, 5 days ago, 10days ago…&lt;/li&gt;
&lt;li&gt;give you a article,test how much time you take to keep in mind the whole article&lt;/li&gt;
&lt;li&gt;give you 1 hours, test how many words that you keep in mind
    
    </summary>
    
      <category term="数据分析" scheme="https://chihweihsu.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
      <category term="描述统计学" scheme="https://chihweihsu.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/%E6%8F%8F%E8%BF%B0%E7%BB%9F%E8%AE%A1%E5%AD%A6/"/>
    
    
      <category term="统计学" scheme="https://chihweihsu.com/tags/%E7%BB%9F%E8%AE%A1%E5%AD%A6/"/>
    
      <category term="数据分析" scheme="https://chihweihsu.com/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>2017-9-28 Python 编码之禅</title>
    <link href="https://chihweihsu.com/2017/09/28/2017-9-28-Python-%E7%BC%96%E7%A0%81%E4%B9%8B%E7%A6%85/"/>
    <id>https://chihweihsu.com/2017/09/28/2017-9-28-Python-编码之禅/</id>
    <published>2017-09-28T18:39:44.000Z</published>
    <updated>2018-02-24T08:53:20.049Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote><p>平时工作中经常碰到编码、解码、乱码……类似的问题不胜其烦，如街边小广告一般异常讨厌，需要花时间好好整理一番，“一”绝后患。</p></blockquote><a id="more"></a><p>str(s)与unicode(s)</p><blockquote><p>str(s)和unicode(s)是两个工厂方法，分别返回str字符串对象和unicode字符串对象；<br>str(s)是s.encode(‘ascii’)的简写；<br>unicode(s)是s.decode(‘ascii’)的简写；</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">str</span><br><span class="line">str(object=<span class="string">''</span>)</span><br><span class="line">str(object=<span class="string">b''</span>, encoding=<span class="string">'utf-8'</span>, errors=<span class="string">'strict'</span>)</span><br><span class="line"></span><br><span class="line">object - object whose informal representation <span class="keyword">is</span> to be returned</span><br><span class="line">encoding - Defaults of UTF<span class="number">-8.</span> Encoding of the given object</span><br><span class="line">errors - response when decoding fails. There are six types of error response：</span><br><span class="line">strict - default response which raises a UnicodeDecodeError exception on failure</span><br><span class="line">ignore - ignores the unencodable unicode <span class="keyword">from</span> the result</span><br><span class="line">replace - replaces the unencodable unicode to a question mark ?</span><br><span class="line">xmlcharrefreplace - inserts XML character reference instead of unencodable unicode</span><br><span class="line">backslashreplace - inserts a \uNNNN espace sequence instead of unencodable unicode</span><br><span class="line">namereplace - inserts a \N&#123;...&#125; escape sequence instead of unencodable unicode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3 = <span class="string">u"你好"</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3 </span><br><span class="line"><span class="string">u'\u4f60\u597d'</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(s3) </span><br><span class="line">Traceback (most recent call last): </span><br><span class="line">File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt; </span><br><span class="line">UnicodeEncodeError: <span class="string">'ascii'</span> codec can<span class="string">'t encode characters in position 0-1: ordinal not in range(128)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">上面s3是unicode类型的字符串，str(s3)相当于是执行s3.encode(‘ascii’)因为“你好”两个汉字不能用ascii码来表示，所以就报错了，指定正确的编码：s3.encode(‘gbk’)或者s3.encode("utf-8")就不会出现这个问题了。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">类似的unicode有同样的错误：</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; s4 = "你好" </span></span><br><span class="line"><span class="string">&gt;&gt;&gt; unicode(s4) </span></span><br><span class="line"><span class="string">Traceback (most recent call last): </span></span><br><span class="line"><span class="string">File "&lt;stdin&gt;", line 1, in &lt;module&gt; </span></span><br><span class="line"><span class="string">UnicodeDecodeError: '</span>ascii<span class="string">' codec can'</span>t decode byte <span class="number">0xc4</span> <span class="keyword">in</span> position <span class="number">0</span>: ordinal <span class="keyword">not</span> <span class="keyword">in</span> range(<span class="number">128</span>) </span><br><span class="line"></span><br><span class="line">unicode(s4)等效于s4.decode(‘ascii’)，因此要正确的转换就要正确指定其编码s4.decode(‘gbk’)或者s4.decode(<span class="string">"utf-8"</span>)。</span><br></pre></td></tr></table></figure><p>### </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">20</span>]: <span class="string">'中文'</span></span><br><span class="line">Out[<span class="number">20</span>]: <span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">21</span>]: <span class="string">u'中文'</span></span><br><span class="line">Out[<span class="number">21</span>]: <span class="string">u'\u4e2d\u6587'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">29</span>]: <span class="keyword">print</span> <span class="string">'中文'</span></span><br><span class="line">中文</span><br><span class="line"></span><br><span class="line">In [<span class="number">30</span>]: <span class="keyword">print</span> <span class="string">u'中文'</span></span><br><span class="line">中文</span><br><span class="line"></span><br><span class="line">In [<span class="number">34</span>]: <span class="keyword">print</span> <span class="string">'\u4e2d\u6587'</span></span><br><span class="line">\u4e2d\u6587</span><br><span class="line"></span><br><span class="line">In [<span class="number">35</span>]: <span class="keyword">print</span> <span class="string">u'\u4e2d\u6587'</span></span><br><span class="line">中文</span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: <span class="string">u'中文'</span>.encode(<span class="string">'gb2312'</span>)</span><br><span class="line">Out[<span class="number">26</span>]: <span class="string">'\xd6\xd0\xce\xc4'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">27</span>]: <span class="string">u'中文'</span>.encode(<span class="string">'gbk'</span>)</span><br><span class="line">Out[<span class="number">27</span>]: <span class="string">'\xd6\xd0\xce\xc4'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">28</span>]: <span class="string">u'中文'</span>.encode(<span class="string">'utf8'</span>)</span><br><span class="line">Out[<span class="number">28</span>]: <span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span></span><br></pre></td></tr></table></figure><p>问题：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">41</span>]: <span class="string">'中文'</span>.encode(<span class="string">'utf8'</span>)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">UnicodeDecodeError                        Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-41</span><span class="number">-94</span>bb800b6371&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 '中文'.encode('utf8')</span><br><span class="line"></span><br><span class="line">UnicodeDecodeError: <span class="string">'ascii'</span> codec can<span class="string">'t decode byte 0xe4 in position 0: ordinal not in range(128)</span></span><br></pre></td></tr></table></figure></p><p>解决办法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;平时工作中经常碰到编码、解码、乱码……类似的问题不胜其烦，如街边小广告一般异常讨厌，需要花时间好好整理一番，“一”绝后患。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="decode" scheme="https://chihweihsu.com/tags/decode/"/>
    
      <category term="encode" scheme="https://chihweihsu.com/tags/encode/"/>
    
      <category term="总结" scheme="https://chihweihsu.com/tags/%E6%80%BB%E7%BB%93/"/>
    
      <category term="编码" scheme="https://chihweihsu.com/tags/%E7%BC%96%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>2017-9-14 通过__slots__节省内存</title>
    <link href="https://chihweihsu.com/2017/09/14/2017-9-14-%E9%80%9A%E8%BF%87-slots-%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98/"/>
    <id>https://chihweihsu.com/2017/09/14/2017-9-14-通过-slots-节省内存/</id>
    <published>2017-09-14T19:01:38.000Z</published>
    <updated>2018-02-24T08:53:20.049Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.datadependence.com/2016/07/pythonic-code-video-series-slots/" target="_blank" rel="noopener">见原文</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Measurement</span>:</span></span><br><span class="line">    __slots__ = [<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'val'</span>]</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y, value)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line">        self.val = value</span><br></pre></td></tr></table></figure></p><blockquote><p>merge dict </p></blockquote><p><a href="http://www.datadependence.com/2016/08/pythonic-code-video-series-merging-dictionaries/" target="_blank" rel="noopener">merged_dict</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict_merged = &#123;**a, **b, **c&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.datadependence.com/2016/07/pythonic-code-video-series-slots/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;见原文&lt;/a
      
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="内存" scheme="https://chihweihsu.com/tags/%E5%86%85%E5%AD%98/"/>
    
      <category term="slots" scheme="https://chihweihsu.com/tags/slots/"/>
    
  </entry>
  
  <entry>
    <title>2017-9-12 str() vs json.dumps()</title>
    <link href="https://chihweihsu.com/2017/09/12/2017-9-12-str-vs-json-dumps/"/>
    <id>https://chihweihsu.com/2017/09/12/2017-9-12-str-vs-json-dumps/</id>
    <published>2017-09-12T13:39:13.000Z</published>
    <updated>2018-02-24T10:16:33.402Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h3 id="str-与-json-dumps-的区别"><a href="#str-与-json-dumps-的区别" class="headerlink" title="str() 与 json.dumps()的区别"></a>str() 与 json.dumps()的区别</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">'jsonKey'</span>: <span class="string">'jsonValue'</span>,<span class="string">"title"</span>: <span class="string">"hello world"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> json.dumps(data)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"jsonKey"</span>: <span class="string">"jsonValue"</span>, <span class="string">"title"</span>: <span class="string">"hello world"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> str(data)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">'jsonKey'</span>: <span class="string">'jsonValue'</span>, <span class="string">'title'</span>: <span class="string">'hello world'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(data)</span><br><span class="line"></span><br><span class="line"><span class="string">'&#123;"jsonKey": "jsonValue", "title": "hello world"&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(data)</span><br><span class="line"></span><br><span class="line"><span class="string">"&#123;'jsonKey': 'jsonValue', 'title': 'hello world'&#125;"</span></span><br></pre></td></tr></table></figure><blockquote><p>In fact, I am more interested in their difference in single quote and double quote in output strings. It seems that I already know one difference between them (mentioned above) and whether json.loads() can load the output string. </p></blockquote><blockquote><p>json.dumps() is much more than just making a string out of a Python object, it would always produce a valid JSON string (assuming everything inside the object is serializable) following the Type Conversion Table.</p></blockquote><blockquote><p>For instance, if one of the values is None, the str() would produce an invalid JSON which cannot be loaded:</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">'jsonKey'</span>: <span class="keyword">None</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(data)</span><br><span class="line"><span class="string">"&#123;'jsonKey': None&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.loads(str(data))</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/json/__init__.py"</span>, line <span class="number">338</span>, <span class="keyword">in</span> loads</span><br><span class="line">    <span class="keyword">return</span> _default_decoder.decode(s)</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/json/decoder.py"</span>, line <span class="number">366</span>, <span class="keyword">in</span> decode</span><br><span class="line">    obj, end = self.raw_decode(s, idx=_w(s, <span class="number">0</span>).end())</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/json/decoder.py"</span>, line <span class="number">382</span>, <span class="keyword">in</span> raw_decode</span><br><span class="line">    obj, end = self.scan_once(s, idx)</span><br><span class="line">ValueError: Expecting property name: line <span class="number">1</span> column <span class="number">2</span> (char <span class="number">1</span>)</span><br></pre></td></tr></table></figure><blockquote><p>But the dumps() would convert None into null making a valid JSON string that can be loaded:</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = &#123;<span class="string">'jsonKey'</span>: <span class="keyword">None</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(data)</span><br><span class="line"><span class="string">'&#123;"jsonKey": null&#125;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.loads(json.dumps(data))</span><br><span class="line">&#123;<span class="string">u'jsonKey'</span>: <span class="keyword">None</span>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>In fact in (I believe most) implementations of Python, str(object) wraps strings in single quotes, which is not valid JSON.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">An example:</span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: <span class="keyword">print</span> str(&#123;<span class="string">"a"</span>: <span class="number">1</span>&#125;)</span><br><span class="line">&#123;<span class="string">'a'</span>: <span class="number">1</span>&#125;</span><br><span class="line">str(boolean) <span class="keyword">is</span> also <span class="keyword">not</span> valid JSON:</span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: <span class="keyword">print</span> str(<span class="keyword">True</span>)</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">__str__, can, however, be overridden <span class="keyword">in</span> user defined classes to ensure that objects <span class="keyword">return</span> JSON representations of themselves.</span><br></pre></td></tr></table></figure><blockquote><p>字典转字符串（dict to str）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If your dictionary isn't too big maybe str + eval can do the work:</span></span><br><span class="line">dict1 = &#123;<span class="string">'one'</span>:<span class="number">1</span>, <span class="string">'two'</span>:<span class="number">2</span>, <span class="string">'three'</span>: &#123;<span class="string">'three.1'</span>: <span class="number">3.1</span>, <span class="string">'three.2'</span>: <span class="number">3.2</span> &#125;&#125;</span><br><span class="line">str1 = str(dict1)</span><br><span class="line"></span><br><span class="line">dict2 = eval(str1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> dict1==dict2</span><br><span class="line"><span class="comment"># You can use ast.literal_eval instead of eval for additional security if the source is untrusted.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># convert to string</span></span><br><span class="line">input = json.dumps(&#123;<span class="string">'id'</span>: id &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># load to dict</span></span><br><span class="line">my_dict = json.loads(input)</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>字符串转字典（str to dict）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># str to dict</span></span><br><span class="line">In [<span class="number">33</span>]: <span class="keyword">import</span> ast</span><br><span class="line">In [<span class="number">34</span>]: ast.literal_eval(<span class="string">"&#123;'x':1, 'y':2&#125;"</span>)</span><br><span class="line">Out[<span class="number">34</span>]: &#123;<span class="string">'x'</span>: <span class="number">1</span>, <span class="string">'y'</span>: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>转换已转义的字符串转字典（str to dict）</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">'&#123;\\"name\\":\\"michael\\"&#125;'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> a</span><br><span class="line">&#123;\<span class="string">"name\":\"michael\"&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;&gt;&gt; type(json.loads('“' + a + '”'))</span></span><br><span class="line"><span class="string">&lt;type 'unicode'&gt;</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; type(json.loads(json.loads('“' + a + '”')))</span></span><br><span class="line"><span class="string">&lt;type 'dict'&gt;</span></span><br><span class="line"><span class="string"># 第一次json.loads是将里面的\"这样的字符串转为"</span>(只有一个双引号)，第二次再将其转为一个字典，记得不要漏掉前面先加双引号。</span><br></pre></td></tr></table></figure><blockquote><p><code>pymongo</code> 根据ObjectId进行查询<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bson.objectid <span class="keyword">import</span> ObjectId</span><br><span class="line">[i <span class="keyword">for</span> i <span class="keyword">in</span> dbm.neo_nodes.find(&#123;<span class="string">"_id"</span>: ObjectId(obj_id_to_find)&#125;)]</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>float nan</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x=float(<span class="string">'nan'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.isnan(x)</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The usual way to test for a NaN is to see if it's equal to itself, since nan isn't equal anything.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isNaN</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> num != num</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;str-与-json-dumps-的区别&quot;&gt;&lt;a href=&quot;#str-与-json-dumps-的区别&quot; class=&quot;headerlink&quot; title=&quot;str() 与 json.dumps()的区别&quot;&gt;&lt;/a&gt;str()
      
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="string" scheme="https://chihweihsu.com/tags/string/"/>
    
      <category term="json" scheme="https://chihweihsu.com/tags/json/"/>
    
  </entry>
  
  <entry>
    <title>2017-9-7 机器学习分类</title>
    <link href="https://chihweihsu.com/2017/09/07/2017-9-7-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%88%86%E7%B1%BB/"/>
    <id>https://chihweihsu.com/2017/09/07/2017-9-7-机器学习分类/</id>
    <published>2017-09-07T12:19:51.000Z</published>
    <updated>2018-02-24T08:53:20.049Z</updated>
    
    <content type="html"><![CDATA[<h4 id="机器学习："><a href="#机器学习：" class="headerlink" title="机器学习："></a>机器学习：</h4><a id="more"></a><blockquote><ul><li>线性回归<ul><li>岭回归</li><li>LASSO</li><li>弹性网络</li></ul></li><li>逻辑回归<ul><li>Softmax 回归</li></ul></li><li>决策树<ul><li>ID3</li><li>C4.5</li><li>CART</li></ul></li><li>神经网络<ul><li>普通网络</li><li>CNN</li><li>RNN</li><li>GAN</li></ul></li></ul></blockquote><h4 id="架构总览："><a href="#架构总览：" class="headerlink" title="架构总览："></a>架构总览：</h4><blockquote><p>数据仓库</p><ul><li>SparkStreaming<ul><li>tensorflow</li><li>scikit-learn<br>模型库</li></ul></li><li>django<ul><li>xgboost</li><li>SparkMLLib<br>特征库</li></ul></li><li>redis<ul><li>numpy</li><li>pandas</li></ul></li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;机器学习：&quot;&gt;&lt;a href=&quot;#机器学习：&quot; class=&quot;headerlink&quot; title=&quot;机器学习：&quot;&gt;&lt;/a&gt;机器学习：&lt;/h4&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="机器学习" scheme="https://chihweihsu.com/categories/Notes/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="机器学习" scheme="https://chihweihsu.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>2017-9-7 机器学习路线</title>
    <link href="https://chihweihsu.com/2017/09/07/2017-9-7-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/"/>
    <id>https://chihweihsu.com/2017/09/07/2017-9-7-机器学习路线/</id>
    <published>2017-09-07T11:21:28.000Z</published>
    <updated>2018-02-24T08:53:20.049Z</updated>
    
    <content type="html"><![CDATA[<h3 id="准备知识："><a href="#准备知识：" class="headerlink" title="准备知识："></a>准备知识：</h3><blockquote><p>编程语言：Python，C++，Spark（大数据环境下）；<br>知识储备：英语、线性代数、概率论、图论、神经科学。</p></blockquote><a id="more"></a><h4 id="第一步-统领大局："><a href="#第一步-统领大局：" class="headerlink" title="第一步 统领大局："></a>第一步 统领大局：</h4><blockquote><p>建立大局观，是入门第一要务； 从宏观了解机器学习的全貌；<br>机器学习：根据已有特征，选择模型，训练模型，预测未知数据；<br>推荐书籍：<br>-《图解机器学习》：通俗易懂，算法图解，入门必备；<br>-《集体智慧编程》：代码实现，一个字“敲”；<br>-《机器学习（周志华西瓜书）》：系统严谨，数学推导；</p></blockquote><h4 id="第二步-了解算法："><a href="#第二步-了解算法：" class="headerlink" title="第二步 了解算法："></a>第二步 了解算法：</h4><blockquote><p>看遍所有算法原理，主要书籍：《机器学习（周志华）》；<br><code>coursera</code> 上Andrew NG的机器学习公开课，网易云也开了；<br>邹博的《机器学习实战》；<br>李沐《一起动手学习深度学习》；<br>必学：线性回归，Logistics回归，决策树。</p></blockquote><h4 id="第三步-利用框架："><a href="#第三步-利用框架：" class="headerlink" title="第三步 利用框架："></a>第三步 利用框架：</h4><blockquote><p>利用<code>scikit-learn</code>实现所学的算法（推荐鸢尾花分类、MNIST分类）</p></blockquote><h4 id="第四步-神经网络："><a href="#第四步-神经网络：" class="headerlink" title="第四步 神经网络："></a>第四步 神经网络：</h4><blockquote><p>看懂<code>Tensorflow</code>官网demo：RNN、CNN、GAN；<br>莫凡<code>Tensorflow</code>；</p></blockquote><h4 id="第五步-实操演练："><a href="#第五步-实操演练：" class="headerlink" title="第五步 实操演练："></a>第五步 实操演练：</h4><blockquote><p>注册<code>kangle</code>，奋斗吧！<br>上线一个小模型（django+scikit-learn）</p></blockquote><h4 id="第六步-关注落地："><a href="#第六步-关注落地：" class="headerlink" title="第六步 关注落地："></a>第六步 关注落地：</h4><blockquote><p>机器学习MVP开发；<br>针对小规模，有质量、已标注的数据进行训练；<br>明确需求、特征量化、目标量化、特征清洗、模型选型、模型训练、线下验证、模型上线、特征清洗、模型预测、结果应用、运行监控；</p></blockquote><blockquote><p>实例一：客户动用率预测：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">明确需求：与业务同事讨论本次需求的目标是什么，这里说的就是动用率预测；</span><br><span class="line">特征量化：选出可能有影响的特征，如：年龄，性别，近三个月是否动用等；</span><br><span class="line">目标量化：选择是否动用为目标；</span><br><span class="line">特征清洗：样本筛选，缺失值补全，利用先验知识去掉明显不符合常理的数据；</span><br><span class="line">模型选择：直接丢个逻辑回归试试看；</span><br><span class="line">模型训练：看训练集和测试集，讨论出一个精准度即可；</span><br><span class="line">模型上线：丢上线去跑跑看，看看结果，暂时不接入关键流程即可。</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>实例二：客户逾期率预测：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">明确需求：与业务同事讨论本次需求的目标是什么，这里说的就是逾期率预测；</span><br><span class="line">特征量化：选出可能有影响的特征，如：年龄，性别，近三个月是否逾期等；</span><br><span class="line">目标量化：选择客户是否逾期作为目标；</span><br><span class="line">特征清洗：样本筛选，缺失值补全，利用先验知识去掉明显不符合常理的数据；</span><br><span class="line">模型选择：直接丢个softmax回归试试看；</span><br><span class="line">模型训练：看训练集和测试集，讨论出一个精准度即可；</span><br><span class="line">模型上线：丢上线去跑跑看，看看结果，暂时不接入关键流程即可。</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>实例三：客户风险级别预测：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">明确需求：与业务同事讨论本次需求的目标是什么，这里说的就是风险级别预测；</span><br><span class="line">特征量化：选出可能有影响的特征，如：年龄，性别，近三个月是否逾期等；</span><br><span class="line">目标量化：选择预期风险等级作为目标；</span><br><span class="line">特征清洗：样本筛选，缺失值补全，利用先验知识去掉明显不符合常理的数据；</span><br><span class="line">模型选择：直接丢个决策树试试看；</span><br><span class="line">模型训练：看训练集和测试集，讨论出一个精准度即可；</span><br><span class="line">模型上线：丢上线去跑跑看，看看结果，暂时不接入关键流程即可。</span><br></pre></td></tr></table></figure></p></blockquote><h4 id="第七步-补充数学："><a href="#第七步-补充数学：" class="headerlink" title="第七步 补充数学："></a>第七步 补充数学：</h4><blockquote><p>《概率论与数理统计》陈希孺<br>《线性代数应该这样学》</p></blockquote><h4 id="第八步-特征工程："><a href="#第八步-特征工程：" class="headerlink" title="第八步 特征工程："></a>第八步 特征工程：</h4><blockquote><p>好的特征决是成功的一半；<br>特征选择，特征清洗，决定模型的上限，算法和优化只是不断趋近这个上限；<br>特征工程非常重要。</p></blockquote><h4 id="第九步-深入前沿："><a href="#第九步-深入前沿：" class="headerlink" title="第九步 深入前沿："></a>第九步 深入前沿：</h4><blockquote><p>深入了解前沿的底层原理<br>阅读实践优秀论文，如：MapReduce原理的，李沐Parameter原理的，GAN原理的，LPA原理的……</p></blockquote><h4 id="书单："><a href="#书单：" class="headerlink" title="书单："></a>书单：</h4><blockquote><p>《深入浅出统计学》<br>《深入浅出数据分析》<br>《大数据智能》<br>《深度学习》<br>《优雅的理性》<br>《创新者的窘境》<br>《数学之美》</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;准备知识：&quot;&gt;&lt;a href=&quot;#准备知识：&quot; class=&quot;headerlink&quot; title=&quot;准备知识：&quot;&gt;&lt;/a&gt;准备知识：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;编程语言：Python，C++，Spark（大数据环境下）；&lt;br&gt;知识储备：英语、线性代数、概率论、图论、神经科学。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="机器学习" scheme="https://chihweihsu.com/categories/Notes/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="机器学习" scheme="https://chihweihsu.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="路线" scheme="https://chihweihsu.com/tags/%E8%B7%AF%E7%BA%BF/"/>
    
  </entry>
  
  <entry>
    <title>2017-9-5 计算体脂率</title>
    <link href="https://chihweihsu.com/2017/09/05/2017-9-5-%E8%AE%A1%E7%AE%97%E4%BD%93%E8%84%82%E7%8E%87/"/>
    <id>https://chihweihsu.com/2017/09/05/2017-9-5-计算体脂率/</id>
    <published>2017-09-05T21:12:11.000Z</published>
    <updated>2018-02-24T08:53:20.049Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote><p>用来计算一个人的体脂率</p></blockquote><a id="more"></a><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_BFR</span><span class="params">(weight, height, age, gender)</span>:</span></span><br><span class="line"><span class="string">"""计算BMI及体脂率</span></span><br><span class="line"><span class="string">:param weight: 体重（kg）</span></span><br><span class="line"><span class="string">:param height: 身高（m）</span></span><br><span class="line"><span class="string">:param age: 年龄（岁）</span></span><br><span class="line"><span class="string">:param gender: 性别（男--1，女--0）</span></span><br><span class="line"><span class="string">:returns: 体脂率，float</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># BMI</span></span><br><span class="line">BMI = weight /(height*height)</span><br><span class="line"><span class="comment"># 体脂率 </span></span><br><span class="line">BFR = <span class="number">1.2</span>*BMI + <span class="number">0.23</span>*age - <span class="number">5.4</span> - <span class="number">10.8</span>*gender</span><br><span class="line"><span class="keyword">return</span> BFR</span><br><span class="line"></span><br><span class="line">get_BFR(<span class="number">55</span>, <span class="number">1.7</span>, <span class="number">26</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 12.61737024221453</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;用来计算一个人的体脂率&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="life" scheme="https://chihweihsu.com/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>2017-9-5 python  list 排序 sort、sorted</title>
    <link href="https://chihweihsu.com/2017/09/05/2017-9-5-python-list-%E6%8E%92%E5%BA%8F-sort%E3%80%81sorted/"/>
    <id>https://chihweihsu.com/2017/09/05/2017-9-5-python-list-排序-sort、sorted/</id>
    <published>2017-09-05T19:17:50.000Z</published>
    <updated>2018-02-24T08:53:20.049Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote><p>项目中，有一个list，list内部组成元素为dict，现需要根据dict中某个键的值来进行排序。</p></blockquote><a id="more"></a><h3 id="代码实现："><a href="#代码实现：" class="headerlink" title="代码实现："></a>代码实现：</h3><blockquote><p> <code>reverse</code>: False–默认，正序；True–逆序，由大到小；<br> <code>key</code>: 可以根据<code>key</code>值自定义排序；<br> <code>sort</code>与<code>sorted</code>区别: <code>sort</code>list自身发生改变；<code>sorted</code>list本身不发生改变。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">6</span>]        </span><br><span class="line"> </span><br><span class="line"> <span class="comment"># sorted 用法</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(a)                  <span class="comment">#将a从小到大排序,不影响a本身结构 </span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(a,reverse = <span class="keyword">True</span>)   <span class="comment">#将a从大到小排序,不影响a本身结构 </span></span><br><span class="line">[<span class="number">9</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>] </span><br><span class="line"> </span><br><span class="line"> <span class="comment"># sort 用法</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.sort()                   <span class="comment">#将a从小到大排序,影响a本身结构 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a </span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a.sort(reverse = <span class="keyword">True</span>)     <span class="comment">#将a从大到小排序,影响a本身结构 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a </span><br><span class="line">[<span class="number">9</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>] </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 注意，a.sort() 已改变其结构，b = a.sort() 是错误的写法! </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 非数字排序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = [<span class="string">'aa'</span>,<span class="string">'BB'</span>,<span class="string">'bb'</span>,<span class="string">'zz'</span>,<span class="string">'CC'</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(b) </span><br><span class="line">[<span class="string">'BB'</span>, <span class="string">'CC'</span>, <span class="string">'aa'</span>, <span class="string">'bb'</span>, <span class="string">'zz'</span>]    <span class="comment">#按列表中元素每个字母的ascii码从小到大排序,如果要从大到小,请用sorted(b,reverse=True)下同 </span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 根据key值自定义排序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c =[<span class="string">'CCC'</span>, <span class="string">'bb'</span>, <span class="string">'ffff'</span>, <span class="string">'z'</span>]  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(c,key=len)             <span class="comment">#按列表的元素的长度排序 </span></span><br><span class="line">[<span class="string">'z'</span>, <span class="string">'bb'</span>, <span class="string">'CCC'</span>, <span class="string">'ffff'</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d =[<span class="string">'CCC'</span>, <span class="string">'bb'</span>, <span class="string">'ffff'</span>, <span class="string">'z'</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(d,key = str.lower )    <span class="comment">#将列表中的每个元素变为小写，再按每个元素中的每个字母的ascii码从小到大排序 </span></span><br><span class="line">[<span class="string">'bb'</span>, <span class="string">'CCC'</span>, <span class="string">'ffff'</span>, <span class="string">'z'</span>] </span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">lastchar</span><span class="params">(s)</span>:</span> </span><br><span class="line">       <span class="keyword">return</span> s[<span class="number">-1</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>e = [<span class="string">'abc'</span>,<span class="string">'b'</span>,<span class="string">'AAz'</span>,<span class="string">'ef'</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(e,key = lastchar)      <span class="comment">#自定义函数排序,lastchar为函数名，这个函数返回列表e中每个元素的最后一个字母 </span></span><br><span class="line">[<span class="string">'b'</span>, <span class="string">'abc'</span>, <span class="string">'ef'</span>, <span class="string">'AAz'</span>]         <span class="comment">#sorted(e,key=lastchar)作用就是 按列表e中每个元素的最后一个字母的ascii码从小到大排序 </span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = [&#123;<span class="string">'name'</span>:<span class="string">'abc'</span>,<span class="string">'age'</span>:<span class="number">20</span>&#125;,&#123;<span class="string">'name'</span>:<span class="string">'def'</span>,<span class="string">'age'</span>:<span class="number">30</span>&#125;,&#123;<span class="string">'name'</span>:<span class="string">'ghi'</span>,<span class="string">'age'</span>:<span class="number">25</span>&#125;]     <span class="comment">#列表中的元素为字典 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(s)</span>:</span> </span><br><span class="line">       <span class="keyword">return</span> s[<span class="string">'age'</span>] </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ff = sorted(f,key = age)      <span class="comment">#自定义函数按列表f中字典的age从小到大排序  </span></span><br><span class="line">[&#123;<span class="string">'age'</span>: <span class="number">20</span>, <span class="string">'name'</span>: <span class="string">'abc'</span>&#125;, &#123;<span class="string">'age'</span>: <span class="number">25</span>, <span class="string">'name'</span>: <span class="string">'ghi'</span>&#125;, &#123;<span class="string">'age'</span>: <span class="number">30</span>, <span class="string">'name'</span>: <span class="string">'def'</span>&#125;] </span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2 = sorted(f,key = <span class="keyword">lambda</span> x:x[<span class="string">'age'</span>])    <span class="comment">#如果觉得上面定义一个函数代码不美观，可以用lambda的形式来定义函数,效果[&#123;'age': 20, 'name': 'abc'&#125;, &#123;'age': 25, 'name': 'ghi'&#125;, &#123;'age': 30, 'name': 'def'&#125;]</span></span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;项目中，有一个list，list内部组成元素为dict，现需要根据dict中某个键的值来进行排序。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="list" scheme="https://chihweihsu.com/tags/list/"/>
    
      <category term="sort" scheme="https://chihweihsu.com/tags/sort/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-31 自动 生成注释文档（docstring）</title>
    <link href="https://chihweihsu.com/2017/08/31/2017-8-31-python-%E8%87%AA%E5%8A%A8-%E7%94%9F%E6%88%90%E6%B3%A8%E9%87%8A%E6%96%87%E6%A1%A3%EF%BC%88docstring%EF%BC%89/"/>
    <id>https://chihweihsu.com/2017/08/31/2017-8-31-python-自动-生成注释文档（docstring）/</id>
    <published>2017-09-01T00:22:52.000Z</published>
    <updated>2018-02-24T08:53:20.048Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote><p>项目中，发现很多函数、类没有注释说明，一个个弄比较繁琐，所以……</p></blockquote><a id="more"></a><h3 id="docstring定义："><a href="#docstring定义：" class="headerlink" title="docstring定义："></a><code>docstring</code>定义：</h3><blockquote><p>官方：A docstring is a string literal that occurs as the first statement in a module, function, class, or method definition. Such a docstring becomes the <strong>doc</strong> special attribute of that object；<br>人话：“出现在模块、函数、类、方法里的第一个语句，就叫做<code>docsting</code>”；<br>调用：使用<code>__doc__</code>。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="string">""" This is function foo"""</span></span><br><span class="line"></span><br><span class="line">foo.__doc__</span><br><span class="line"><span class="comment">#  This is function foo</span></span><br></pre></td></tr></table></figure></p></blockquote><h3 id="docstring风格："><a href="#docstring风格：" class="headerlink" title="docstring风格："></a><code>docstring</code>风格：</h3><blockquote><p>主要四种：<code>javadoc</code>(<code>Epytext</code>), <code>reST</code>, <code>numpydoc</code>, <code>google</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Epytext</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">This is a javadoc style.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">@param param1: this is a first param</span></span><br><span class="line"><span class="string">@param param2: this is a second param</span></span><br><span class="line"><span class="string">@return: this is a description of what is returned</span></span><br><span class="line"><span class="string">@raise keyError: raises an exception</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reST（推荐，reST风格，Sphinx的御用格式）</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">This is a reST style.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">:param param1: this is a first param</span></span><br><span class="line"><span class="string">:param param2: this is a second param</span></span><br><span class="line"><span class="string">:returns: this is a description of what is returned</span></span><br><span class="line"><span class="string">:raises keyError: raises an exception</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Google</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">This is a groups style docs.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">Parameters:</span></span><br><span class="line"><span class="string">  param1 - this is the first param</span></span><br><span class="line"><span class="string">  param2 - this is a second param</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">Returns:</span></span><br><span class="line"><span class="string">  This is a description of what is returned</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">Raises:</span></span><br><span class="line"><span class="string">  KeyError - raises an exception</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Numpydoc (Numpy风格)</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">My numpydoc description of a kind</span></span><br><span class="line"><span class="string">of very exhautive numpydoc format docstring.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">Parameters</span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="string">first : array_like</span></span><br><span class="line"><span class="string">  the 1st param name `first`</span></span><br><span class="line"><span class="string">second :</span></span><br><span class="line"><span class="string">  the 2nd param</span></span><br><span class="line"><span class="string">third : &#123;'value', 'other'&#125;, optional</span></span><br><span class="line"><span class="string">  the 3rd param, by default 'value'</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">Returns</span></span><br><span class="line"><span class="string">-------</span></span><br><span class="line"><span class="string">string</span></span><br><span class="line"><span class="string">  a value in a string</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">Raises</span></span><br><span class="line"><span class="string">------</span></span><br><span class="line"><span class="string">KeyError</span></span><br><span class="line"><span class="string">  when a key error</span></span><br><span class="line"><span class="string">OtherError</span></span><br><span class="line"><span class="string">  when an other error</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><h3 id="转换工具pyment"><a href="#转换工具pyment" class="headerlink" title="转换工具pyment"></a>转换工具<a href="https://github.com/dadadel/pyment" target="_blank" rel="noopener"><code>pyment</code></a></h3><blockquote><p>用来创建、转换<code>docsting</code>，<a href="https://github.com/dadadel/pyment" target="_blank" rel="noopener">点击查看安装</a><br>centos中可能使用不了<code>patch</code>，<a href="http://centos-packages.com/7/package/patch/" target="_blank" rel="noopener">点击下载安装包</a><br><code>pyment</code>命令帮助：<code>pyment -h</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装pyment</span></span><br><span class="line">$ git clone https://github.com/dadadel/pyment.git  <span class="comment"># or git@github.com:dadadel/pyment.git</span></span><br><span class="line">$ cd pyment</span><br><span class="line">$ python setup.py install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装patch</span></span><br><span class="line"><span class="comment"># 下载安装包：http://centos-packages.com/7/package/patch/</span></span><br><span class="line">rpm -i patch<span class="number">-2.7</span><span class="number">.1</span><span class="number">-8.</span>el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用方法</span></span><br><span class="line">$ pyment test.py      <span class="comment">#生成patch</span></span><br><span class="line">$ patch -p1 &lt; test.py.patch <span class="comment">#打patch</span></span><br></pre></td></tr></table></figure><h3 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h3><blockquote><p>注释前<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(param1=True, param2=<span class="string">'default val'</span>)</span>:</span></span><br><span class="line">    <span class="string">'''Description of func with docstring groups style.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Params:</span></span><br><span class="line"><span class="string">        param1 - descr of param1 that has True for default value.</span></span><br><span class="line"><span class="string">        param2 - descr of param2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        some value</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Raises:</span></span><br><span class="line"><span class="string">        keyError: raises key exception</span></span><br><span class="line"><span class="string">        TypeError: raises type exception</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method</span><span class="params">(self, param1, param2=None)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>执行<code>pyment test.py</code>，得到<code>patch</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># Patch generated by Pyment v0.2.0</span><br><span class="line"></span><br><span class="line">--- a/test.py</span><br><span class="line">+++ b/test.py</span><br><span class="line">@@ -1,20 +1,22 @@</span><br><span class="line"> def func(param1=True, param2=&apos;default val&apos;):</span><br><span class="line">-    &apos;&apos;&apos;Description of func with docstring groups style.</span><br><span class="line">+    &quot;&quot;&quot;Description of func with docstring groups style.</span><br><span class="line"></span><br><span class="line">-    Params:</span><br><span class="line">-        param1 - descr of param1 that has True for default value.</span><br><span class="line">-        param2 - descr of param2</span><br><span class="line">+    :param param1: descr of param1 that has True for default value</span><br><span class="line">+    :param param2: descr of param2 (Default value = &apos;default val&apos;)</span><br><span class="line">+    :returns: some value</span><br><span class="line">+    :raises keyError: raises key exception</span><br><span class="line">+    :raises TypeError: raises type exception</span><br><span class="line"></span><br><span class="line">-    Returns:</span><br><span class="line">-        some value</span><br><span class="line">-</span><br><span class="line">-    Raises:</span><br><span class="line">-        keyError: raises key exception</span><br><span class="line">-        TypeError: raises type exception</span><br><span class="line">-</span><br><span class="line">-    &apos;&apos;&apos;</span><br><span class="line">+    &quot;&quot;&quot;</span><br><span class="line">     pass</span><br><span class="line"></span><br><span class="line"> class A:</span><br><span class="line">+    &quot;&quot;&quot; &quot;&quot;&quot;</span><br><span class="line">     def method(self, param1, param2=None):</span><br><span class="line">+        &quot;&quot;&quot;</span><br><span class="line">+</span><br><span class="line">+        :param param1:</span><br><span class="line">+        :param param2:  (Default value = None)</span><br><span class="line">+</span><br><span class="line">+        &quot;&quot;&quot;</span><br><span class="line">         pass</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>执行<code>patch -p1 &lt; test.py.patch</code>，注释后得到</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(param1=True, param2=<span class="string">'default val'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Description of func with docstring groups style.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param param1: descr of param1 that has True for default value</span></span><br><span class="line"><span class="string">    :param param2: descr of param2 (Default value = 'default val')</span></span><br><span class="line"><span class="string">    :returns: some value</span></span><br><span class="line"><span class="string">    :raises keyError: raises key exception</span></span><br><span class="line"><span class="string">    :raises TypeError: raises type exception</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="string">""" """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method</span><span class="params">(self, param1, param2=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param param1:</span></span><br><span class="line"><span class="string">        :param param2:  (Default value = None)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h3 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h3><blockquote><p>使用<code>sphinx</code>的<code>autodoc</code>自动从<code>docstring</code>生产api文档, 避免重复工作，再娄一遍Api文档。</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;项目中，发现很多函数、类没有注释说明，一个个弄比较繁琐，所以……&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="Linux" scheme="https://chihweihsu.com/tags/Linux/"/>
    
      <category term="Docstring" scheme="https://chihweihsu.com/tags/Docstring/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-31 python  two sum 问题</title>
    <link href="https://chihweihsu.com/2017/08/31/2017-8-31-python-two-sum-%E9%97%AE%E9%A2%98/"/>
    <id>https://chihweihsu.com/2017/08/31/2017-8-31-python-two-sum-问题/</id>
    <published>2017-08-31T21:02:59.000Z</published>
    <updated>2018-02-24T08:53:20.048Z</updated>
    
    <content type="html"><![CDATA[<h3 id="题目描述："><a href="#题目描述：" class="headerlink" title="题目描述："></a>题目描述：</h3><blockquote><p>来自<code>LeetCode</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Time:  O(n)</span><br><span class="line"># Space: O(n)</span><br><span class="line"></span><br><span class="line"># Given an array of integers, return indices of the two numbers</span><br><span class="line"># such that they add up to a specific target.</span><br><span class="line">#</span><br><span class="line"># You may assume that each input would have exactly one solution.</span><br><span class="line">#</span><br><span class="line"># Example:</span><br><span class="line"># Given nums = [2, 7, 11, 15], target = 9,</span><br><span class="line">#</span><br><span class="line"># Because nums[0] + nums[1] = 2 + 7 = 9,</span><br><span class="line"># return [0, 1].</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="Python-解法："><a href="#Python-解法：" class="headerlink" title="Python 解法："></a>Python 解法：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self, nums, target)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :type target: int</span></span><br><span class="line"><span class="string">        :rtype: List[int]</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        lookup = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i, num <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">            <span class="keyword">if</span> target - num <span class="keyword">in</span> lookup:</span><br><span class="line">                <span class="keyword">return</span> [lookup[target - num], i]</span><br><span class="line">            lookup[num] = i</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum2</span><span class="params">(self, nums, target)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :type target: int</span></span><br><span class="line"><span class="string">        :rtype: List[int]</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        k = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> nums:</span><br><span class="line">            j = target - i</span><br><span class="line">            k += <span class="number">1</span></span><br><span class="line">            tmp_nums = nums[k:]</span><br><span class="line">            <span class="keyword">if</span> j <span class="keyword">in</span> tmp_nums:</span><br><span class="line">                <span class="keyword">return</span> [k - <span class="number">1</span>, tmp_nums.index(j) + k]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">print</span> Solution().twoSum((<span class="number">2</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>), <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="comment"># med = a[int(len(a)/2)]</span></span><br><span class="line">    c=[<span class="number">-1</span>, <span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> enumerate(a):</span><br><span class="line">        <span class="keyword">for</span> j,k <span class="keyword">in</span> enumerate(a[i+<span class="number">1</span>:]):</span><br><span class="line">            c = [i, i+j+<span class="number">1</span>] <span class="keyword">if</span> v+k==b <span class="keyword">else</span> c</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main2</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    dict 存放查值</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    c = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">        <span class="keyword">if</span> b - a[i] <span class="keyword">in</span> c:</span><br><span class="line">            <span class="keyword">return</span> [c[b-a[i]], i]</span><br><span class="line">        c[a[i]] = i</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">-1</span>, <span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum_number</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    dict 存放差值</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> len(a) &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    c = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">        <span class="keyword">if</span> a[i] <span class="keyword">in</span> c:</span><br><span class="line">            <span class="keyword">return</span> [c[a[i]], i]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c[b - a[i]] = i</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">-1</span>, <span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main3</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">        <span class="keyword">if</span> (b - a[len(a)-i<span class="number">-1</span>]) <span class="keyword">in</span> a[:len(a)-i<span class="number">-1</span>]:</span><br><span class="line">            <span class="keyword">return</span> [a.index((b - a[len(a)-i<span class="number">-1</span>])),len(a)-i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">-1</span>, <span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main4</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># print [[a.index((b - a[len(a)-i-1])),len(a)-i-1] for i in range(len(a)) if (b - a[len(a)-i-1]) in a[:len(a)-i-1]]</span></span><br><span class="line">        <span class="keyword">return</span> [[a.index((b - a[len(a)-i<span class="number">-1</span>])),len(a)-i<span class="number">-1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)) <span class="keyword">if</span> (b - a[len(a)-i<span class="number">-1</span>]) <span class="keyword">in</span> a[:len(a)-i<span class="number">-1</span>]][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">-1</span>,<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main5</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [[a.index((b - a[len(a)-i<span class="number">-1</span>])),len(a)-i<span class="number">-1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)) <span class="keyword">if</span> (b - a[len(a)-i<span class="number">-1</span>]) <span class="keyword">in</span> a[:len(a)-i<span class="number">-1</span>]].pop()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main6</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [[a.index(b-j), i] <span class="keyword">for</span> i,j <span class="keyword">in</span> enumerate(a) <span class="keyword">if</span> a.count(b-j) &gt; <span class="number">0</span> <span class="keyword">and</span> a.index(b-j)!=i].pop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    a = range(<span class="number">20</span>)</span><br><span class="line">    b = <span class="number">18</span></span><br><span class="line">    <span class="comment"># a = [49,1,2,3,50,51]</span></span><br><span class="line">    <span class="comment"># b=99</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'list:&#123;&#125;,data:&#123;&#125;'</span>.format(a,b)</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">print</span> main(a,b)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'main_time_used:&#123;&#125;'</span>.format(time.time()-start)</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">print</span> main2(a,b)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'main2_time_used:&#123;&#125;'</span>.format(time.time()-start)</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">print</span> main3(a,b)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'main3_time_used:&#123;&#125;'</span>.format(time.time()-start)</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">print</span> main4(a,b)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'main4_time_used:&#123;&#125;'</span>.format(time.time()-start)</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">print</span> main5(a,b)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'main5_time_used:&#123;&#125;'</span>.format(time.time()-start)</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">print</span> main6(a,b)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'main6_time_used:&#123;&#125;'</span>.format(time.time()-start)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;题目描述：&quot;&gt;&lt;a href=&quot;#题目描述：&quot; class=&quot;headerlink&quot; title=&quot;题目描述：&quot;&gt;&lt;/a&gt;题目描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;来自&lt;code&gt;LeetCode&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# Time:  O(n)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Space: O(n)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Given an array of integers, return indices of the two numbers&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# such that they add up to a specific target.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# You may assume that each input would have exactly one solution.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Example:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Given nums = [2, 7, 11, 15], target = 9,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Because nums[0] + nums[1] = 2 + 7 = 9,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# return [0, 1].&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="算法" scheme="https://chihweihsu.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-28 python interval  区间处理</title>
    <link href="https://chihweihsu.com/2017/08/28/2017-8-28-python-interval-%E5%8C%BA%E9%97%B4%E5%A4%84%E7%90%86/"/>
    <id>https://chihweihsu.com/2017/08/28/2017-8-28-python-interval-区间处理/</id>
    <published>2017-08-28T22:25:08.000Z</published>
    <updated>2018-02-24T08:53:20.047Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>volume1 = Interval.between(<span class="string">"A"</span>, <span class="string">"Foe"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>volume2 = Interval.between(<span class="string">"Fog"</span>, <span class="string">"McAfee"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>volume3 = Interval.between(<span class="string">"McDonalds"</span>, <span class="string">"Space"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>volume4 = Interval.between(<span class="string">"Spade"</span>, <span class="string">"Zygote"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>encyclopedia = IntervalSet([volume1, volume2, volume3, volume4])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mySet = IntervalSet([volume1, volume3, volume4])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"Meteor"</span> <span class="keyword">in</span> encyclopedia</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"Goose"</span> <span class="keyword">in</span> encyclopedia</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"Goose"</span> <span class="keyword">in</span> mySet</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>volume2 <span class="keyword">in</span> (encyclopedia ^ mySet)</span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a= <span class="number">112</span> </span><br><span class="line">In [<span class="number">4</span>]:  a <span class="keyword">in</span> range(<span class="number">300</span>,<span class="number">400</span>) </span><br><span class="line">   ...: </span><br><span class="line">Out[<span class="number">4</span>]: <span class="keyword">False</span> </span><br><span class="line">In [<span class="number">5</span>]:  a <span class="keyword">in</span> range(<span class="number">101</span>,<span class="number">300</span>) </span><br><span class="line">   ...: </span><br><span class="line">Out[<span class="number">5</span>]: <span class="keyword">True</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">python强大的区间处理库interval用法介绍</span><br><span class="line">原文发表在我的博客主页，转载请注明出处</span><br><span class="line"></span><br><span class="line">前言</span><br><span class="line"></span><br><span class="line">这个库是在阅读别人的源码的时候看到的，觉得十分好用，然而在网上找到的相关资料甚少，所以阅读了源码来做一个简单的用法总结。在网络的路由表中，经常会通过掩码来表示流表的匹配域，在python中有的时候为了方便的模拟流表的匹配过程，可以通过一个整数区间来表示诸如IP等的匹配范围，而本文介绍的库在区间处理上是十分的强大与方便。</span><br><span class="line"></span><br><span class="line">用法举例</span><br><span class="line"></span><br><span class="line">不论是在Linux系统还是Windows系统上，我们都可以方便的安装pip或者easy_install库来方便的安装大多数python库，interval也不例外。</span><br><span class="line">在这个库中提供了两个主要的类，分别是Interval和IntervalSet两个类。</span><br><span class="line">Interval类描述了一个连续的范围区间，这个区间可以是闭、开、半闭半开、无穷的，他的区间值不一定是数字，可以包含任何的数据类型，比如字符串，时间等等，同时他和python的各种操作（&lt;, &lt;=, ==, &gt;=, &gt;等）也是兼容的。IntervalSet包含了一个或多个互不相交的Interval集合。下面的这几个例子是源码中的。</span><br><span class="line"></span><br><span class="line"> &gt;&gt;&gt;volume1 = Interval.between(<span class="string">"A"</span>, <span class="string">"Foe"</span>)</span><br><span class="line">&gt;&gt;&gt;volume2 = Interval.between(<span class="string">"Fog"</span>, <span class="string">"McAfee"</span>)</span><br><span class="line">&gt;&gt;&gt;volume3 = Interval.between(<span class="string">"McDonalds"</span>, <span class="string">"Space"</span>)</span><br><span class="line">&gt;&gt;&gt;volume4 = Interval.between(<span class="string">"Spade"</span>, <span class="string">"Zygote"</span>)</span><br><span class="line">&gt;&gt;&gt;encyclopedia = IntervalSet([volume1, volume2, volume3, volume4])</span><br><span class="line">&gt;&gt;&gt;mySet = IntervalSet([volume1, volume3, volume4])</span><br><span class="line">&gt;&gt;&gt;<span class="string">"Meteor"</span> <span class="keyword">in</span> encyclopedia</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line">&gt;&gt;&gt;<span class="string">"Goose"</span> <span class="keyword">in</span> encyclopedia</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line">&gt;&gt;&gt;<span class="string">"Goose"</span> <span class="keyword">in</span> mySet</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line">&gt;&gt;&gt;volume2 <span class="keyword">in</span> (encyclopedia ^ mySet)</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line">前面的三个例子比较容易理解，最后一个例子中，encyclopedia的区别就是mySet多了一个volume2，而异或就是将两个集合中相同的元素去掉，不同的元素保留，所以最后只剩下了volume2。</span><br><span class="line">除了字符串，利用interval还可以很方便的处理时间，下面的例子同样来自于源码。</span><br><span class="line"></span><br><span class="line"> &gt;&gt;&gt;officeHours = IntervalSet.between(<span class="string">"08:00"</span>, <span class="string">"17:00"</span>)</span><br><span class="line">&gt;&gt;&gt;myLunch = IntervalSet.between(<span class="string">"11:30"</span>, <span class="string">"12:30"</span>)</span><br><span class="line">&gt;&gt;&gt;myHours = IntervalSet.between(<span class="string">"08:30"</span>, <span class="string">"19:30"</span>) - myLunch</span><br><span class="line">&gt;&gt;&gt;myHours.issubset(officeHours)</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line">&gt;&gt;&gt;<span class="string">"12:00"</span> <span class="keyword">in</span> myHours</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line">&gt;&gt;&gt;<span class="string">"15:30"</span> <span class="keyword">in</span> myHours</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line">&gt;&gt;&gt;inOffice = officeHours &amp; myHours</span><br><span class="line">&gt;&gt;&gt;<span class="keyword">print</span> inOffice</span><br><span class="line">[<span class="string">'08:30'</span>..<span class="string">'11:30'</span>),(<span class="string">'12:30'</span>..<span class="string">'17:00'</span>]</span><br><span class="line">&gt;&gt;&gt;overtime = myHours - officeHours</span><br><span class="line">&gt;&gt;&gt;<span class="keyword">print</span> overtime</span><br><span class="line">(<span class="string">'17:00'</span>..<span class="string">'19:30'</span>]</span><br><span class="line">在前言中说道interval库可以处理IP地址，简单的列举应用如下：</span><br><span class="line"></span><br><span class="line"> <span class="comment"># coding</span></span><br><span class="line">r1 = IntervalSet([Interval(<span class="number">1</span>, <span class="number">1000</span>), Interval(<span class="number">1100</span>, <span class="number">1200</span>)])</span><br><span class="line">r2 = IntervalSet([Interval(<span class="number">30</span>, <span class="number">50</span>), Interval(<span class="number">60</span>, <span class="number">200</span>), Interval(<span class="number">1150</span>, <span class="number">1300</span>)])</span><br><span class="line"></span><br><span class="line">r3 = IntervalSet([Interval(<span class="number">1000</span>, <span class="number">3000</span>)])</span><br><span class="line">r4 = IntervalSet([Interval(<span class="number">1000</span>, <span class="number">3000</span>)])</span><br><span class="line">r5 = IntervalSet([Interval(<span class="number">30000</span>, <span class="number">12000</span>)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (r3 - r4), (r4 - r3), r3 &amp; r4</span><br><span class="line"><span class="keyword">print</span> len(IntervalSet.empty())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> r3 &amp; r4 == r4:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'yes'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> r3 &amp; r4</span><br><span class="line"><span class="keyword">if</span> (r3 - r4).empty():</span><br><span class="line">   <span class="keyword">print</span> <span class="string">"true"</span></span><br><span class="line"><span class="keyword">print</span> (r3 - r4).empty()</span><br><span class="line"></span><br><span class="line"><span class="comment"># output</span></span><br><span class="line">&lt;Empty&gt; &lt;Empty&gt; [<span class="number">1000.</span><span class="number">.3000</span>]</span><br><span class="line"><span class="number">0</span></span><br><span class="line">yes</span><br><span class="line">[<span class="number">1000.</span><span class="number">.3000</span>]</span><br><span class="line">&lt;Empty&gt;</span><br><span class="line">常用方法</span><br><span class="line"></span><br><span class="line">interval对象初始化参数（lower_bound=-Inf, upper_bound=Inf, **kwargs）三个boolean参数closed,lower_closed,upper_closed分表表示全闭，左闭右开，左开右闭。比如：r = Interval(upper_bound=<span class="number">62</span>, closed=<span class="keyword">False</span>)</span><br><span class="line">between(a, b, closed=<span class="keyword">True</span>)：返回以a和b为界的区间</span><br><span class="line">less_than(a)：小于a的所有值构成interval，类似的还有less_than_or_equal_to，greater_than，greater_than_or_equal_to函数</span><br><span class="line">join(other)：将两个连续的intervals组合起来</span><br><span class="line">overlaps(other)：两个区间是否有重叠</span><br><span class="line">adjacent_to(other)：两个区间是否不重叠的毗邻</span><br><span class="line">总结</span><br><span class="line"></span><br><span class="line">是一篇总结文章，并没有什么深度，只是为了不再重复造轮子，在必要的时候一个库可以极大的提高效率。</span><br><span class="line">MeasureMeasure</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span clas
      
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="区间" scheme="https://chihweihsu.com/tags/%E5%8C%BA%E9%97%B4/"/>
    
      <category term="interval" scheme="https://chihweihsu.com/tags/interval/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-28 Pandas agg 使用lambda</title>
    <link href="https://chihweihsu.com/2017/08/28/2017-8-28-Pandas-agg-%E4%BD%BF%E7%94%A8lambda/"/>
    <id>https://chihweihsu.com/2017/08/28/2017-8-28-Pandas-agg-使用lambda/</id>
    <published>2017-08-28T22:12:25.000Z</published>
    <updated>2018-02-24T08:53:20.047Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">N = <span class="number">100</span></span><br><span class="line">data = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">'type'</span>: np.random.randint(<span class="number">10</span>, size=N),</span><br><span class="line">    <span class="string">'status'</span>: np.random.randint(<span class="number">10</span>, size=N),</span><br><span class="line">    <span class="string">'name'</span>: np.random.randint(<span class="number">10</span>, size=N),</span><br><span class="line">    <span class="string">'value'</span>: np.random.randint(<span class="number">10</span>, size=N),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">reading = np.random.random(<span class="number">10</span>,)</span><br><span class="line"></span><br><span class="line">data = data.groupby([<span class="string">'type'</span>, <span class="string">'status'</span>, <span class="string">'name'</span>])[<span class="string">'value'</span>].agg(&#123;</span><br><span class="line">    <span class="string">'one'</span> : np.mean, </span><br><span class="line">    <span class="string">'two'</span> : <span class="keyword">lambda</span> value: <span class="number">100</span>* ((value&gt;<span class="number">32</span>).sum() / reading.mean()), </span><br><span class="line">    <span class="string">'test2'</span>: <span class="keyword">lambda</span> value: <span class="number">100</span>* ((value &gt; <span class="number">45</span>).sum() / value.mean())</span><br><span class="line">&#125;)</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure><h3 id="获取一列数据中最大值"><a href="#获取一列数据中最大值" class="headerlink" title="获取一列数据中最大值"></a>获取一列数据中最大值</h3><p><code>`</code>python<br>In [34]: df.loc[df[‘Value’].idxmax()]<br>Out[34]:<br>Country        US<br>Place      Kansas<br>Value         894<br>Name: 7</p><p>df = df.reset_index()</p><p>data.groupby([‘Country’,’Place’])[‘Value’].max().item()</p><p>df.groupby([‘country’,’place’], as_index=False)[‘value’].max()</p><p>df.groupby(“country”).apply(lambda df:df.irow(df.value.argmax()))</p><p>In [5]: df = pandas.DataFrame(np.random.randn(10,3),columns=[‘A’,’B’,’C’])</p><p>In [6]: df<br>Out[6]:<br>          A         B         C<br>0  2.001289  0.482561  1.579985<br>1 -0.991646 -0.387835  1.320236<br>2  0.143826 -1.096889  1.486508<br>3 -0.193056 -0.499020  1.536540<br>4 -2.083647 -3.074591  0.175772<br>5 -0.186138 -1.949731  0.287432<br>6 -0.480790 -1.771560 -0.930234<br>7  0.227383 -0.278253  2.102004<br>8 -0.002592  1.434192 -1.624915<br>9  0.404911 -2.167599 -0.452900</p><p>In [7]: df.idxmax()<br>Out[7]:<br>A    0<br>B    8<br>C    7</p><p>In [8]: df.ix[df[‘A’].idxmax()]<br>Out[8]:<br>A    2.001289<br>B    0.482561<br>C    1.579985</p><p>···</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span clas
      
    
    </summary>
    
      <category term="数据分析" scheme="https://chihweihsu.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
      <category term="Pandas" scheme="https://chihweihsu.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/Pandas/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="Pandas" scheme="https://chihweihsu.com/tags/Pandas/"/>
    
      <category term="lambda" scheme="https://chihweihsu.com/tags/lambda/"/>
    
      <category term="agg" scheme="https://chihweihsu.com/tags/agg/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-27 dataframe与序列相乘</title>
    <link href="https://chihweihsu.com/2017/08/27/2017-8-27-Pandas-dataframe%E4%B8%8E%E5%BA%8F%E5%88%97%E7%9B%B8%E4%B9%98/"/>
    <id>https://chihweihsu.com/2017/08/27/2017-8-27-Pandas-dataframe与序列相乘/</id>
    <published>2017-08-27T22:28:54.000Z</published>
    <updated>2018-02-24T08:53:20.047Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote><p>继续完成项目中的评分卡部分，拿到分好箱的数据后，如何进行加权得到最后的分数就是我们接下来要考虑的问题了。</p></blockquote><a id="more"></a><h4 id="demo1"><a href="#demo1" class="headerlink" title="demo1:"></a>demo1:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = dataframe.mul(series, axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h4 id="demo2"><a href="#demo2" class="headerlink" title="demo2:"></a>demo2:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tile_df</span><span class="params">(df, n, m)</span>:</span></span><br><span class="line"> dfn = df.T</span><br><span class="line"> <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">1</span>, m):</span><br><span class="line"> dfn = dfn.append(df.T, ignore_index=<span class="keyword">True</span>)</span><br><span class="line"> dfm = dfn.T</span><br><span class="line"> <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">1</span>, n):</span><br><span class="line"> dfm = dfm.append(dfn.T, ignore_index=<span class="keyword">True</span>)</span><br><span class="line"> <span class="keyword">return</span> dfm</span><br><span class="line"> </span><br><span class="line">df = pandas.DataFrame([[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]])</span><br><span class="line">tile_df(df, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment"># 0 1 2 3 4 5</span></span><br><span class="line"><span class="comment"># 0 1 2 1 2 1 2</span></span><br><span class="line"><span class="comment"># 1 3 4 3 4 3 4</span></span><br><span class="line"><span class="comment"># 2 1 2 1 2 1 2</span></span><br><span class="line"><span class="comment"># 3 3 4 3 4 3 4</span></span><br></pre></td></tr></table></figure><h4 id="demo3"><a href="#demo3" class="headerlink" title="demo3:"></a>demo3:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.DataFrame(np.random.randint(<span class="number">1</span>, <span class="number">10</span>, (<span class="number">5</span>, <span class="number">3</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df</span><br><span class="line">   <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span></span><br><span class="line"><span class="number">0</span>  <span class="number">7</span>  <span class="number">7</span>  <span class="number">5</span></span><br><span class="line"><span class="number">1</span>  <span class="number">1</span>  <span class="number">8</span>  <span class="number">6</span></span><br><span class="line"><span class="number">2</span>  <span class="number">4</span>  <span class="number">8</span>  <span class="number">4</span></span><br><span class="line"><span class="number">3</span>  <span class="number">2</span>  <span class="number">9</span>  <span class="number">5</span></span><br><span class="line"><span class="number">4</span>  <span class="number">3</span>  <span class="number">8</span>  <span class="number">7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.prod(axis=<span class="number">1</span>)</span><br><span class="line"><span class="number">0</span>    <span class="number">245</span></span><br><span class="line"><span class="number">1</span>     <span class="number">48</span></span><br><span class="line"><span class="number">2</span>    <span class="number">128</span></span><br><span class="line"><span class="number">3</span>     <span class="number">90</span></span><br><span class="line"><span class="number">4</span>    <span class="number">168</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df = pd.DataFrame(np.random.randint(<span class="number">1</span>, <span class="number">10</span>, (<span class="number">5</span>, <span class="number">3</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df</span><br><span class="line">   <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span></span><br><span class="line"><span class="number">0</span>  <span class="number">9</span>  <span class="number">3</span>  <span class="number">3</span></span><br><span class="line"><span class="number">1</span>  <span class="number">8</span>  <span class="number">5</span>  <span class="number">4</span></span><br><span class="line"><span class="number">2</span>  <span class="number">3</span>  <span class="number">6</span>  <span class="number">7</span></span><br><span class="line"><span class="number">3</span>  <span class="number">9</span>  <span class="number">8</span>  <span class="number">5</span></span><br><span class="line"><span class="number">4</span>  <span class="number">7</span>  <span class="number">1</span>  <span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.apply(np.prod, axis=<span class="number">1</span>)</span><br><span class="line"><span class="number">0</span>     <span class="number">81</span></span><br><span class="line"><span class="number">1</span>    <span class="number">160</span></span><br><span class="line"><span class="number">2</span>    <span class="number">126</span></span><br><span class="line"><span class="number">3</span>    <span class="number">360</span></span><br><span class="line"><span class="number">4</span>     <span class="number">14</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure><h4 id="demo4"><a href="#demo4" class="headerlink" title="demo4:"></a>demo4:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">197</span>]: <span class="keyword">import</span> pandas <span class="keyword">as</span> pd; <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"> </span><br><span class="line">In [<span class="number">198</span>]: df = pd.DataFrame(np.arange(<span class="number">40.</span>).reshape((<span class="number">8</span>, <span class="number">5</span>)), columns=list(<span class="string">'abcde'</span>));</span><br><span class="line"></span><br><span class="line">In [<span class="number">199</span>]: df</span><br><span class="line">Out[<span class="number">199</span>]:</span><br><span class="line">      a     b     c     d     e</span><br><span class="line"><span class="number">0</span>   <span class="number">0.0</span>   <span class="number">1.0</span>   <span class="number">2.0</span>   <span class="number">3.0</span>   <span class="number">4.0</span></span><br><span class="line"><span class="number">1</span>   <span class="number">5.0</span>   <span class="number">6.0</span>   <span class="number">7.0</span>   <span class="number">8.0</span>   <span class="number">9.0</span></span><br><span class="line"><span class="number">2</span>  <span class="number">10.0</span>  <span class="number">11.0</span>  <span class="number">12.0</span>  <span class="number">13.0</span>  <span class="number">14.0</span></span><br><span class="line"><span class="number">3</span>  <span class="number">15.0</span>  <span class="number">16.0</span>  <span class="number">17.0</span>  <span class="number">18.0</span>  <span class="number">19.0</span></span><br><span class="line"><span class="number">4</span>  <span class="number">20.0</span>  <span class="number">21.0</span>  <span class="number">22.0</span>  <span class="number">23.0</span>  <span class="number">24.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">25.0</span>  <span class="number">26.0</span>  <span class="number">27.0</span>  <span class="number">28.0</span>  <span class="number">29.0</span></span><br><span class="line"><span class="number">6</span>  <span class="number">30.0</span>  <span class="number">31.0</span>  <span class="number">32.0</span>  <span class="number">33.0</span>  <span class="number">34.0</span></span><br><span class="line"><span class="number">7</span>  <span class="number">35.0</span>  <span class="number">36.0</span>  <span class="number">37.0</span>  <span class="number">38.0</span>  <span class="number">39.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">200</span>]: ser = pd.Series(np.arange(<span class="number">8</span>) * <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">In [<span class="number">201</span>]: ser</span><br><span class="line">Out[<span class="number">201</span>]:</span><br><span class="line"><span class="number">0</span>     <span class="number">0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">10</span></span><br><span class="line"><span class="number">2</span>    <span class="number">20</span></span><br><span class="line"><span class="number">3</span>    <span class="number">30</span></span><br><span class="line"><span class="number">4</span>    <span class="number">40</span></span><br><span class="line"><span class="number">5</span>    <span class="number">50</span></span><br><span class="line"><span class="number">6</span>    <span class="number">60</span></span><br><span class="line"><span class="number">7</span>    <span class="number">70</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [<span class="number">202</span>]: func = <span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser)</span><br><span class="line"></span><br><span class="line">In [<span class="number">203</span>]: df.apply(func)</span><br><span class="line">Out[<span class="number">203</span>]:</span><br><span class="line">        a       b       c       d       e</span><br><span class="line"><span class="number">0</span>     <span class="number">0.0</span>     <span class="number">0.0</span>     <span class="number">0.0</span>     <span class="number">0.0</span>     <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">50.0</span>    <span class="number">60.0</span>    <span class="number">70.0</span>    <span class="number">80.0</span>    <span class="number">90.0</span></span><br><span class="line"><span class="number">2</span>   <span class="number">200.0</span>   <span class="number">220.0</span>   <span class="number">240.0</span>   <span class="number">260.0</span>   <span class="number">280.0</span></span><br><span class="line"><span class="number">3</span>   <span class="number">450.0</span>   <span class="number">480.0</span>   <span class="number">510.0</span>   <span class="number">540.0</span>   <span class="number">570.0</span></span><br><span class="line"><span class="number">4</span>   <span class="number">800.0</span>   <span class="number">840.0</span>   <span class="number">880.0</span>   <span class="number">920.0</span>   <span class="number">960.0</span></span><br><span class="line"><span class="number">5</span>  <span class="number">1250.0</span>  <span class="number">1300.0</span>  <span class="number">1350.0</span>  <span class="number">1400.0</span>  <span class="number">1450.0</span></span><br><span class="line"><span class="number">6</span>  <span class="number">1800.0</span>  <span class="number">1860.0</span>  <span class="number">1920.0</span>  <span class="number">1980.0</span>  <span class="number">2040.0</span></span><br><span class="line"><span class="number">7</span>  <span class="number">2450.0</span>  <span class="number">2520.0</span>  <span class="number">2590.0</span>  <span class="number">2660.0</span>  <span class="number">2730.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [<span class="number">204</span>]: df.apply(func).a</span><br><span class="line">Out[<span class="number">204</span>]:</span><br><span class="line"><span class="number">0</span>       <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>      <span class="number">50.0</span></span><br><span class="line"><span class="number">2</span>     <span class="number">200.0</span></span><br><span class="line"><span class="number">3</span>     <span class="number">450.0</span></span><br><span class="line"><span class="number">4</span>     <span class="number">800.0</span></span><br><span class="line"><span class="number">5</span>    <span class="number">1250.0</span></span><br><span class="line"><span class="number">6</span>    <span class="number">1800.0</span></span><br><span class="line"><span class="number">7</span>    <span class="number">2450.0</span></span><br><span class="line">Name: a, dtype: float64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 行相乘</span></span><br><span class="line">In[<span class="number">205</span>]: ser2 = pd.Series(np.arange(<span class="number">5</span>) *<span class="number">5</span>); </span><br><span class="line"></span><br><span class="line">In [<span class="number">206</span>]: ser2</span><br><span class="line">Out[<span class="number">206</span>]: </span><br><span class="line"> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"> <span class="number">1</span> <span class="number">5</span></span><br><span class="line"> <span class="number">2</span> <span class="number">10</span></span><br><span class="line"> <span class="number">3</span> <span class="number">15</span></span><br><span class="line"> <span class="number">4</span> <span class="number">20</span></span><br><span class="line"></span><br><span class="line">In[<span class="number">207</span>]: func2 = <span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser2)</span><br><span class="line"></span><br><span class="line">In[<span class="number">8</span>]: df.apply(func2, axis=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">208</span>]: </span><br><span class="line"> a b c d e</span><br><span class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">5</span> <span class="number">20</span> <span class="number">45</span> <span class="number">80</span></span><br><span class="line"> <span class="number">1</span> <span class="number">0</span> <span class="number">30</span> <span class="number">70</span> <span class="number">120</span> <span class="number">180</span></span><br><span class="line"> <span class="number">2</span> <span class="number">0</span> <span class="number">55</span> <span class="number">120</span> <span class="number">195</span> <span class="number">280</span></span><br><span class="line"> <span class="number">3</span> <span class="number">0</span> <span class="number">80</span> <span class="number">170</span> <span class="number">270</span> <span class="number">380</span></span><br><span class="line"> <span class="number">4</span> <span class="number">0</span> <span class="number">105</span> <span class="number">220</span> <span class="number">345</span> <span class="number">480</span></span><br><span class="line"> <span class="number">5</span> <span class="number">0</span> <span class="number">130</span> <span class="number">270</span> <span class="number">420</span> <span class="number">580</span></span><br><span class="line"> <span class="number">6</span> <span class="number">0</span> <span class="number">155</span> <span class="number">320</span> <span class="number">495</span> <span class="number">680</span></span><br><span class="line"> <span class="number">7</span> <span class="number">0</span> <span class="number">180</span> <span class="number">370</span> <span class="number">570</span> <span class="number">780</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 进阶版</span></span><br><span class="line">In[<span class="number">209</span>]: df.apply(<span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser))</span><br><span class="line">Out[<span class="number">209</span>]: </span><br><span class="line"> a b c d e</span><br><span class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"> <span class="number">1</span> <span class="number">50</span> <span class="number">60</span> <span class="number">70</span> <span class="number">80</span> <span class="number">90</span></span><br><span class="line"> <span class="number">2</span> <span class="number">200</span> <span class="number">220</span> <span class="number">240</span> <span class="number">260</span> <span class="number">280</span></span><br><span class="line"> <span class="number">3</span> <span class="number">450</span> <span class="number">480</span> <span class="number">510</span> <span class="number">540</span> <span class="number">570</span></span><br><span class="line"> <span class="number">4</span> <span class="number">800</span> <span class="number">840</span> <span class="number">880</span> <span class="number">920</span> <span class="number">960</span></span><br><span class="line"> <span class="number">5</span> <span class="number">1250</span> <span class="number">1300</span> <span class="number">1350</span> <span class="number">1400</span> <span class="number">1450</span></span><br><span class="line"> <span class="number">6</span> <span class="number">1800</span> <span class="number">1860</span> <span class="number">1920</span> <span class="number">1980</span> <span class="number">2040</span></span><br><span class="line"> <span class="number">7</span> <span class="number">2450</span> <span class="number">2520</span> <span class="number">2590</span> <span class="number">2660</span> <span class="number">2730</span></span><br><span class="line"> </span><br><span class="line">In [<span class="number">210</span>]: df.apply(<span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser)).a</span><br><span class="line">Out[<span class="number">210</span>]:</span><br><span class="line"><span class="number">0</span>       <span class="number">0.0</span></span><br><span class="line"><span class="number">1</span>      <span class="number">50.0</span></span><br><span class="line"><span class="number">2</span>     <span class="number">200.0</span></span><br><span class="line"><span class="number">3</span>     <span class="number">450.0</span></span><br><span class="line"><span class="number">4</span>     <span class="number">800.0</span></span><br><span class="line"><span class="number">5</span>    <span class="number">1250.0</span></span><br><span class="line"><span class="number">6</span>    <span class="number">1800.0</span></span><br><span class="line"><span class="number">7</span>    <span class="number">2450.0</span></span><br><span class="line">Name: a, dtype: float64</span><br><span class="line"></span><br><span class="line">In[<span class="number">211</span>]: df.apply(<span class="keyword">lambda</span> x: np.asarray(x) * np.asarray(ser2), axis=<span class="number">1</span>)</span><br><span class="line">Out[<span class="number">211</span>]:</span><br><span class="line"> a b c d e</span><br><span class="line"> <span class="number">0</span> <span class="number">0</span> <span class="number">5</span> <span class="number">20</span> <span class="number">45</span> <span class="number">80</span></span><br><span class="line"> <span class="number">1</span> <span class="number">0</span> <span class="number">30</span> <span class="number">70</span> <span class="number">120</span> <span class="number">180</span></span><br><span class="line"> <span class="number">2</span> <span class="number">0</span> <span class="number">55</span> <span class="number">120</span> <span class="number">195</span> <span class="number">280</span></span><br><span class="line"> <span class="number">3</span> <span class="number">0</span> <span class="number">80</span> <span class="number">170</span> <span class="number">270</span> <span class="number">380</span></span><br><span class="line"> <span class="number">4</span> <span class="number">0</span> <span class="number">105</span> <span class="number">220</span> <span class="number">345</span> <span class="number">480</span></span><br><span class="line"> <span class="number">5</span> <span class="number">0</span> <span class="number">130</span> <span class="number">270</span> <span class="number">420</span> <span class="number">580</span></span><br><span class="line"> <span class="number">6</span> <span class="number">0</span> <span class="number">155</span> <span class="number">320</span> <span class="number">495</span> <span class="number">680</span></span><br><span class="line"> <span class="number">7</span> <span class="number">0</span> <span class="number">180</span> <span class="number">370</span> <span class="number">570</span> <span class="number">780</span></span><br></pre></td></tr></table></figure><h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><blockquote><p>这样，我们总分也就拿到了，最后只需将每个项目的总分求和即可</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;继续完成项目中的评分卡部分，拿到分好箱的数据后，如何进行加权得到最后的分数就是我们接下来要考虑的问题了。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="数据分析" scheme="https://chihweihsu.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
      <category term="Pandas" scheme="https://chihweihsu.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/Pandas/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="Pandas" scheme="https://chihweihsu.com/tags/Pandas/"/>
    
      <category term="DataFrame" scheme="https://chihweihsu.com/tags/DataFrame/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-27 python 协程加速</title>
    <link href="https://chihweihsu.com/2017/08/27/2017-8-27-python-%E5%8D%8F%E7%A8%8B%E5%8A%A0%E9%80%9F/"/>
    <id>https://chihweihsu.com/2017/08/27/2017-8-27-python-协程加速/</id>
    <published>2017-08-27T20:05:58.000Z</published>
    <updated>2018-02-24T08:53:20.047Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote><p>上周，由于产品嫌报告生成太慢，经过使用<code>profile/gprof2dot</code>研究后，发现主要时间耗费在接口网络请求上，于是我决定在项目中大量处理I/O网络请求的地方使用<code>gevent</code>,以缓解报告生成压力。</p></blockquote><a id="more"></a><h3 id="实现代码："><a href="#实现代码：" class="headerlink" title="实现代码："></a>实现代码：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey, pool</span><br><span class="line">monkey.patch_socket()</span><br><span class="line">p = pool.Pool(<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">requests_parse</span><span class="params">(self, tel_tuple)</span>:</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">主要处理requests请求</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">print(<span class="string">'Size of pool'</span>, len(p))</span><br><span class="line">……</span><br><span class="line">……</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_label</span><span class="params">(self, tel_data)</span>:</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">使用gevent实现协程处理I/O网络请求</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">jobs = [p.spawn(self.requests_parse, tel) <span class="keyword">for</span> tel <span class="keyword">in</span> tel_data]</span><br><span class="line">gevent.joinall(jobs)</span><br><span class="line"></span><br><span class="line">tlist = [x.value <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">None</span> <span class="keyword">in</span> tlist:</span><br><span class="line">message_list = [x.exception <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</span><br><span class="line">self.logger.error(tlist)</span><br><span class="line">self.logger.error(message_list)</span><br><span class="line"><span class="keyword">raise</span> Exception(message_list)</span><br><span class="line"><span class="keyword">return</span> tlist</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_data_step</span><span class="params">(self, tel)</span>:</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">主要将请求回来处理好的数据写入数据库（mongo）</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">res = self.db.update()</span><br><span class="line">……</span><br><span class="line">……</span><br><span class="line"></span><br><span class="line">tel_data = [……] <span class="comment"># 一大堆待请求参数list</span></span><br><span class="line">tlist = self.generator_label(set(tel_data))</span><br><span class="line">map(<span class="keyword">lambda</span> x: self.update_data_step(x[<span class="number">0</span>])(x[<span class="number">1</span>],x[<span class="number">2</span>],x[<span class="number">3</span>],x[<span class="number">4</span>],x[<span class="number">5</span>],x[<span class="number">6</span>]), tlist)</span><br></pre></td></tr></table></figure><h3 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h3><blockquote><p>上线后发现，代码运行一段时间后，请求一上来，任务数直线上升，一直增加：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-8-27%20python%20%E5%8D%8F%E7%A8%8B%E5%8A%A0%E9%80%9F_1.png" alt="enter description here"><br>但是，pool的数量是正常的：<br><img src="http://ohhmsby4v.bkt.clouddn.com/image/2017-8-27%20python%20%E5%8D%8F%E7%A8%8B%E5%8A%A0%E9%80%9F_2.png" alt="enter description here"><br>之后log里报错信息：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  File <span class="string">"run.py"</span>, line <span class="number">42</span>, <span class="keyword">in</span> update_data</span><br><span class="line">  File <span class="string">"report/generate/calls_sa_by_tel.py"</span>, line <span class="number">396</span>, <span class="keyword">in</span> run</span><br><span class="line">  File <span class="string">"report/generate/calls_sa_by_tel.py"</span>, line <span class="number">38</span>, <span class="keyword">in</span> base_call</span><br><span class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/cursor.py"</span>, line <span class="number">729</span>, <span class="keyword">in</span> count</span><br><span class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/collection.py"</span>, line <span class="number">1344</span>, <span class="keyword">in</span> _count</span><br><span class="line">  File <span class="string">"/usr/lib64/python2.7/contextlib.py"</span>, line <span class="number">17</span>, <span class="keyword">in</span> __enter__</span><br><span class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/mongo_client.py"</span>, line <span class="number">904</span>, <span class="keyword">in</span> _socket_for_reads</span><br><span class="line">  File <span class="string">"/usr/lib64/python2.7/contextlib.py"</span>, line <span class="number">17</span>, <span class="keyword">in</span> __enter__</span><br><span class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/mongo_client.py"</span>, line <span class="number">870</span>, <span class="keyword">in</span> _get_socket</span><br><span class="line">  File <span class="string">"/usr/lib64/python2.7/contextlib.py"</span>, line <span class="number">17</span>, <span class="keyword">in</span> __enter__</span><br><span class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/server.py"</span>, line <span class="number">168</span>, <span class="keyword">in</span> get_socket</span><br><span class="line">  File <span class="string">"/usr/lib64/python2.7/contextlib.py"</span>, line <span class="number">17</span>, <span class="keyword">in</span> __enter__</span><br><span class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/pool.py"</span>, line <span class="number">844</span>, <span class="keyword">in</span> get_socket</span><br><span class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/pool.py"</span>, line <span class="number">881</span>, <span class="keyword">in</span> _get_socket_no_auth</span><br><span class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/pool.py"</span>, line <span class="number">817</span>, <span class="keyword">in</span> connect</span><br><span class="line">  File <span class="string">"venv/lib/python2.7/site-packages/pymongo/pool.py"</span>, line <span class="number">263</span>, <span class="keyword">in</span> _raise_connection_failure</span><br><span class="line">AutoReconnect: xxx.xxx.xxx<span class="number">.117</span>:<span class="number">27017</span>: [Errno <span class="number">24</span>] Too many open files</span><br></pre></td></tr></table></figure><h3 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h3><blockquote><p>经过分析，解决办法：<code>monkey.patch_socket()</code>换为<code>monkey.patch_all()</code>，或者，在使用完<code>gevent</code>后使用<code>reload(socket)</code>将socket初始化。<br>原因：应该是mongo写数据是阻塞的，请求快于写操作，导致写操作堆积越来越多，最终导致程序抛出<code>Too many open files</code>错误。<br>最终代码，如下：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey, pool</span><br><span class="line">monkey.patch_all()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generator_label</span><span class="params">(self, tel_data)</span>:</span></span><br><span class="line">p = pool.Pool(<span class="number">10</span>)</span><br><span class="line">jobs = [p.spawn(self.requests_parse, tel) <span class="keyword">for</span> tel <span class="keyword">in</span> tel_data]</span><br><span class="line">gevent.joinall(jobs)</span><br><span class="line"><span class="comment"># print [x.value for x in jobs]</span></span><br><span class="line">tlist = [x.value <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">None</span> <span class="keyword">in</span> tlist:</span><br><span class="line">message_list = [x.exception <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</span><br><span class="line">self.logger.error(tlist)</span><br><span class="line">self.logger.error(message_list)</span><br><span class="line"><span class="keyword">raise</span> Exception(message_list)</span><br><span class="line"><span class="keyword">return</span> tlist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用</span></span><br><span class="line">p = pool.Pool(<span class="number">10</span>)</span><br><span class="line">jobs = [p.spawn(self.requests_parse, tel) <span class="keyword">for</span> tel <span class="keyword">in</span> tel_data]</span><br><span class="line">gevent.joinall(jobs)</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">reload(socket)</span><br></pre></td></tr></table></figure><h4 id="另一个用例："><a href="#另一个用例：" class="headerlink" title="另一个用例："></a>另一个用例：</h4><blockquote><p>给传递两个参数，直接后面跟着就行，逗号分开；<br>返回如是多个情况的，value是一个以tuple为元素的list。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">p = pool.Pool(<span class="number">10</span>)</span><br><span class="line">jobs = []</span><br><span class="line"><span class="comment"># date ('2017-07-01', '2017-07-14')</span></span><br><span class="line">jobs = [p.spawn(self.crawl_a_call_log, date[<span class="number">0</span>], date[<span class="number">1</span>]) <span class="keyword">for</span> date <span class="keyword">in</span> dates]</span><br><span class="line">gevent.joinall(jobs)</span><br><span class="line">data_list = [x.value <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</span><br><span class="line"><span class="keyword">print</span> data_list</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">None</span> <span class="keyword">in</span> data_list:</span><br><span class="line">message_list = [x.exception <span class="keyword">for</span> x <span class="keyword">in</span> jobs]</span><br><span class="line">self.log(<span class="string">'crawler'</span>, data_list, message_list)</span><br><span class="line"><span class="keyword">raise</span> Exception(message_list)</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote><p>协程(gevent)是把双刃剑，monkey.patch 是一个邪恶的东西；<br>提升效果不要太好，耗时足足降了60%，而且，请求越多，效果越明显。</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;上周，由于产品嫌报告生成太慢，经过使用&lt;code&gt;profile/gprof2dot&lt;/code&gt;研究后，发现主要时间耗费在接口网络请求上，于是我决定在项目中大量处理I/O网络请求的地方使用&lt;code&gt;gevent&lt;/code&gt;,以缓解报告生成压力。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="gevent" scheme="https://chihweihsu.com/tags/gevent/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-27 Pandas 分箱操作（cut）</title>
    <link href="https://chihweihsu.com/2017/08/27/2017-8-27-Pandas-%E5%88%86%E7%AE%B1%E6%93%8D%E4%BD%9C%EF%BC%88cut%EF%BC%89/"/>
    <id>https://chihweihsu.com/2017/08/27/2017-8-27-Pandas-分箱操作（cut）/</id>
    <published>2017-08-27T15:12:47.000Z</published>
    <updated>2018-02-24T08:53:20.047Z</updated>
    
    <content type="html"><![CDATA[<h3 id="情景描述："><a href="#情景描述：" class="headerlink" title="情景描述："></a>情景描述：</h3><blockquote><p>最新，项目中涉及到评分卡操作，评分项目有大概几十项，每项基本都是按频次区间给一个分数，最后，累计所有项目的分数得出最后所需要的分数。</p></blockquote><a id="more"></a><h3 id="demo1："><a href="#demo1：" class="headerlink" title="demo1："></a>demo1：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">df = pandas.DataFrame(&#123;<span class="string">"a"</span>: np.random.random(<span class="number">100</span>), <span class="string">"b"</span>: np.random.random(<span class="number">100</span>), <span class="string">"id"</span>: np.arange(<span class="number">100</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bin the data frame by "a" with 10 bins...</span></span><br><span class="line">bins = np.linspace(df.a.min(), df.a.max(), <span class="number">10</span>)</span><br><span class="line"><span class="comment"># array([ 0.00282977,  0.11097259,  0.2191154 ,  0.32725822,  0.43540104,</span></span><br><span class="line">        <span class="number">0.54354385</span>,  <span class="number">0.65168667</span>,  <span class="number">0.75982948</span>,  <span class="number">0.8679723</span> ,  <span class="number">0.97611511</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># bins = np.linspace(0, 1, 11) # 优化版</span></span><br><span class="line"><span class="comment"># array([ 0. ,  0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  0.7,  0.8,  0.9,  1. ])</span></span><br><span class="line"></span><br><span class="line">groups = df.groupby(np.digitize(df.a, bins))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the mean of each bin:</span></span><br><span class="line"><span class="keyword">print</span> groups.mean() <span class="comment"># Also could do "groups.aggregate(np.mean)"</span></span><br><span class="line">&gt;&gt;&gt;output:</span><br><span class="line">           a         b         id</span><br><span class="line"><span class="number">1</span>   <span class="number">0.044003</span>  <span class="number">0.525964</span>  <span class="number">56.307692</span></span><br><span class="line"><span class="number">2</span>   <span class="number">0.167568</span>  <span class="number">0.506078</span>  <span class="number">55.454545</span></span><br><span class="line"><span class="number">3</span>   <span class="number">0.268109</span>  <span class="number">0.510612</span>  <span class="number">44.636364</span></span><br><span class="line"><span class="number">4</span>   <span class="number">0.375014</span>  <span class="number">0.544154</span>  <span class="number">69.833333</span></span><br><span class="line"><span class="number">5</span>   <span class="number">0.481702</span>  <span class="number">0.590031</span>  <span class="number">48.500000</span></span><br><span class="line"><span class="number">6</span>   <span class="number">0.599587</span>  <span class="number">0.488921</span>  <span class="number">38.076923</span></span><br><span class="line"><span class="number">7</span>   <span class="number">0.696548</span>  <span class="number">0.643555</span>  <span class="number">50.642857</span></span><br><span class="line"><span class="number">8</span>   <span class="number">0.830064</span>  <span class="number">0.620650</span>  <span class="number">50.571429</span></span><br><span class="line"><span class="number">9</span>   <span class="number">0.928396</span>  <span class="number">0.545460</span>  <span class="number">44.166667</span></span><br><span class="line"><span class="number">10</span>  <span class="number">0.976115</span>  <span class="number">0.693051</span>  <span class="number">28.000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Similarly, the median:</span></span><br><span class="line"><span class="keyword">print</span> groups.median()</span><br><span class="line">&gt;&gt;&gt;output:</span><br><span class="line">          a         b    id</span><br><span class="line"><span class="number">1</span>   <span class="number">0.028901</span>  <span class="number">0.536857</span>  <span class="number">61.0</span></span><br><span class="line"><span class="number">2</span>   <span class="number">0.167054</span>  <span class="number">0.557716</span>  <span class="number">49.0</span></span><br><span class="line"><span class="number">3</span>   <span class="number">0.267337</span>  <span class="number">0.534911</span>  <span class="number">43.0</span></span><br><span class="line"><span class="number">4</span>   <span class="number">0.374787</span>  <span class="number">0.487063</span>  <span class="number">73.0</span></span><br><span class="line"><span class="number">5</span>   <span class="number">0.480395</span>  <span class="number">0.737007</span>  <span class="number">49.5</span></span><br><span class="line"><span class="number">6</span>   <span class="number">0.603701</span>  <span class="number">0.676479</span>  <span class="number">42.0</span></span><br><span class="line"><span class="number">7</span>   <span class="number">0.695939</span>  <span class="number">0.689144</span>  <span class="number">57.5</span></span><br><span class="line"><span class="number">8</span>   <span class="number">0.836665</span>  <span class="number">0.690757</span>  <span class="number">41.0</span></span><br><span class="line"><span class="number">9</span>   <span class="number">0.924245</span>  <span class="number">0.646487</span>  <span class="number">47.0</span></span><br><span class="line"><span class="number">10</span>  <span class="number">0.976115</span>  <span class="number">0.693051</span>  <span class="number">28.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply some arbitrary function to aggregate binned data</span></span><br><span class="line"><span class="keyword">print</span> groups.aggregate(<span class="keyword">lambda</span> x: np.mean(x[x &gt; <span class="number">0.5</span>]))</span><br><span class="line">&gt;&gt;&gt;output:</span><br><span class="line">           a         b         id</span><br><span class="line"><span class="number">1</span>        NaN  <span class="number">0.671236</span>  <span class="number">56.307692</span></span><br><span class="line"><span class="number">2</span>        NaN  <span class="number">0.704379</span>  <span class="number">55.454545</span></span><br><span class="line"><span class="number">3</span>        NaN  <span class="number">0.768609</span>  <span class="number">44.636364</span></span><br><span class="line"><span class="number">4</span>        NaN  <span class="number">0.804354</span>  <span class="number">69.833333</span></span><br><span class="line"><span class="number">5</span>   <span class="number">0.514166</span>  <span class="number">0.796151</span>  <span class="number">48.500000</span></span><br><span class="line"><span class="number">6</span>   <span class="number">0.599587</span>  <span class="number">0.755381</span>  <span class="number">41.250000</span></span><br><span class="line"><span class="number">7</span>   <span class="number">0.696548</span>  <span class="number">0.779524</span>  <span class="number">50.642857</span></span><br><span class="line"><span class="number">8</span>   <span class="number">0.830064</span>  <span class="number">0.766095</span>  <span class="number">50.571429</span></span><br><span class="line"><span class="number">9</span>   <span class="number">0.928396</span>  <span class="number">0.902529</span>  <span class="number">44.166667</span></span><br><span class="line"><span class="number">10</span>  <span class="number">0.976115</span>  <span class="number">0.693051</span>  <span class="number">28.000000</span></span><br></pre></td></tr></table></figure><h4 id="demo2"><a href="#demo2" class="headerlink" title="demo2 :"></a>demo2 :</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas</span><br><span class="line"></span><br><span class="line">df = pandas.DataFrame(&#123;<span class="string">"a"</span>: np.random.random(<span class="number">100</span>), </span><br><span class="line">                       <span class="string">"b"</span>: np.random.random(<span class="number">100</span>) + <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bin the data frame by "a" with 10 bins...</span></span><br><span class="line">bins = np.linspace(df.a.min(), df.a.max(), <span class="number">10</span>)</span><br><span class="line">groups = df.groupby(pandas.cut(df.a, bins))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the mean of b, binned by the values in a</span></span><br><span class="line"><span class="keyword">print</span> groups.mean().b</span><br><span class="line">&gt;&gt;&gt;output:</span><br><span class="line">a</span><br><span class="line">(<span class="number">0.000351</span>, <span class="number">0.11</span>]    <span class="number">10.596542</span></span><br><span class="line">(<span class="number">0.11</span>, <span class="number">0.22</span>]        <span class="number">10.690010</span></span><br><span class="line">(<span class="number">0.22</span>, <span class="number">0.33</span>]        <span class="number">10.250080</span></span><br><span class="line">(<span class="number">0.33</span>, <span class="number">0.44</span>]        <span class="number">10.546134</span></span><br><span class="line">(<span class="number">0.44</span>, <span class="number">0.549</span>]       <span class="number">10.471454</span></span><br><span class="line">(<span class="number">0.549</span>, <span class="number">0.659</span>]      <span class="number">10.455624</span></span><br><span class="line">(<span class="number">0.659</span>, <span class="number">0.769</span>]      <span class="number">10.501616</span></span><br><span class="line">(<span class="number">0.769</span>, <span class="number">0.879</span>]      <span class="number">10.588354</span></span><br><span class="line">(<span class="number">0.879</span>, <span class="number">0.989</span>]      <span class="number">10.461848</span></span><br><span class="line">Name: b, dtype: float64</span><br></pre></td></tr></table></figure><h4 id="demo3"><a href="#demo3" class="headerlink" title="demo3:"></a>demo3:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">144</span>]: df = DataFrame(&#123;<span class="string">"a"</span>: np.random.random(<span class="number">100</span>), <span class="string">"b"</span>: np.random.random(<span class="number">100</span>), <span class="string">"id"</span>:   np.arange(<span class="number">100</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">145</span>]: bins = [<span class="number">0</span>, <span class="number">.25</span>, <span class="number">.5</span>, <span class="number">.75</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">146</span>]: a_bins = df.a.groupby(cut(df.a,bins))</span><br><span class="line"></span><br><span class="line">In [<span class="number">147</span>]: b_bins = df.b.groupby(cut(df.b,bins))</span><br><span class="line"></span><br><span class="line">In [<span class="number">148</span>]: a_bins.agg([mean,median])</span><br><span class="line">Out[<span class="number">148</span>]:</span><br><span class="line">                 mean    median</span><br><span class="line">a</span><br><span class="line">(<span class="number">0</span>, <span class="number">0.25</span>]    <span class="number">0.124173</span>  <span class="number">0.114613</span></span><br><span class="line">(<span class="number">0.25</span>, <span class="number">0.5</span>]  <span class="number">0.367703</span>  <span class="number">0.358866</span></span><br><span class="line">(<span class="number">0.5</span>, <span class="number">0.75</span>]  <span class="number">0.624251</span>  <span class="number">0.626730</span></span><br><span class="line">(<span class="number">0.75</span>, <span class="number">1</span>]    <span class="number">0.875395</span>  <span class="number">0.869843</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">149</span>]: b_bins.agg([mean,median])</span><br><span class="line">Out[<span class="number">149</span>]:</span><br><span class="line">                 mean    median</span><br><span class="line">b</span><br><span class="line">(<span class="number">0</span>, <span class="number">0.25</span>]    <span class="number">0.147936</span>  <span class="number">0.166900</span></span><br><span class="line">(<span class="number">0.25</span>, <span class="number">0.5</span>]  <span class="number">0.394918</span>  <span class="number">0.386729</span></span><br><span class="line">(<span class="number">0.5</span>, <span class="number">0.75</span>]  <span class="number">0.636111</span>  <span class="number">0.655247</span></span><br><span class="line">(<span class="number">0.75</span>, <span class="number">1</span>]    <span class="number">0.851227</span>  <span class="number">0.838805</span></span><br></pre></td></tr></table></figure><h4 id="demo4"><a href="#demo4" class="headerlink" title="demo4:"></a>demo4:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">In [<span class="number">168</span>]: filter_values = [<span class="number">0</span>, <span class="number">5</span>, <span class="number">17</span>, <span class="number">33</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">169</span>]: df = pd.DataFrame(np.random.random(<span class="number">100</span>)*<span class="number">100</span>, columns  = [<span class="string">'filtercol'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">170</span>]: out = pd.cut(df.filtercol, bins = filter_values)</span><br><span class="line"></span><br><span class="line">In [<span class="number">171</span>]: counts = pd.value_counts(out)</span><br><span class="line">Out[<span class="number">171</span>]:</span><br><span class="line">(<span class="number">17</span>, <span class="number">33</span>]    <span class="number">16</span></span><br><span class="line">(<span class="number">5</span>, <span class="number">17</span>]     <span class="number">11</span></span><br><span class="line">(<span class="number">0</span>, <span class="number">5</span>]       <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序</span></span><br><span class="line">counts = counts.reindex(out.cat.categories)</span><br><span class="line">counts = counts.sort_index()</span><br><span class="line"></span><br><span class="line">In [<span class="number">172</span>]: counts = counts.reindex(out.cat.categories)</span><br><span class="line">In [<span class="number">173</span>]: counts</span><br><span class="line">Out[<span class="number">173</span>]:</span><br><span class="line">(<span class="number">0</span>, <span class="number">5</span>]       <span class="number">5</span></span><br><span class="line">(<span class="number">5</span>, <span class="number">17</span>]     <span class="number">11</span></span><br><span class="line">(<span class="number">17</span>, <span class="number">33</span>]    <span class="number">16</span></span><br><span class="line">Name: filtercol, dtype: int64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置索引(reset index)</span></span><br><span class="line">out = counts.reset_index(drop=<span class="keyword">True</span>) <span class="comment"># counts 不变</span></span><br><span class="line">counts.reset_index(drop=<span class="keyword">True</span>, inplace=<span class="keyword">True</span>) <span class="comment"># 直接改变counts</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">174</span>]: out = counts.reset_index(drop=<span class="keyword">True</span>)</span><br><span class="line">In [<span class="number">175</span>]: out</span><br><span class="line">Out[<span class="number">175</span>]:</span><br><span class="line"><span class="number">0</span>     <span class="number">5</span></span><br><span class="line"><span class="number">1</span>    <span class="number">11</span></span><br><span class="line"><span class="number">2</span>    <span class="number">16</span></span><br><span class="line">Name: filtercol, dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">176</span>]: counts</span><br><span class="line">Out[<span class="number">176</span>]:</span><br><span class="line">(<span class="number">0</span>, <span class="number">5</span>]       <span class="number">5</span></span><br><span class="line">(<span class="number">5</span>, <span class="number">17</span>]     <span class="number">11</span></span><br><span class="line">(<span class="number">17</span>, <span class="number">33</span>]    <span class="number">16</span></span><br><span class="line">Name: filtercol, dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="number">177</span>]: counts.reset_index(drop=<span class="keyword">True</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">In [<span class="number">178</span>]: counts</span><br><span class="line">Out[<span class="number">178</span>]:</span><br><span class="line"><span class="number">0</span>     <span class="number">5</span></span><br><span class="line"><span class="number">1</span>    <span class="number">11</span></span><br><span class="line"><span class="number">2</span>    <span class="number">16</span></span><br><span class="line">Name: filtercol, dtype: int64</span><br></pre></td></tr></table></figure><h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><blockquote><p>第四个demo基本就可以完成当前目标了；<br>后续需要操作的是封装一个合适的通用方法，将每个项目评分标准代入即可。</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;情景描述：&quot;&gt;&lt;a href=&quot;#情景描述：&quot; class=&quot;headerlink&quot; title=&quot;情景描述：&quot;&gt;&lt;/a&gt;情景描述：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;最新，项目中涉及到评分卡操作，评分项目有大概几十项，每项基本都是按频次区间给一个分数，最后，累计所有项目的分数得出最后所需要的分数。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="数据分析" scheme="https://chihweihsu.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
      <category term="Pandas" scheme="https://chihweihsu.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/Pandas/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="Pandas" scheme="https://chihweihsu.com/tags/Pandas/"/>
    
      <category term="cut" scheme="https://chihweihsu.com/tags/cut/"/>
    
      <category term="评分卡" scheme="https://chihweihsu.com/tags/%E8%AF%84%E5%88%86%E5%8D%A1/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-23 mongo insert_many BulkWriteError</title>
    <link href="https://chihweihsu.com/2017/08/23/2017-8-23-mongo-insert-many-BulkWriteError/"/>
    <id>https://chihweihsu.com/2017/08/23/2017-8-23-mongo-insert-many-BulkWriteError/</id>
    <published>2017-08-23T13:31:08.000Z</published>
    <updated>2018-02-24T08:53:20.046Z</updated>
    
    <content type="html"><![CDATA[<h3 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h3><blockquote><p>在对mongo插入数据时，报写入问题，报错信息如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/root/crs/call_history_crawler/worker/communicate.py&quot;, line 149, in insert_db_data</span><br><span class="line">    if db[table].insert_many(data):</span><br><span class="line">  File &quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/collection.py&quot;, line 684, in insert_many</span><br><span class="line">    blk.execute(self.write_concern.document)</span><br><span class="line">  File &quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/bulk.py&quot;, line 470, in execute</span><br><span class="line">    return self.execute_command(sock_info, generator, write_concern)</span><br><span class="line">  File &quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/bulk.py&quot;, line 314, in execute_command</span><br><span class="line">    raise BulkWriteError(full_result)</span><br><span class="line">BulkWriteError: batch op errors occurred</span><br></pre></td></tr></table></figure></p></blockquote><a id="more"></a><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><blockquote><p>问题出现在，对同一文本进行多次插入，官方说法：<code>insert_many() with a list of references to a single document raises BulkWriteError</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; doc = &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; collection.insert_many(doc for _ in range(10))</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">...</span><br><span class="line">pymongo.errors.BulkWriteError: batch op errors occurred</span><br><span class="line">&gt;&gt;&gt; doc</span><br><span class="line">&#123;&apos;_id&apos;: ObjectId(&apos;560f171cfba52279f0b0da0c&apos;)&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; docs = [&#123;&#125;]</span><br><span class="line">&gt;&gt;&gt; collection.insert_many(docs * 10)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">...</span><br><span class="line">pymongo.errors.BulkWriteError: batch op errors occurred</span><br><span class="line">&gt;&gt;&gt; docs</span><br><span class="line">[&#123;&apos;_id&apos;: ObjectId(&apos;560f1933fba52279f0b0da0e&apos;)&#125;]</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;问题：&quot;&gt;&lt;a href=&quot;#问题：&quot; class=&quot;headerlink&quot; title=&quot;问题：&quot;&gt;&lt;/a&gt;问题：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;在对mongo插入数据时，报写入问题，报错信息如下：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Traceback (most recent call last):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  File &amp;quot;/root/crs/call_history_crawler/worker/communicate.py&amp;quot;, line 149, in insert_db_data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if db[table].insert_many(data):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  File &amp;quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/collection.py&amp;quot;, line 684, in insert_many&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    blk.execute(self.write_concern.document)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  File &amp;quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/bulk.py&amp;quot;, line 470, in execute&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return self.execute_command(sock_info, generator, write_concern)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  File &amp;quot;/root/crs/call_history_crawler/venv/lib/python2.7/site-packages/pymongo/bulk.py&amp;quot;, line 314, in execute_command&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    raise BulkWriteError(full_result)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BulkWriteError: batch op errors occurred&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Bug" scheme="https://chihweihsu.com/categories/Bug/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Bug/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="Bug" scheme="https://chihweihsu.com/tags/Bug/"/>
    
      <category term="mongo" scheme="https://chihweihsu.com/tags/mongo/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-14 JSON文件 读写 格式化</title>
    <link href="https://chihweihsu.com/2017/08/14/2017-8-14-JSON%E6%96%87%E4%BB%B6-%E8%AF%BB%E5%86%99-%E6%A0%BC%E5%BC%8F%E5%8C%96/"/>
    <id>https://chihweihsu.com/2017/08/14/2017-8-14-JSON文件-读写-格式化/</id>
    <published>2017-08-14T17:37:04.000Z</published>
    <updated>2018-02-24T08:53:20.046Z</updated>
    
    <content type="html"><![CDATA[<h3 id="写文件，格式化"><a href="#写文件，格式化" class="headerlink" title="写文件，格式化"></a>写文件，格式化</h3><blockquote><p><code>indent</code>: 缩进（一般填4，缩进4格）；<br><code>sort_keys</code>: 是否排序（默认<code>False</code>–不排序）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_info</span><span class="params">(file_name, file_info)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'&#123;&#125;.json'</span>.format(file_name), <span class="string">'w'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        json.dump(file_info, fp, indent=<span class="number">4</span>, sort_keys=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">write_info(<span class="string">'report'</span>, dict(report_data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br></pre></td></tr></table></figure></p></blockquote><a id="more"></a><h3 id="读文件，格式化"><a href="#读文件，格式化" class="headerlink" title="读文件，格式化"></a>读文件，格式化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pp_json</span><span class="params">(json_thing, sort=True, indents=<span class="number">4</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> type(json_thing) <span class="keyword">is</span> str:</span><br><span class="line">        print(json.dumps(json.loads(json_thing), sort_keys=sort, indent=indents))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(json.dumps(json_thing, sort_keys=sort, indent=indents))</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">pp_json(your_json_string_or_dict)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>your_json = <span class="string">'["foo", &#123;"bar":["baz", null, 1.0, 2]&#125;]'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>parsed = json.loads(your_json)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> json.dumps(parsed, indent=<span class="number">4</span>, sort_keys=<span class="keyword">True</span>)</span><br><span class="line">[</span><br><span class="line">    <span class="string">"foo"</span>, </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"bar"</span>: [</span><br><span class="line">            <span class="string">"baz"</span>, </span><br><span class="line">            null, </span><br><span class="line">            <span class="number">1.0</span>, </span><br><span class="line">            <span class="number">2</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;写文件，格式化&quot;&gt;&lt;a href=&quot;#写文件，格式化&quot; class=&quot;headerlink&quot; title=&quot;写文件，格式化&quot;&gt;&lt;/a&gt;写文件，格式化&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;indent&lt;/code&gt;: 缩进（一般填4，缩进4格）；&lt;br&gt;&lt;code&gt;sort_keys&lt;/code&gt;: 是否排序（默认&lt;code&gt;False&lt;/code&gt;–不排序）&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;write_info&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(file_name, file_info)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; open(&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;&amp;#125;.json&#39;&lt;/span&gt;.format(file_name), &lt;span class=&quot;string&quot;&gt;&#39;w&#39;&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; fp:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        json.dump(file_info, fp, indent=&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, sort_keys=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;write_info(&lt;span class=&quot;string&quot;&gt;&#39;report&#39;&lt;/span&gt;, dict(report_data))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; json&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="json" scheme="https://chihweihsu.com/tags/json/"/>
    
  </entry>
  
  <entry>
    <title>2017-8-13 三元表达式（条件表达式）</title>
    <link href="https://chihweihsu.com/2017/08/13/2017-8-13-%E4%B8%89%E5%85%83%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%88%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%89/"/>
    <id>https://chihweihsu.com/2017/08/13/2017-8-13-三元表达式（条件表达式）/</id>
    <published>2017-08-13T14:41:33.000Z</published>
    <updated>2018-02-24T08:53:20.046Z</updated>
    
    <content type="html"><![CDATA[<h3 id="条件表达式："><a href="#条件表达式：" class="headerlink" title="条件表达式："></a>条件表达式：</h3><blockquote><p>使用一行代码快速判断，替换复杂的多行if语句，使得代码简单可维护。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果条件为真，返回真，否则返回假</span></span><br><span class="line">condition_is_true <span class="keyword">if</span> condition <span class="keyword">else</span> condition_is_false</span><br><span class="line"></span><br><span class="line">is_fat = <span class="keyword">True</span></span><br><span class="line">state = <span class="string">"fat"</span> <span class="keyword">if</span> is_fat <span class="keyword">else</span> <span class="string">"not fat"</span></span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="元组条件表达式："><a href="#元组条件表达式：" class="headerlink" title="元组条件表达式："></a>元组条件表达式：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (返回假，返回真)[真或假]</span></span><br><span class="line">(if_test_is_false, if_test_is_true)[test]</span><br><span class="line"></span><br><span class="line">fat = true</span><br><span class="line">fitness = (<span class="string">"skinny"</span>, <span class="string">"fat"</span>)[fat]</span><br><span class="line">print(<span class="string">'All is '</span>, fitness)</span><br><span class="line"><span class="comment"># 输出： All is fat</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><ul><li>原理：python中，True == 1，False == 0，相当于元组中使用0和1来选取数据；</li><li>这种写法不被推荐，原因：不Pythonic；容易把数据与true/false弄混；元祖中两个条件都执行，而<code>if-else</code>的条件表达式不会；</li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">condition = <span class="keyword">True</span></span><br><span class="line">python(<span class="number">2</span> <span class="keyword">if</span> condition <span class="keyword">else</span> <span class="number">1</span>/<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 输出：2</span></span><br><span class="line"></span><br><span class="line">print(<span class="number">1</span>/<span class="number">0</span>, <span class="number">2</span>)[condition]</span><br><span class="line"><span class="comment"># 输出：ZeroDivisionError异常</span></span><br></pre></td></tr></table></figure><blockquote><p>解释：</p><ul><li>元组先建数据，然后用True(1)/False(0)来索引数据；</li><li><code>if-else</code>条件表达式遵循普通的<code>if-else</code>逻辑树；</li><li>如果逻辑中有异常条件或重计算型（计算较久）的情况下，避免使用元组条件表达式。</li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;条件表达式：&quot;&gt;&lt;a href=&quot;#条件表达式：&quot; class=&quot;headerlink&quot; title=&quot;条件表达式：&quot;&gt;&lt;/a&gt;条件表达式：&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;使用一行代码快速判断，替换复杂的多行if语句，使得代码简单可维护。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 如果条件为真，返回真，否则返回假&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;condition_is_true &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; condition &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; condition_is_false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;is_fat = &lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;state = &lt;span class=&quot;string&quot;&gt;&quot;fat&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; is_fat &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;not fat&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Notes" scheme="https://chihweihsu.com/categories/Notes/"/>
    
      <category term="Python" scheme="https://chihweihsu.com/categories/Notes/Python/"/>
    
    
      <category term="Python" scheme="https://chihweihsu.com/tags/Python/"/>
    
      <category term="条件表达式" scheme="https://chihweihsu.com/tags/%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
</feed>
